import{r as o,j as e,bv as z,aj as I,B as C,C as _,a as f,b as j,z as b,c as y,as as N,at as S,au as w,av as F,aw as P,az as u,x as A,bw as K,an as L}from"./index-GAVc2OtO.js";import{A as E}from"./AdminLayout-BhVK5JeJ.js";import{S as H}from"./switch-Bx2MimiK.js";import{u as J}from"./usePhase9Settings-8kKlxO1R.js";import{E as R}from"./eye-off-yQb2AHYH.js";import{E as $}from"./eye-7yJOw-As.js";import"./sheet-DgW-QWTQ.js";import"./index-DD5cTla9.js";import"./useQuery-CV8yfldm.js";import"./workflow-PVWcfWK5.js";import"./cpu-C0sgczmA.js";import"./database-CX9CnqQc.js";import"./useMutation-C-Rbfrtn.js";import"./useAuditLog-DaCpHk4g.js";const q=({label:l,description:d,value:r,min:x,max:s,step:m=1,onValueChange:p,disabled:v=!1,icon:c,formatValue:g})=>{const n=o.useMemo(()=>g?g(r):r.toString(),[r,g]);return e.jsxs("div",{className:"flex flex-col gap-3 rounded-lg border border-border/60 bg-card/40 p-4",children:[e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[c?e.jsx(c,{className:"h-5 w-5 text-muted-foreground"}):null,e.jsx("h3",{className:"text-sm font-medium leading-none sm:text-base",children:l})]}),d?e.jsx("p",{className:"text-sm text-muted-foreground",children:d}):null]}),e.jsx("span",{className:"rounded-full bg-muted px-3 py-1 text-xs font-medium text-muted-foreground",children:n})]}),e.jsx(z,{min:x,max:s,step:m,defaultValue:[r],value:[r],onValueChange:h=>p(h[0]??r),disabled:v})]})},k=({label:l,description:d,checked:r,onCheckedChange:x,disabled:s=!1,icon:m})=>e.jsxs("div",{className:"flex flex-col gap-3 rounded-lg border border-border/60 bg-card/40 p-4 sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[m?e.jsx(m,{className:"h-5 w-5 text-muted-foreground"}):null,e.jsx("h3",{className:"text-sm font-medium leading-none sm:text-base",children:l})]}),d?e.jsx("p",{className:"text-sm text-muted-foreground",children:d}):null]}),e.jsx(H,{checked:r,disabled:s,onCheckedChange:x,className:"ml-auto"})]}),V=l=>({collaborative_intelligence_enabled:l.collaborative_intelligence_enabled,temporal_decay_enabled:l.temporal_decay_enabled,temporal_decay_rate:l.temporal_decay_rate,freshness_check_seconds:l.freshness_check_seconds,staleness_threshold_days:l.staleness_threshold_days,market_integration_mode:l.market_integration_mode,market_api_key:l.market_api_key??"",cross_league_enabled:l.cross_league_enabled,cross_league_league_count:l.cross_league_league_count,cross_league_depth:l.cross_league_depth}),ie=()=>{const{settings:l,isLoading:d,isSaving:r,saveSettings:x}=J(),[s,m]=o.useState(null),[p,v]=o.useState(!1);o.useEffect(()=>{l&&m(V(l))},[l]);const c=o.useMemo(()=>l?V(l):null,[l]),g=o.useMemo(()=>!s||!c?!1:JSON.stringify(s)!==JSON.stringify(c),[s,c]),n=o.useCallback((a,t)=>{m(i=>i&&{...i,[a]:t})},[]),h=a=>t=>{const i=Number(t.target.value);Number.isNaN(i)||n(a,i)},M=o.useCallback(()=>{if(!s||!l)return{};const a={};return Object.keys(s).forEach(t=>{const i=s[t],B=c?.[t];if(i===B)return;if(t==="market_api_key"){a.market_api_key=s.market_api_key.trim()?s.market_api_key.trim():null;return}const D=t;a[D]=i}),a},[s,c,l]),T=async()=>{const a=M();if(s){if(Object.keys(a).length===0){L.info("No changes to save");return}try{await x(a)}catch(t){console.error("Failed to save Phase 9 settings",t)}}};if(d||!s)return e.jsx(E,{title:"Phase 9",description:"Configure collaborative intelligence and market integrations.",breadcrumbs:[{label:"Admin",href:"/admin"},{label:"Phase 9"}],children:e.jsx("div",{className:"grid grid-cols-1 gap-4 sm:grid-cols-2",children:Array.from({length:4}).map((a,t)=>e.jsx(I,{className:"h-44 w-full"},`phase9-skeleton-${t}`))})});const O=s.collaborative_intelligence_enabled?e.jsx(C,{variant:"default",children:"Active"}):e.jsx(C,{variant:"destructive",children:"Disabled"});return e.jsx(E,{title:"Phase 9",description:"Tune collaborative intelligence parameters and rollout strategy.",breadcrumbs:[{label:"Admin",href:"/admin"},{label:"Phase 9"}],actions:e.jsxs(A,{size:"lg",className:"gap-2",onClick:()=>void T(),disabled:!g||r,children:[e.jsx(K,{className:"h-4 w-4"}),r?"Saving…":"Save changes"]}),children:e.jsxs("section",{className:"space-y-6",children:[e.jsxs(_,{children:[e.jsxs(f,{className:"flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("div",{children:[e.jsx(j,{children:"Collaborative intelligence"}),e.jsx(b,{children:"Control the self-improving behaviour of Phase 9 systems."})]}),O]}),e.jsxs(y,{className:"space-y-4",children:[e.jsx(k,{label:"Enable collaborative intelligence",description:"Allow analysts to collaborate with AI strategies in realtime.",checked:s.collaborative_intelligence_enabled,onCheckedChange:a=>n("collaborative_intelligence_enabled",a)}),e.jsx(k,{label:"Enable temporal decay",description:"Prioritise recent data when generating predictions.",checked:s.temporal_decay_enabled,onCheckedChange:a=>n("temporal_decay_enabled",a)}),e.jsx(q,{label:"Temporal decay rate",description:"Adjust the decay factor between 0 (no decay) and 1 (instant decay).",value:Number(s.temporal_decay_rate.toFixed(2)),min:0,max:1,step:.01,onValueChange:a=>n("temporal_decay_rate",Number(a.toFixed(2))),formatValue:a=>a.toFixed(2),disabled:!s.temporal_decay_enabled})]})]}),e.jsxs(_,{children:[e.jsxs(f,{children:[e.jsx(j,{children:"Freshness thresholds"}),e.jsx(b,{children:"Define data retention and validation cycles."})]}),e.jsxs(y,{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-foreground",htmlFor:"freshness-check",children:"Freshness check (seconds)"}),e.jsx(N,{id:"freshness-check",type:"number",min:30,value:s.freshness_check_seconds,onChange:h("freshness_check_seconds"),className:"h-11"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-foreground",htmlFor:"staleness-threshold",children:"Staleness threshold (days)"}),e.jsx(N,{id:"staleness-threshold",type:"number",min:1,value:s.staleness_threshold_days,onChange:h("staleness_threshold_days"),className:"h-11"})]})]})]}),e.jsxs(_,{children:[e.jsxs(f,{children:[e.jsx(j,{children:"Market integrations"}),e.jsx(b,{children:"Control rollout of market-facing automation and API credentials."})]}),e.jsxs(y,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-foreground",htmlFor:"market-mode",children:"Mode"}),e.jsxs(S,{value:s.market_integration_mode,onValueChange:a=>n("market_integration_mode",a),children:[e.jsx(w,{id:"market-mode",className:"h-11 w-full",children:e.jsx(F,{})}),e.jsxs(P,{children:[e.jsx(u,{value:"off",children:"Off"}),e.jsx(u,{value:"test",children:"Test"}),e.jsx(u,{value:"prod",children:"Production"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-foreground",htmlFor:"market-key",children:"Market API key"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(N,{id:"market-key",type:p?"text":"password",value:s.market_api_key,onChange:a=>n("market_api_key",a.target.value),placeholder:"••••••••••",className:"h-11 flex-1"}),e.jsxs(A,{type:"button",variant:"outline",size:"icon",className:"h-11 w-11",onClick:()=>v(a=>!a),children:[p?e.jsx(R,{className:"h-4 w-4"}):e.jsx($,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Toggle visibility"})]})]})]})]})]}),e.jsxs(_,{children:[e.jsxs(f,{children:[e.jsx(j,{children:"Cross-league intelligence"}),e.jsx(b,{children:"Balance breadth and depth of collaborative models across leagues."})]}),e.jsxs(y,{className:"space-y-4",children:[e.jsx(k,{label:"Enable cross-league intelligence",description:"Share learnings across competitions to accelerate convergence.",checked:s.cross_league_enabled,onCheckedChange:a=>n("cross_league_enabled",a)}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-foreground",htmlFor:"league-count",children:"Number of leagues"}),e.jsx(N,{id:"league-count",type:"number",min:1,value:s.cross_league_league_count,onChange:h("cross_league_league_count"),disabled:!s.cross_league_enabled,className:"h-11"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-foreground",htmlFor:"cross-depth",children:"Depth"}),e.jsxs(S,{value:s.cross_league_depth,onValueChange:a=>n("cross_league_depth",a),disabled:!s.cross_league_enabled,children:[e.jsx(w,{id:"cross-depth",className:"h-11 w-full",children:e.jsx(F,{})}),e.jsxs(P,{children:[e.jsx(u,{value:"low",children:"Low"}),e.jsx(u,{value:"medium",children:"Medium"}),e.jsx(u,{value:"high",children:"High"})]})]})]})]})]})]})]})})};export{ie as default};
