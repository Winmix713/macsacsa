import{am as c,an as o,r as _,w as d}from"./index-B-k02BhT.js";import{u as l}from"./useQuery-DIgGmLU4.js";import{u as m}from"./useMutation-DADJpn4h.js";import{u as p}from"./useAuditLog-BbpKohf-.js";const i=["admin","phase9","settings"],h=["off","test","prod"],g=["low","medium","high"],s=e=>{const r=typeof e.market_integration_mode=="string"&&h.includes(e.market_integration_mode)?e.market_integration_mode:"test",a=typeof e.cross_league_depth=="string"&&g.includes(e.cross_league_depth)?e.cross_league_depth:"medium";return{id:Number(e.id??1),collaborative_intelligence_enabled:!!e.collaborative_intelligence_enabled,temporal_decay_enabled:!!(e.temporal_decay_enabled??!0),temporal_decay_rate:Number(e.temporal_decay_rate??0),freshness_check_seconds:Number(e.freshness_check_seconds??60),staleness_threshold_days:Number(e.staleness_threshold_days??7),market_integration_mode:r,market_api_key:e.market_api_key??null,cross_league_enabled:!!(e.cross_league_enabled??!0),cross_league_league_count:Number(e.cross_league_league_count??5),cross_league_depth:a,updated_at:typeof e.updated_at=="string"?e.updated_at:new Date().toISOString()}},y=async()=>{const{data:e,error:r}=await d.from("phase9_settings").select("*").eq("id",1).maybeSingle();if(r&&r.code!=="PGRST116"&&r.code!=="42P01")throw r;return s(e||{id:1})},f=async e=>{const r={id:1,...e,updated_at:new Date().toISOString()},{data:a,error:t}=await d.from("phase9_settings").upsert(r,{onConflict:"id"}).select("*").eq("id",1).single();if(t)throw t;return s(a)},E=()=>{const e=c(),{log:r}=p(),a=l({queryKey:i,queryFn:y,staleTime:6e4}),t=m({mutationFn:f,onSuccess:async(n,u)=>{await e.invalidateQueries({queryKey:i}),o.success("Phase 9 settings saved"),await r("phase9_updated",u)},onError:n=>{o.error(`Failed to save settings: ${n.message}`)}});return _.useEffect(()=>{a.error&&o.error(a.error instanceof Error?a.error.message:"Failed to load Phase 9 settings")},[a.error]),{settings:a.data??null,isLoading:a.isLoading,error:a.error,saveSettings:t.mutateAsync,isSaving:t.isPending,refetch:a.refetch}};export{E as u};
