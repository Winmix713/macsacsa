import{j as e,g as p,k as y,m as v,ba as k,r as c,w as h,bj as N}from"./index-GAVc2OtO.js";import{u as w}from"./useMutation-C-Rbfrtn.js";import{M as z}from"./message-square-Cif2A0zC.js";const M=({message:a,theme:t="light"})=>{const r=a.role==="user",n=()=>a.content.split(`
`).map((l,i)=>l.startsWith("##")?e.jsx("h3",{className:"font-bold text-lg mt-2",children:l.replace(/^#+\s/,"")},i):l.startsWith("-")||l.startsWith("‚Ä¢")?e.jsx("li",{className:"ml-4",children:l.replace(/^[-‚Ä¢]\s/,"")},i):l.trim()===""?e.jsx("br",{},i):e.jsx("p",{className:"text-sm",children:l},i));return e.jsx("div",{className:`flex ${r?"justify-end":"justify-start"}`,children:e.jsxs("div",{className:`max-w-md px-4 py-3 rounded-lg shadow-sm ${r?"bg-blue-600 text-white rounded-br-none":t==="dark"?"bg-slate-800 text-slate-100 rounded-bl-none border border-slate-700":"bg-slate-200 text-slate-900 rounded-bl-none border border-slate-300"}`,children:[e.jsx("div",{className:"text-sm leading-relaxed",children:n()}),!r&&a.metadata&&e.jsxs("div",{className:"mt-2 pt-2 border-t border-opacity-30 border-current space-y-1",children:[a.metadata.teams&&e.jsxs("div",{className:"flex items-center gap-1 text-xs opacity-75",children:[e.jsx("span",{children:"üèüÔ∏è"}),e.jsxs("span",{children:[a.metadata.teams.home," vs ",a.metadata.teams.away]})]}),a.metadata.prediction&&e.jsxs("div",{className:"flex items-center gap-1 text-xs opacity-75",children:[e.jsx(p,{className:"w-3 h-3"}),e.jsxs("span",{children:["Konfidencia: ",Math.round(a.metadata.prediction.confidence*100),"%"]})]}),a.metadata.patterns&&a.metadata.patterns.length>0&&e.jsxs("div",{className:"flex items-center gap-1 text-xs opacity-75",children:[e.jsx(y,{className:"w-3 h-3"}),e.jsxs("span",{children:[a.metadata.patterns.length," minta √©szlelve"]})]})]}),e.jsx("div",{className:`text-xs mt-1 ${r?"opacity-70":"opacity-50"}`,children:a.timestamp.toLocaleTimeString("hu-HU",{hour:"2-digit",minute:"2-digit"})})]})})},$=({theme:a="light"})=>e.jsx("div",{className:"flex justify-start",children:e.jsx("div",{className:`px-4 py-3 rounded-lg shadow-sm ${a==="dark"?"bg-slate-800 rounded-bl-none border border-slate-700":"bg-slate-200 rounded-bl-none border border-slate-300"}`,children:e.jsxs("div",{className:"flex gap-1 items-center",children:[e.jsx("div",{className:"w-2 h-2 bg-current rounded-full animate-bounce",style:{animationDelay:"0ms"}}),e.jsx("div",{className:"w-2 h-2 bg-current rounded-full animate-bounce",style:{animationDelay:"150ms"}}),e.jsx("div",{className:"w-2 h-2 bg-current rounded-full animate-bounce",style:{animationDelay:"300ms"}})]})})}),S=({onSelect:a,theme:t="light"})=>{const r=[{icon:z,label:"Hazai vs Vend√©g",query:"Elemezz egy hazai √©s egy vend√©g csapatot"},{icon:p,label:"Forma Elemz√©s",query:"Milyen az utols√≥ 5 meccs alapj√°n a csapatok form√°ja?"},{icon:v,label:"H2H Profil",query:"Mi a kor√°bbi egym√°s elleni m√©rk≈ëz√©sek eredm√©nye?"},{icon:k,label:"Halad√≥ Elemz√©s",query:"V√©gezz r√©szletes statisztikai elemz√©st"}];return e.jsxs("div",{className:`px-4 py-3 border-t border-${t==="dark"?"slate-700":"slate-200"}`,children:[e.jsx("p",{className:`text-xs font-semibold mb-2 text-${t==="dark"?"slate-400":"slate-600"} uppercase`,children:"Gyors m≈±veletek"}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:r.map((n,d)=>{const l=n.icon;return e.jsxs("button",{onClick:()=>a(n.query),className:`p-2 rounded-lg text-left text-sm font-medium transition-colors ${t==="dark"?"bg-slate-800 hover:bg-slate-700 text-slate-200 border border-slate-700":"bg-slate-100 hover:bg-slate-200 text-slate-700 border border-slate-200"} flex items-center gap-2`,children:[e.jsx(l,{className:"w-4 h-4 flex-shrink-0"}),e.jsx("span",{className:"truncate",children:n.label})]},d)})})]})},E=({onPredictionRequest:a,theme:t="light"})=>{const[r,n]=c.useState([]),[d,l]=c.useState(""),[i,u]=c.useState(!1),x=c.useRef(null),g=c.useRef(null);c.useEffect(()=>{x.current?.scrollIntoView({behavior:"smooth"})},[r]),c.useEffect(()=>{n([{id:"0",role:"assistant",content:"Sziasztok! üëã √ân vagyok a WinMix AI asszisztens. K√©rdezzetek meg b√°rmit k√©t csapatr√≥l, √©s megadok egy r√©szletes elemz√©st, predikci√≥t √©s fogad√°si javaslatot!",timestamp:new Date}])},[]);const b=w({mutationFn:async s=>{const{data:m,error:o}=await h.functions.invoke("ai-chat",{body:{message:s,conversationHistory:r,context:{userId:(await h.auth.getUser()).data?.user?.id}}});if(o)throw new Error(o.message);return m},onSuccess:s=>{if(s.success&&s.message){const m={id:Date.now().toString(),role:"assistant",content:s.message,timestamp:new Date,metadata:{teams:s.analysis?.teams,league:s.analysis?.league,patterns:s.analysis?.patterns,prediction:s.analysis?.prediction}};n(o=>[...o,m]),s.analysis?.teams&&a&&a(s.analysis.teams)}u(!1)},onError:s=>{console.error("Chat error:",s);const m={id:Date.now().toString(),role:"assistant",content:`Sajn√°lom, hiba t√∂rt√©nt: ${s instanceof Error?s.message:"Ismeretlen hiba"}`,timestamp:new Date};n(o=>[...o,m]),u(!1)}}),f=async s=>{if(s.preventDefault(),!d.trim()||i)return;const m={id:Date.now().toString(),role:"user",content:d,timestamp:new Date};n(o=>[...o,m]),l(""),u(!0),await b.mutateAsync(d)},j=s=>{l(s)};return e.jsxs("div",{className:`flex flex-col h-full bg-${t==="dark"?"slate-900":"white"} rounded-lg shadow-lg`,children:[e.jsxs("div",{className:`p-4 border-b border-${t==="dark"?"slate-700":"slate-200"}`,children:[e.jsx("h2",{className:`text-lg font-semibold text-${t==="dark"?"white":"slate-900"}`,children:"WinMix AI Elemz≈ë"}),e.jsx("p",{className:`text-sm text-${t==="dark"?"slate-400":"slate-600"}`,children:"K√©rdezzetek meg b√°rmir≈ël a csapatokr√≥l √©s a m√©rk≈ëz√©sekr≈ël"})]}),e.jsxs("div",{className:`flex-1 overflow-y-auto p-4 space-y-4 bg-${t==="dark"?"slate-950":"slate-50"}`,children:[r.map(s=>e.jsx(M,{message:s,theme:t},s.id)),i&&e.jsx($,{theme:t}),e.jsx("div",{ref:x})]}),r.length===1&&e.jsx(S,{onSelect:j,theme:t}),b.isError&&e.jsxs("div",{className:"p-3 mx-4 rounded-lg bg-red-50 border border-red-200 flex gap-2",children:[e.jsx(N,{className:"w-5 h-5 text-red-600 flex-shrink-0"}),e.jsx("p",{className:"text-sm text-red-600",children:"Hiba a lek√©rdez√©s feldolgoz√°sa k√∂zben. K√©rj√ºk, pr√≥b√°lja √∫jra."})]}),e.jsx("form",{onSubmit:f,className:`p-4 border-t border-${t==="dark"?"slate-700":"slate-200"}`,children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{ref:g,type:"text",value:d,onChange:s=>l(s.target.value),placeholder:"pl. Real Madrid vs Barcelona...",disabled:i,className:`flex-1 px-4 py-2 rounded-lg border border-${t==="dark"?"slate-600":"slate-300"} bg-${t==="dark"?"slate-800":"white"} text-${t==="dark"?"white":"slate-900"} placeholder-${t==="dark"?"slate-400":"slate-500"} focus:outline-none focus:ring-2 focus:ring-blue-500`}),e.jsx("button",{type:"submit",disabled:i||!d.trim(),className:"px-6 py-2 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:i?"...":"K√ºld√©s"})]})})]})},C=()=>{const[a,t]=c.useState(null),r=n=>{t(n)};return e.jsxs("div",{className:"flex flex-col h-full bg-slate-50",children:[e.jsx("div",{className:"flex-1 overflow-hidden",children:e.jsx(E,{onPredictionRequest:r,theme:"light"})}),a&&e.jsx("div",{className:"p-4 border-t border-slate-200 bg-white",children:e.jsxs("p",{className:"text-sm text-slate-600",children:["Kiv√°lasztott m√©rk≈ëz√©s: ",e.jsxs("span",{className:"font-semibold",children:[a.home," vs ",a.away]})]})})]})};export{C as default};
