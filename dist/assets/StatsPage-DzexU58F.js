import{r as c,j as e,C as i,a as m,b as h,c as u,at as N,au as C,av as T,aw as D,az as x,as as z,B as O,A as R,n as P,a7 as U,bC as X,ae as Y,af as J,ag as W,a8 as Z,bD as ee,b6 as se,aA as S,aB as A,aC as _,aD as j,aE as M,aF as g,w as F}from"./index-oF1ARjuv.js";import{u as H}from"./useQuery-CWzqJKQX.js";import{A as ae}from"./AdminLayout-Bg1DZssM.js";import"./sheet-DvMN5rIM.js";import"./index-ALgH8dPm.js";import"./workflow-DCkL6mGY.js";import"./cpu-Bs1Da7jx.js";import"./database-AuhrJFpe.js";const re=async()=>{const{data:n,error:d}=await F.from("matches").select(`
      *,
      home_team:teams!matches_home_team_id_fkey(id, name),
      away_team:teams!matches_away_team_id_fkey(id, name)
    `).order("match_date",{ascending:!0});if(d)throw new Error(d.message);return n||[]},te=async()=>{const{data:n,error:d}=await F.from("teams").select("id, name").order("name",{ascending:!0});if(d)throw new Error(d.message);return n||[]};function E(n){const d=(n.status||"").toLowerCase();return d==="completed"||d==="finished"}function ue(){const[n,d]=c.useState("all"),[b,B]=c.useState("all"),[f,Q]=c.useState(""),[p,$]=c.useState(""),w=H({queryKey:["stats","matches"],queryFn:re}),q=H({queryKey:["stats","teams"],queryFn:te}),y=c.useMemo(()=>(w.data||[]).filter(t=>n==="all"?!0:b==="home"?t.home_team_id===n:b==="away"?t.away_team_id===n:t.home_team_id===n||t.away_team_id===n).filter(t=>{const l=new Date(t.match_date).getTime();if(Number.isNaN(l))return!1;const L=f?l>=new Date(f).getTime():!0,V=p?l<=new Date(p).getTime()+1440*60*1e3-1:!0;return L&&V}),[w.data,n,b,f,p]),o=c.useMemo(()=>y.filter(s=>E(s)&&s.home_score!==null&&s.away_score!==null),[y]),G=c.useMemo(()=>{let s=0,a=0,r=0;for(const l of o)(l.home_score??0)>(l.away_score??0)?s++:(l.home_score??0)<(l.away_score??0)?r++:a++;const t=o.length||1;return[{name:"Home",value:Math.round(s/t*100)},{name:"Draw",value:Math.round(a/t*100)},{name:"Away",value:Math.round(r/t*100)}]},[o]),I=c.useMemo(()=>{if(o.length===0)return 0;const s=o.reduce((a,r)=>a+(r.home_score??0)+(r.away_score??0),0);return Number((s/o.length).toFixed(2))},[o]),k=c.useMemo(()=>{const s={0:0,1:0,2:0,3:0,"4+":0};for(const a of o){const r=(a.home_score??0)+(a.away_score??0);r<=3?s[String(r)]++:s["4+"]++}return Object.entries(s).map(([a,r])=>({goals:a,count:r}))},[o]),K=c.useMemo(()=>{const s=new Map;for(const a of o){const r=`${a.home_score}-${a.away_score}`;s.set(r,(s.get(r)||0)+1)}return Array.from(s.entries()).map(([a,r])=>({score:a,count:r})).sort((a,r)=>r.count-a.count).slice(0,10)},[o]),v=c.useMemo(()=>{const s=[];for(const a of y){!Number.isNaN(new Date(a.match_date).getTime())||s.push({match:a,issue:"Invalid date"});const t=a.home_score,l=a.away_score;E(a)&&(t===null||l===null)&&s.push({match:a,issue:"Completed but missing score"}),((t??0)<0||(l??0)<0)&&s.push({match:a,issue:"Negative score"}),a.halftime_home_score!==null&&t!==null&&a.halftime_home_score>t&&s.push({match:a,issue:"Halftime home score > final"}),a.halftime_away_score!==null&&l!==null&&a.halftime_away_score>l&&s.push({match:a,issue:"Halftime away score > final"}),(t??0)+(l??0)>20&&s.push({match:a,issue:"Unusually high total goals"}),a.home_team_id===a.away_team_id&&s.push({match:a,issue:"Same team for home and away"})}return s},[y]);return e.jsxs(ae,{title:"Stats & Data Quality",description:"Alap eloszlások, scoreline gyakoriságok, adatminőség ellenőrzések",breadcrumbs:[{label:"Admin",href:"/admin"},{label:"Stats & Data Quality"}],children:[e.jsxs(i,{className:"bg-card/60 border-border/80 backdrop-blur",children:[e.jsx(m,{children:e.jsx(h,{children:"Szűrők"})}),e.jsx(u,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-muted-foreground",children:"Csapat"}),e.jsxs(N,{value:n,onValueChange:d,children:[e.jsx(C,{children:e.jsx(T,{placeholder:"Összes csapat"})}),e.jsxs(D,{children:[e.jsx(x,{value:"all",children:"Összes"}),q.data?.map(s=>e.jsx(x,{value:s.id,children:s.name},s.id))]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-muted-foreground",children:"Helyszín"}),e.jsxs(N,{value:b,onValueChange:s=>B(s),children:[e.jsx(C,{children:e.jsx(T,{})}),e.jsxs(D,{children:[e.jsx(x,{value:"all",children:"Összes"}),e.jsx(x,{value:"home",children:"Hazai"}),e.jsx(x,{value:"away",children:"Vendég"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-muted-foreground",children:"Dátumtól"}),e.jsx(z,{type:"date",value:f,onChange:s=>Q(s.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-muted-foreground",children:"Dátumig"}),e.jsx(z,{type:"date",value:p,onChange:s=>$(s.target.value)})]})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs(i,{className:"bg-card/60 border-border/80 backdrop-blur",children:[e.jsx(m,{children:e.jsx(h,{children:"Elemzett mérkőzések"})}),e.jsxs(u,{children:[e.jsx("div",{className:"text-3xl font-bold",children:o.length}),e.jsx("p",{className:"text-muted-foreground text-xs mt-1",children:"Csak befejezett, pontszámmal rendelkező meccsek"})]})]}),e.jsxs(i,{className:"bg-card/60 border-border/80 backdrop-blur",children:[e.jsx(m,{children:e.jsx(h,{children:"Átlagos gólok"})}),e.jsx(u,{children:e.jsx("div",{className:"text-3xl font-bold",children:I})})]}),e.jsxs(i,{className:"bg-card/60 border-border/80 backdrop-blur",children:[e.jsx(m,{children:e.jsx(h,{children:"Eredmény eloszlás"})}),e.jsx(u,{children:e.jsx("div",{className:"flex gap-3",children:G.map(s=>e.jsxs(O,{variant:"secondary",children:[s.name,": ",s.value,"%"]},s.name))})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(i,{className:"bg-card/60 border-border/80 backdrop-blur",children:[e.jsx(m,{children:e.jsx(h,{children:"Gólszám hisztogram"})}),e.jsx(u,{children:o.length===0?e.jsx(R,{children:e.jsx(P,{children:"Nincs elegendő adat a megjelenítéshez."})}):e.jsx("div",{className:"h-80",children:e.jsx(U,{width:"100%",height:"100%",children:e.jsxs(X,{data:k,margin:{top:20,right:20,left:0,bottom:20},children:[e.jsx(Y,{strokeDasharray:"3 3",stroke:"hsl(215, 20%, 17%)"}),e.jsx(J,{dataKey:"goals",tick:{fill:"hsl(215, 20%, 65%)"}}),e.jsx(W,{allowDecimals:!1,tick:{fill:"hsl(215, 20%, 65%)"}}),e.jsx(Z,{contentStyle:{backgroundColor:"hsl(11, 11%, 8%)",border:"1px solid hsl(215, 20%, 17%)",color:"hsl(210, 40%, 98%)"}}),e.jsx(ee,{dataKey:"count",radius:[8,8,0,0],children:k.map((s,a)=>e.jsx(se,{fill:"hsl(160, 84%, 39%)"},`cell-${a}`))})]})})})})]}),e.jsxs(i,{className:"bg-card/60 border-border/80 backdrop-blur",children:[e.jsx(m,{children:e.jsx(h,{children:"Top pontos eredmények"})}),e.jsx(u,{children:e.jsxs(S,{children:[e.jsx(A,{children:e.jsxs(_,{children:[e.jsx(j,{children:"Eredmény"}),e.jsx(j,{children:"Gyakoriság"})]})}),e.jsx(M,{children:K.map(s=>e.jsxs(_,{children:[e.jsx(g,{className:"font-mono",children:s.score}),e.jsx(g,{children:s.count})]},s.score))})]})})]})]}),e.jsxs(i,{className:"bg-card/60 border-border/80 backdrop-blur",children:[e.jsx(m,{children:e.jsx(h,{children:"Adatminőség - problémás rekordok"})}),e.jsx(u,{children:v.length===0?e.jsx("div",{className:"text-muted-foreground",children:"Nincs problémás rekord a szűrők alapján."}):e.jsxs(S,{children:[e.jsx(A,{children:e.jsxs(_,{children:[e.jsx(j,{children:"Dátum"}),e.jsx(j,{children:"Mérkőzés"}),e.jsx(j,{children:"Probléma"})]})}),e.jsx(M,{children:v.map(({match:s,issue:a})=>e.jsxs(_,{children:[e.jsx(g,{className:"font-mono text-sm",children:new Date(s.match_date).toLocaleDateString()}),e.jsxs(g,{children:[s.home_team?.name||s.home_team_id," vs ",s.away_team?.name||s.away_team_id]}),e.jsx(g,{className:"text-red-400",children:a})]},`${s.id}-${a}`))})]})})]})]})}export{ue as default};
