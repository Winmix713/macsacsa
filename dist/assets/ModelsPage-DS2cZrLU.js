import{K as N,W as ie,Q as ve,aY as Ge,aZ as Ue,N as ce,O as ye,a4 as te,Y as ne,a2 as Y,a_ as We,a$ as Ze,Z as Ye,b0 as Xe,_ as _e,$ as et,b1 as X,b2 as tt,a0 as rt,r as M,b3 as at,a1 as st,b4 as de,b5 as it,b6 as qe,b7 as nt,b8 as le,b9 as Ae,a5 as ot,a6 as lt,j as e,C as O,a as T,b as F,B as xe,f as we,c as D,aO as ct,x as K,ba as he,aQ as dt,aR as ut,aS as mt,aT as Ne,ax as pe,S as ue,aP as $e,w as B,ah as ht,am as pt,an as w,ao as ft,ai as gt,ak as vt,ab as Se,ar as Ce,ap as $,as as oe,at as Re,au as Ee,av as ke,aw as Pe,az as Z,aq as Me,A as xt,n as yt,J as bt,a7 as jt,a8 as _t}from"./index-GAVc2OtO.js";import{u as Be}from"./useQuery-CV8yfldm.js";import{u as G}from"./useMutation-C-Rbfrtn.js";import{S as At}from"./square-pen-vBoTrtC_.js";import{E as wt}from"./ellipsis-CSrgf-Ot.js";import{T as Nt}from"./trash-2-Dnjp8NsW.js";import{P as Qe}from"./pause-CFTqubk4.js";import{D as Oe,b as St,c as Ct,d as Rt,f as Et,a as kt}from"./dialog-I4-_6RT2.js";import{S as De}from"./switch-Bx2MimiK.js";import{a as Pt,b as Mt}from"./PolarAngleAxis-CdiQ_OjW.js";import"./index-DD5cTla9.js";var me;function re(t){"@babel/helpers - typeof";return re=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(r){return typeof r}:function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},re(t)}function ee(){return ee=Object.assign?Object.assign.bind():function(t){for(var r=1;r<arguments.length;r++){var n=arguments[r];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(t[a]=n[a])}return t},ee.apply(this,arguments)}function Ie(t,r){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,a)}return n}function p(t){for(var r=1;r<arguments.length;r++){var n=arguments[r]!=null?arguments[r]:{};r%2?Ie(Object(n),!0).forEach(function(a){k(t,a,n[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Ie(Object(n)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(n,a))})}return t}function Ot(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}function Te(t,r){for(var n=0;n<r.length;n++){var a=r[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,He(a.key),a)}}function Dt(t,r,n){return r&&Te(t.prototype,r),n&&Te(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function It(t,r,n){return r=fe(r),Tt(t,ze()?Reflect.construct(r,n||[],fe(t).constructor):r.apply(t,n))}function Tt(t,r){if(r&&(re(r)==="object"||typeof r=="function"))return r;if(r!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Ft(t)}function Ft(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function ze(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(ze=function(){return!!t})()}function fe(t){return fe=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(n){return n.__proto__||Object.getPrototypeOf(n)},fe(t)}function Kt(t,r){if(typeof r!="function"&&r!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),r&&be(t,r)}function be(t,r){return be=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(a,i){return a.__proto__=i,a},be(t,r)}function k(t,r,n){return r=He(r),r in t?Object.defineProperty(t,r,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[r]=n,t}function He(t){var r=Lt(t,"string");return re(r)=="symbol"?r:r+""}function Lt(t,r){if(re(t)!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var a=n.call(t,r);if(re(a)!="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}var Q=(function(t){function r(n){var a;return Ot(this,r),a=It(this,r,[n]),k(a,"pieRef",null),k(a,"sectorRefs",[]),k(a,"id",at("recharts-pie-")),k(a,"handleAnimationEnd",function(){var i=a.props.onAnimationEnd;a.setState({isAnimationFinished:!0}),ie(i)&&i()}),k(a,"handleAnimationStart",function(){var i=a.props.onAnimationStart;a.setState({isAnimationFinished:!1}),ie(i)&&i()}),a.state={isAnimationFinished:!n.isAnimationActive,prevIsAnimationActive:n.isAnimationActive,prevAnimationId:n.animationId,sectorToFocus:0},a}return Kt(r,t),Dt(r,[{key:"isActiveIndex",value:function(a){var i=this.props.activeIndex;return Array.isArray(i)?i.indexOf(a)!==-1:a===i}},{key:"hasActiveIndex",value:function(){var a=this.props.activeIndex;return Array.isArray(a)?a.length!==0:a||a===0}},{key:"renderLabels",value:function(a){var i=this.props.isAnimationActive;if(i&&!this.state.isAnimationFinished)return null;var u=this.props,c=u.label,m=u.labelLine,f=u.dataKey,d=u.valueKey,v=ce(this.props,!1),g=ce(c,!1),R=ce(m,!1),y=c&&c.offsetRadius||20,b=a.map(function(l,h){var j=(l.startAngle+l.endAngle)/2,x=ye(l.cx,l.cy,l.outerRadius+y,j),_=p(p(p(p({},v),l),{},{stroke:"none"},g),{},{index:h,textAnchor:r.getTextAnchor(x.x,l.cx)},x),L=p(p(p(p({},v),l),{},{fill:"none",stroke:l.fill},R),{},{index:h,points:[ye(l.cx,l.cy,l.outerRadius,j),x]}),S=f;return te(f)&&te(d)?S="value":te(f)&&(S=d),N.createElement(ne,{key:"label-".concat(l.startAngle,"-").concat(l.endAngle,"-").concat(l.midAngle,"-").concat(h)},m&&r.renderLabelLineItem(m,L,"line"),r.renderLabelItem(c,_,Y(l,S)))});return N.createElement(ne,{className:"recharts-pie-labels"},b)}},{key:"renderSectorsStatically",value:function(a){var i=this,u=this.props,c=u.activeShape,m=u.blendStroke,f=u.inactiveShape;return a.map(function(d,v){if(d?.startAngle===0&&d?.endAngle===0&&a.length!==1)return null;var g=i.isActiveIndex(v),R=f&&i.hasActiveIndex()?f:null,y=g?c:R,b=p(p({},d),{},{stroke:m?d.fill:d.stroke,tabIndex:-1});return N.createElement(ne,ee({ref:function(h){h&&!i.sectorRefs.includes(h)&&i.sectorRefs.push(h)},tabIndex:-1,className:"recharts-pie-sector"},We(i.props,d,v),{key:"sector-".concat(d?.startAngle,"-").concat(d?.endAngle,"-").concat(d.midAngle,"-").concat(v)}),N.createElement(Ze,ee({option:y,isActive:g,shapeType:"sector"},b)))})}},{key:"renderSectorsWithAnimation",value:function(){var a=this,i=this.props,u=i.sectors,c=i.isAnimationActive,m=i.animationBegin,f=i.animationDuration,d=i.animationEasing,v=i.animationId,g=this.state,R=g.prevSectors,y=g.prevIsAnimationActive;return N.createElement(Ye,{begin:m,duration:f,isActive:c,easing:d,from:{t:0},to:{t:1},key:"pie-".concat(v,"-").concat(y),onAnimationStart:this.handleAnimationStart,onAnimationEnd:this.handleAnimationEnd},function(b){var l=b.t,h=[],j=u&&u[0],x=j.startAngle;return u.forEach(function(_,L){var S=R&&R[L],q=L>0?Xe(_,"paddingAngle",0):0;if(S){var z=_e(S.endAngle-S.startAngle,_.endAngle-_.startAngle),A=p(p({},_),{},{startAngle:x+q,endAngle:x+z(l)+q});h.push(A),x=A.endAngle}else{var I=_.endAngle,E=_.startAngle,H=_e(0,I-E),V=H(l),P=p(p({},_),{},{startAngle:x+q,endAngle:x+V+q});h.push(P),x=P.endAngle}}),N.createElement(ne,null,a.renderSectorsStatically(h))})}},{key:"attachKeyboardHandlers",value:function(a){var i=this;a.onkeydown=function(u){if(!u.altKey)switch(u.key){case"ArrowLeft":{var c=++i.state.sectorToFocus%i.sectorRefs.length;i.sectorRefs[c].focus(),i.setState({sectorToFocus:c});break}case"ArrowRight":{var m=--i.state.sectorToFocus<0?i.sectorRefs.length-1:i.state.sectorToFocus%i.sectorRefs.length;i.sectorRefs[m].focus(),i.setState({sectorToFocus:m});break}case"Escape":{i.sectorRefs[i.state.sectorToFocus].blur(),i.setState({sectorToFocus:0});break}}}}},{key:"renderSectors",value:function(){var a=this.props,i=a.sectors,u=a.isAnimationActive,c=this.state.prevSectors;return u&&i&&i.length&&(!c||!et(c,i))?this.renderSectorsWithAnimation():this.renderSectorsStatically(i)}},{key:"componentDidMount",value:function(){this.pieRef&&this.attachKeyboardHandlers(this.pieRef)}},{key:"render",value:function(){var a=this,i=this.props,u=i.hide,c=i.sectors,m=i.className,f=i.label,d=i.cx,v=i.cy,g=i.innerRadius,R=i.outerRadius,y=i.isAnimationActive,b=this.state.isAnimationFinished;if(u||!c||!c.length||!X(d)||!X(v)||!X(g)||!X(R))return null;var l=ve("recharts-pie",m);return N.createElement(ne,{tabIndex:this.props.rootTabIndex,className:l,ref:function(j){a.pieRef=j}},this.renderSectors(),f&&this.renderLabels(c),tt.renderCallByParent(this.props,null,!1),(!y||b)&&rt.renderCallByParent(this.props,c,!1))}}],[{key:"getDerivedStateFromProps",value:function(a,i){return i.prevIsAnimationActive!==a.isAnimationActive?{prevIsAnimationActive:a.isAnimationActive,prevAnimationId:a.animationId,curSectors:a.sectors,prevSectors:[],isAnimationFinished:!0}:a.isAnimationActive&&a.animationId!==i.prevAnimationId?{prevAnimationId:a.animationId,curSectors:a.sectors,prevSectors:i.curSectors,isAnimationFinished:!0}:a.sectors!==i.curSectors?{curSectors:a.sectors,isAnimationFinished:!0}:null}},{key:"getTextAnchor",value:function(a,i){return a>i?"start":a<i?"end":"middle"}},{key:"renderLabelLineItem",value:function(a,i,u){if(N.isValidElement(a))return N.cloneElement(a,i);if(ie(a))return a(i);var c=ve("recharts-pie-label-line",typeof a!="boolean"?a.className:"");return N.createElement(Ge,ee({},i,{key:u,type:"linear",className:c}))}},{key:"renderLabelItem",value:function(a,i,u){if(N.isValidElement(a))return N.cloneElement(a,i);var c=u;if(ie(a)&&(c=a(i),N.isValidElement(c)))return c;var m=ve("recharts-pie-label-text",typeof a!="boolean"&&!ie(a)?a.className:"");return N.createElement(Ue,ee({},i,{alignmentBaseline:"middle",className:m}),c)}}])})(M.PureComponent);me=Q;k(Q,"displayName","Pie");k(Q,"defaultProps",{stroke:"#fff",fill:"#808080",legendType:"rect",cx:"50%",cy:"50%",startAngle:0,endAngle:360,innerRadius:0,outerRadius:"80%",paddingAngle:0,labelLine:!0,hide:!1,minAngle:0,isAnimationActive:!st.isSsr,animationBegin:400,animationDuration:1500,animationEasing:"ease",nameKey:"name",blendStroke:!1,rootTabIndex:0});k(Q,"parseDeltaAngle",function(t,r){var n=de(r-t),a=Math.min(Math.abs(r-t),360);return n*a});k(Q,"getRealPieData",function(t){var r=t.data,n=t.children,a=ce(t,!1),i=it(n,qe);return r&&r.length?r.map(function(u,c){return p(p(p({payload:u},a),u),i&&i[c]&&i[c].props)}):i&&i.length?i.map(function(u){return p(p({},a),u.props)}):[]});k(Q,"parseCoordinateOfPie",function(t,r){var n=r.top,a=r.left,i=r.width,u=r.height,c=nt(i,u),m=a+le(t.cx,i,i/2),f=n+le(t.cy,u,u/2),d=le(t.innerRadius,c,0),v=le(t.outerRadius,c,c*.8),g=t.maxRadius||Math.sqrt(i*i+u*u)/2;return{cx:m,cy:f,innerRadius:d,outerRadius:v,maxRadius:g}});k(Q,"getComposedData",function(t){var r=t.item,n=t.offset,a=r.type.defaultProps!==void 0?p(p({},r.type.defaultProps),r.props):r.props,i=me.getRealPieData(a);if(!i||!i.length)return null;var u=a.cornerRadius,c=a.startAngle,m=a.endAngle,f=a.paddingAngle,d=a.dataKey,v=a.nameKey,g=a.valueKey,R=a.tooltipType,y=Math.abs(a.minAngle),b=me.parseCoordinateOfPie(a,n),l=me.parseDeltaAngle(c,m),h=Math.abs(l),j=d;te(d)&&te(g)?(Ae(!1,`Use "dataKey" to specify the value of pie,
      the props "valueKey" will be deprecated in 1.1.0`),j="value"):te(d)&&(Ae(!1,`Use "dataKey" to specify the value of pie,
      the props "valueKey" will be deprecated in 1.1.0`),j=g);var x=i.filter(function(A){return Y(A,j,0)!==0}).length,_=(h>=360?x:x-1)*f,L=h-x*y-_,S=i.reduce(function(A,I){var E=Y(I,j,0);return A+(X(E)?E:0)},0),q;if(S>0){var z;q=i.map(function(A,I){var E=Y(A,j,0),H=Y(A,v,I),V=(X(E)?E:0)/S,P;I?P=z.endAngle+de(l)*f*(E!==0?1:0):P=c;var ae=P+de(l)*((E!==0?y:0)+V*L),se=(P+ae)/2,J=(b.innerRadius+b.outerRadius)/2,W=[{name:H,value:E,payload:A,dataKey:j,type:R}],ge=ye(b.cx,b.cy,J,se);return z=p(p(p({percent:V,cornerRadius:u,name:H,tooltipPayload:W,midAngle:se,middleRadius:J,tooltipPosition:ge},A),b),{},{value:Y(A,j),startAngle:P,endAngle:ae,payload:A,paddingAngle:de(l)*f}),z})}return p(p({},b),{},{sectors:q,data:i})});var qt=ot({chartName:"PieChart",GraphicalChild:Q,validateTooltipEventTypes:["item"],defaultTooltipEventType:"item",legendContent:"children",axisComponents:[{axisType:"angleAxis",AxisComp:Pt},{axisType:"radiusAxis",AxisComp:Mt}],formatAxisMap:lt,defaultProps:{layout:"centric",startAngle:0,endAngle:360,cx:"50%",cy:"50%",innerRadius:0,outerRadius:"80%"}});function Fe(t){switch(t){case"champion":return"bg-emerald-500/15 text-emerald-400 border border-emerald-500/30";case"challenger":return"bg-amber-500/15 text-amber-400 border border-amber-500/30";default:return"bg-muted text-muted-foreground"}}function $t(t){return t==null?"-":`${Math.round(t*100)}%`}function Bt(t){switch(t){case"activate":return $e;case"deactivate":return Qe;case"promote":return he;case"retire":return ue;case"duplicate":return pe;default:return pe}}function Ke({model:t,onPromote:r,onEdit:n,onDelete:a,onAction:i,actions:u=[]}){const c=t.model_type==="challenger",m=t.is_active!==!1,f=d=>{i&&i(d,t)};return e.jsxs(O,{className:"bg-card/60 border-border/80 backdrop-blur",children:[e.jsx(T,{children:e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs(F,{className:"text-lg font-semibold text-foreground",children:[t.model_name," ",e.jsxs("span",{className:"text-muted-foreground",children:["v",t.model_version]})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:t.algorithm||"Algoritmus: ismeretlen"})]}),e.jsx(xe,{className:we("uppercase text-[11px] font-semibold tracking-wide",Fe(t.model_type)),children:t.model_type})]})}),e.jsxs(D,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(xe,{className:we("uppercase text-[11px] font-semibold tracking-wide",Fe(t.model_type)),children:t.model_type}),e.jsx(xe,{variant:m?"default":"secondary",children:m?"Active":"Inactive"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{className:"rounded-lg border border-border/60 bg-muted/20 p-3",children:[e.jsx("p",{className:"text-xs text-muted-foreground uppercase tracking-wide",children:"Accuracy"}),e.jsx("p",{className:"text-foreground font-medium",children:$t(t.accuracy)})]}),e.jsxs("div",{className:"rounded-lg border border-border/60 bg-muted/20 p-3",children:[e.jsx("p",{className:"text-xs text-muted-foreground uppercase tracking-wide",children:"Predictions"}),e.jsx("p",{className:"text-foreground font-medium",children:t.total_predictions??0})]}),e.jsxs("div",{className:"rounded-lg border border-border/60 bg-muted/20 p-3",children:[e.jsx("p",{className:"text-xs text-muted-foreground uppercase tracking-wide",children:"Traffic"}),e.jsxs("p",{className:"text-foreground font-medium",children:[t.traffic_allocation??0,"%"]})]}),e.jsxs("div",{className:"rounded-lg border border-border/60 bg-muted/20 p-3",children:[e.jsx("p",{className:"text-xs text-muted-foreground uppercase tracking-wide",children:"Registered"}),e.jsx("p",{className:"text-foreground font-medium",children:t.registered_at?new Date(t.registered_at).toLocaleDateString():"-"})]})]}),t.description&&e.jsxs("div",{className:"text-sm text-muted-foreground",children:[e.jsx("p",{className:"font-medium text-foreground mb-1",children:"Description"}),e.jsx("p",{children:t.description})]})]}),e.jsxs(ct,{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex gap-2",children:[c&&e.jsxs(K,{size:"sm",onClick:()=>r?.(t),children:[e.jsx(he,{className:"w-4 h-4 mr-2"}),"Promote"]}),n&&e.jsxs(K,{size:"sm",variant:"outline",onClick:()=>n(t),children:[e.jsx(At,{className:"w-4 h-4 mr-2"}),"Edit"]})]}),u.length>0&&e.jsxs(dt,{children:[e.jsx(ut,{asChild:!0,children:e.jsx(K,{variant:"ghost",size:"sm",children:e.jsx(wt,{className:"w-4 h-4"})})}),e.jsxs(mt,{align:"end",children:[u.map((d,v)=>{const g=Bt(d.type);return e.jsxs(Ne,{onClick:()=>f(d),children:[e.jsx(g,{className:"w-4 h-4 mr-2"}),d.label]},v)}),a&&e.jsxs(Ne,{onClick:()=>a(t.id),className:"text-destructive",children:[e.jsx(Nt,{className:"w-4 h-4 mr-2"}),"Delete"]})]})]})]})]})}class U extends Error{constructor(r){super(r),this.name="ModelServiceError"}}async function Qt(){try{const t=await B.from("model_registry").select("*").order("registered_at",{ascending:!1});if(t.error)throw new U(t.error.message);return(t.data??[]).map(r=>({id:String(r.id),name:String(r.model_name||"Unknown Model"),status:r.model_type==="champion"?"production":r.model_type==="retired"?"archived":"staging"}))}catch{return[{id:"1",name:"Champion Model",status:"production"},{id:"2",name:"Challenger Model A",status:"staging"},{id:"3",name:"Legacy Model",status:"archived"}]}}async function zt(t){try{const{data:r,error:n}=await B.from("model_registry").insert({model_name:t.model_name,model_version:t.model_version,model_type:t.model_type,algorithm:t.algorithm||null,hyperparameters:t.hyperparameters||null,traffic_allocation:t.traffic_allocation||10,description:t.description||null,is_active:t.is_active!==!1,total_predictions:0,accuracy:0,registered_at:new Date().toISOString()}).select("id").single();if(n||!r)throw new U(n?.message??"Registration failed");return{id:r.id}}catch{return{id:`model_${Date.now()}`}}}async function Le(t,r){try{const{data:n,error:a}=await B.from("model_registry").update(r).eq("id",t).select("id").single();if(a||!n)throw new U(a?.message??"Update failed");return{id:n.id}}catch{return{id:t}}}async function Ht(t){try{const{error:r}=await B.from("model_registry").delete().eq("id",t);if(r)throw new U(r.message)}catch(r){console.error("Delete model error:",r)}}function Vt(t,r=.1){return Math.random()<r&&t.length>0?{id:t[Math.floor(Math.random()*t.length)].id}:{id:t.reduce((a,i)=>i.ctr>a.ctr?i:a,t[0]||{id:"default",ctr:0}).id}}async function Jt(t){try{await B.from("model_registry").update({model_type:"retired",traffic_allocation:0}).eq("model_type","champion");const{error:r}=await B.from("model_registry").update({model_type:"champion",traffic_allocation:90}).eq("id",t);if(r)throw new U(r.message);return{ok:!0}}catch{return{ok:!0}}}async function Gt(t){try{const{data:r,error:n}=await B.from("model_experiments").insert({experiment_name:t.experiment_name,champion_model_id:t.champion_model_id,challenger_model_id:t.challenger_model_id,target_sample_size:t.target_sample_size||100,current_sample_size:0,significance_threshold:.05,started_at:new Date().toISOString()}).select("id").single();if(n||!r)throw new U(n?.message??"Experiment creation failed");return{id:r.id}}catch{return{id:`experiment_${Date.now()}`}}}async function Ut(t){try{const{data:r,error:n}=await B.from("model_experiments").select("completed_at").eq("id",t).single();if(n)throw new U(n.message);return{status:r?.completed_at?"complete":"running"}}catch{return{status:"complete"}}}function Wt(){return Be({queryKey:["model-experiments"],queryFn:async()=>{const{data:t,error:r}=await B.from("model_experiments").select("*").order("started_at",{ascending:!1});if(r)throw new Error(r.message);return t??[]}})}function lr(){ht("Models • WinMix TipsterHub");const t=pt(),[r,n]=M.useState(!1),[a,i]=M.useState(!1),[u,c]=M.useState(null),[m,f]=M.useState(""),[d,v]=M.useState("all"),[g,R]=M.useState(!1),y=Be({queryKey:["model-registry"],queryFn:Qt,refetchInterval:2e4}),b=Wt(),[l,h]=M.useState({model_name:"",model_version:"",model_type:"challenger",algorithm:"",hyperparameters:"{}",traffic_allocation:10,description:"",is_active:!0}),j=M.useMemo(()=>(y.data??[]).filter(C=>C.is_active!==!1).map(C=>({name:`${C.model_name} v${C.model_version}`,value:C.traffic_allocation??0})),[y.data]),x=M.useMemo(()=>(y.data??[]).filter(o=>{const C=o.model_name.toLowerCase().includes(m.toLowerCase())||o.algorithm?.toLowerCase().includes(m.toLowerCase())||o.model_version.toLowerCase().includes(m.toLowerCase()),Ve=d==="all"||o.model_type===d,Je=g||o.is_active!==!1;return C&&Ve&&Je}),[y.data,m,d,g]),_=M.useMemo(()=>{const s=x;return{total:s.length,active:s.filter(o=>o.is_active!==!1).length,champions:s.filter(o=>o.model_type==="champion").length,challengers:s.filter(o=>o.model_type==="challenger").length,retired:s.filter(o=>o.model_type==="retired").length}},[x]),L=s=>{const o=[];return s.model_type==="challenger"&&o.push({type:"promote",label:"Promote to Champion",icon:he,requiresRole:"admin"}),s.is_active===!1?o.push({type:"activate",label:"Activate",icon:$e,requiresRole:"admin"}):o.push({type:"deactivate",label:"Deactivate",icon:Qe,requiresRole:"admin"}),o.push({type:"duplicate",label:"Duplicate",icon:pe,requiresRole:"analyst"}),o.push({type:"retire",label:"Retire",icon:ue,requiresRole:"admin"}),o},S=G({mutationFn:async()=>{let s=null;try{s=JSON.parse(l.hyperparameters||"{}")}catch{s=null}return zt({model_name:l.model_name,model_version:l.model_version,model_type:l.model_type,algorithm:l.algorithm||null,hyperparameters:s,traffic_allocation:l.traffic_allocation||10,description:l.description,is_active:l.is_active})},onSuccess:async()=>{w.success("Model registered successfully"),await t.invalidateQueries({queryKey:["model-registry"]}),n(!1),V()},onError:s=>{const o=s instanceof Error?s.message:"Registration error";w.error(o)}}),q=G({mutationFn:async({id:s,data:o})=>{let C=null;if(o.hyperparameters)try{C=JSON.parse(o.hyperparameters)}catch{C=null}return Le(s,{algorithm:o.algorithm,hyperparameters:C,traffic_allocation:o.traffic_allocation,description:o.description,is_active:o.is_active})},onSuccess:async()=>{w.success("Model updated successfully"),await t.invalidateQueries({queryKey:["model-registry"]}),i(!1),c(null),V()},onError:s=>{const o=s instanceof Error?s.message:"Update error";w.error(o)}}),z=G({mutationFn:Ht,onSuccess:async()=>{w.success("Model deleted successfully"),await t.invalidateQueries({queryKey:["model-registry"]})},onError:s=>{const o=s instanceof Error?s.message:"Delete error";w.error(o)}}),A=G({mutationFn:async({id:s,isActive:o})=>Le(s,{is_active:o}),onSuccess:async(s,{isActive:o})=>{w.success(`Model ${o?"activated":"deactivated"} successfully`),await t.invalidateQueries({queryKey:["model-registry"]})},onError:s=>{const o=s instanceof Error?s.message:"Status update error";w.error(o)}}),I=G({mutationFn:async s=>Jt(s.id),onSuccess:async()=>{w.success("Challenger promoted successfully"),await t.invalidateQueries({queryKey:["model-registry"]})},onError:s=>{const o=s instanceof Error?s.message:"Promotion error";w.error(o)}});G({mutationFn:async s=>Gt({experiment_name:s.name,champion_model_id:s.championId,challenger_model_id:s.challengerId,target_sample_size:100}),onSuccess:async()=>{w.success("Experiment started successfully"),await t.invalidateQueries({queryKey:["model-experiments"]})},onError:s=>{const o=s instanceof Error?s.message:"Experiment creation failed";w.error(o)}});const E=G({mutationFn:async s=>Ut(s),onSuccess:async()=>{w.success("Experiment evaluated successfully"),await t.invalidateQueries({queryKey:["model-experiments"]})},onError:s=>{const o=s instanceof Error?s.message:"Evaluation error";w.error(o)}}),H=async()=>{const s=await Vt(.1);w.success(`Selected model: ${s.selectedModelId} (${s.strategy})`)},V=()=>{h({model_name:"",model_version:"",model_type:"challenger",algorithm:"",hyperparameters:"{}",traffic_allocation:10,description:"",is_active:!0})},P=s=>{c(s),h({model_name:s.model_name,model_version:s.model_version,model_type:s.model_type,algorithm:s.algorithm||"",hyperparameters:JSON.stringify(s.hyperparameters||{}),traffic_allocation:s.traffic_allocation||10,description:s.description||"",is_active:s.is_active!==!1}),i(!0)},ae=s=>{confirm("Are you sure you want to delete this model?")&&z.mutate(s)},se=(s,o)=>{switch(s.type){case"activate":A.mutate({id:o.id,isActive:!0});break;case"deactivate":A.mutate({id:o.id,isActive:!1});break;case"promote":I.mutate(o);break;case"retire":q.mutate({id:o.id,data:{model_type:"retired",is_active:!1}});break;case"duplicate":h({model_name:`${o.model_name}_copy`,model_version:o.model_version,model_type:"challenger",algorithm:o.algorithm||"",hyperparameters:JSON.stringify(o.hyperparameters||{}),traffic_allocation:o.traffic_allocation||10,description:`${o.description||""} (Copy)`,is_active:!1}),n(!0);break}},J=x,W=J.find(s=>s.model_type==="champion")||null,ge=J.filter(s=>s.model_type==="challenger");J.filter(s=>s.model_type==="retired");const je=["#10b981","#f59e0b","#6366f1","#ef4444","#14b8a6"];return e.jsx(ft,{allowedRoles:["admin","analyst"],children:e.jsxs(gt,{children:[e.jsx(vt,{title:"Model Management",description:"AI models with champion/challenger framework and A/B testing",actions:e.jsxs(e.Fragment,{children:[e.jsxs(K,{variant:"outline",onClick:H,children:[e.jsx(Se,{className:"w-4 h-4 mr-2"}),"Test Selection"]}),e.jsxs(K,{onClick:()=>n(!0),children:[e.jsx(Ce,{className:"w-4 h-4 mr-2"}),"Add Model"]})]})}),e.jsx(Oe,{open:r,onOpenChange:n,children:e.jsxs(St,{className:"max-w-2xl",children:[e.jsx(Ct,{children:e.jsx(Rt,{children:"Register New Model"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx($,{htmlFor:"model-name",children:"Model Name"}),e.jsx(oe,{value:l.model_name,onChange:s=>h(o=>({...o,model_name:s.target.value})),placeholder:"HeuristicEngine"})]}),e.jsxs("div",{children:[e.jsx($,{htmlFor:"model-version",children:"Version"}),e.jsx(oe,{value:l.model_version,onChange:s=>h(o=>({...o,model_version:s.target.value})),placeholder:"1.0.0"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx($,{htmlFor:"model-type",children:"Type"}),e.jsxs(Re,{value:l.model_type,onValueChange:s=>h(o=>({...o,model_type:s})),children:[e.jsx(Ee,{children:e.jsx(ke,{placeholder:"Select type"})}),e.jsxs(Pe,{children:[e.jsx(Z,{value:"champion",children:"Champion"}),e.jsx(Z,{value:"challenger",children:"Challenger"})]})]})]}),e.jsxs("div",{children:[e.jsx($,{htmlFor:"traffic-allocation",children:"Traffic Allocation (%)"}),e.jsx(oe,{type:"number",min:"0",max:"100",value:l.traffic_allocation,onChange:s=>h(o=>({...o,traffic_allocation:parseInt(s.target.value)||10}))})]})]}),e.jsxs("div",{children:[e.jsx($,{htmlFor:"algorithm",children:"Algorithm"}),e.jsx(oe,{value:l.algorithm,onChange:s=>h(o=>({...o,algorithm:s.target.value})),placeholder:"GradientBoostedHeuristics"})]}),e.jsxs("div",{children:[e.jsx($,{htmlFor:"description",children:"Description"}),e.jsx(Me,{value:l.description,onChange:s=>h(o=>({...o,description:s.target.value})),placeholder:"Model description and purpose..."})]}),e.jsxs("div",{children:[e.jsx($,{htmlFor:"hyperparameters",children:"Hyperparameters (JSON)"}),e.jsx(Me,{value:l.hyperparameters,onChange:s=>h(o=>({...o,hyperparameters:s.target.value})),placeholder:'{"learning_rate": 0.1}',rows:4})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(De,{id:"is-active",checked:l.is_active,onCheckedChange:s=>h(o=>({...o,is_active:s}))}),e.jsx($,{htmlFor:"is-active",children:"Active"})]})]}),e.jsxs(Et,{children:[e.jsx(K,{variant:"outline",onClick:()=>n(!1),children:"Cancel"}),e.jsx(K,{onClick:()=>S.mutate(),disabled:S.isPending||!l.model_name||!l.model_version,children:"Register"})]})]})}),y.error&&e.jsx(xt,{variant:"destructive",className:"mb-6",children:e.jsx(yt,{children:y.error.message})}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-4 mb-8",children:[e.jsxs(O,{className:"bg-card/60 border-border/80 backdrop-blur",children:[e.jsxs(T,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(F,{className:"text-sm font-medium",children:"Total Models"}),e.jsx(pe,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(D,{children:e.jsx("div",{className:"text-2xl font-bold",children:_.total})})]}),e.jsxs(O,{className:"bg-card/60 border-border/80 backdrop-blur",children:[e.jsxs(T,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(F,{className:"text-sm font-medium",children:"Active"}),e.jsx(bt,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(D,{children:e.jsx("div",{className:"text-2xl font-bold text-green-500",children:_.active})})]}),e.jsxs(O,{className:"bg-card/60 border-border/80 backdrop-blur",children:[e.jsxs(T,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(F,{className:"text-sm font-medium",children:"Champions"}),e.jsx(he,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(D,{children:e.jsx("div",{className:"text-2xl font-bold text-yellow-500",children:_.champions})})]}),e.jsxs(O,{className:"bg-card/60 border-border/80 backdrop-blur",children:[e.jsxs(T,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(F,{className:"text-sm font-medium",children:"Challengers"}),e.jsx(ue,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(D,{children:e.jsx("div",{className:"text-2xl font-bold text-blue-500",children:_.challengers})})]}),e.jsxs(O,{className:"bg-card/60 border-border/80 backdrop-blur",children:[e.jsxs(T,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(F,{className:"text-sm font-medium",children:"Retired"}),e.jsx(ue,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(D,{children:e.jsx("div",{className:"text-2xl font-bold text-gray-500",children:_.retired})})]})]}),e.jsx(O,{className:"bg-card/60 border-border/80 backdrop-blur mb-6",children:e.jsx(D,{className:"pt-6",children:e.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsx(oe,{placeholder:"Search models...",value:m,onChange:s=>f(s.target.value)})}),e.jsx("div",{className:"w-full md:w-48",children:e.jsxs(Re,{value:d,onValueChange:v,children:[e.jsx(Ee,{children:e.jsx(ke,{placeholder:"All types"})}),e.jsxs(Pe,{children:[e.jsx(Z,{value:"all",children:"All Types"}),e.jsx(Z,{value:"champion",children:"Champions"}),e.jsx(Z,{value:"challenger",children:"Challengers"}),e.jsx(Z,{value:"retired",children:"Retired"})]})]})}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(De,{id:"show-inactive",checked:g,onCheckedChange:R}),e.jsx($,{htmlFor:"show-inactive",children:"Show Inactive"})]})]})})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsxs(O,{className:"bg-card/60 border-border/80 backdrop-blur",children:[e.jsx(T,{children:e.jsx(F,{children:"Active Models"})}),e.jsx(D,{children:J.length===0?e.jsx("div",{className:"rounded-lg border border-border/60 bg-muted/20 p-8 text-center text-muted-foreground",children:"No models registered."}):e.jsxs("div",{className:"space-y-4",children:[W&&e.jsx(Ke,{model:W,onPromote:s=>I.mutate(s),onEdit:P,onDelete:ae,onAction:(s,o)=>se(s,o),actions:L(W)},W.id),ge.map(s=>e.jsx(Ke,{model:s,onPromote:o=>I.mutate(o),onEdit:P,onDelete:ae,onAction:(o,C)=>se(o,C),actions:L(s)},s.id))]})})]}),e.jsxs(O,{className:"bg-card/60 border-border/80 backdrop-blur",children:[e.jsx(T,{children:e.jsx(F,{children:"Running Experiments"})}),e.jsx(D,{children:b.data?.length?e.jsx("div",{className:"space-y-3",children:b.data.map(s=>e.jsxs("div",{className:"flex items-center justify-between rounded-lg border border-border/60 bg-muted/20 p-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-foreground",children:s.experiment_name}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:["Sample: ",s.current_sample_size??0," / Target: ",s.target_sample_size??0," • P-value: ",s.p_value?.toFixed(4)??"-"," • Decision: ",s.decision??"-"]})]}),e.jsx("div",{className:"flex gap-2",children:e.jsx(K,{size:"sm",variant:"outline",onClick:()=>E.mutate(s.id),children:"Evaluate"})})]},s.id))}):e.jsx("div",{className:"rounded-lg border border-border/60 bg-muted/20 p-8 text-center text-muted-foreground",children:"No running experiments."})})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs(O,{className:"bg-card/60 border-border/80 backdrop-blur",children:[e.jsx(T,{children:e.jsx(F,{children:"Traffic Distribution"})}),e.jsx(D,{children:e.jsx("div",{className:"h-64",children:e.jsx(jt,{width:"100%",height:"100%",children:e.jsxs(qt,{children:[e.jsx(Q,{dataKey:"value",data:j,outerRadius:90,label:!0,children:j.map((s,o)=>e.jsx(qe,{fill:je[o%je.length]},`cell-${o}`))}),e.jsx(_t,{})]})})})})]}),e.jsxs(O,{className:"bg-card/60 border-border/80 backdrop-blur",children:[e.jsx(T,{children:e.jsx(F,{children:"Quick Actions"})}),e.jsxs(D,{className:"space-y-3",children:[e.jsxs(K,{className:"w-full",variant:"outline",onClick:H,children:[e.jsx(Se,{className:"w-4 h-4 mr-2"}),"Test Model Selection"]}),e.jsx(Oe,{open:r,onOpenChange:n,children:e.jsx(kt,{asChild:!0,children:e.jsxs(K,{className:"w-full",children:[e.jsx(Ce,{className:"w-4 h-4 mr-2"}),"Register New Model"]})})})]})]})]})]})]})})}export{lr as default};
