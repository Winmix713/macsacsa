import{r as c,j as e,a7 as _,ae as M,af as C,ag as $,a8 as z,B as E,w as f}from"./index-GAVc2OtO.js";import{u}from"./useQuery-CV8yfldm.js";import{W as h}from"./MetricCard-BL-gbWy8.js";import{W as F,a as L}from"./Page-DSh5UTtd.js";import{L as P,a as x}from"./LineChart-CVsL2fgA.js";const W={champion:"Champion",challenger:"Challenger",shadow:"Shadow",retired:"Retired"},D={champion:"bg-emerald-500/10 text-emerald-200",challenger:"bg-sky-500/10 text-sky-200",shadow:"bg-white/10 text-white/70",retired:"bg-white/10 text-white/70"},g=(s,a=1)=>typeof s!="number"?"—":`${s.toFixed(a)}%`,K=s=>{if(!s)return"—";const a=new Date(s);return Number.isNaN(a.getTime())?"—":new Intl.DateTimeFormat("hu-HU",{year:"numeric",month:"2-digit",day:"2-digit"}).format(a)},R=async()=>{const{data:s,error:a}=await f.functions.invoke("models-performance",{method:"GET"});if(a||!s)throw new Error(a?.message??"Nem sikerült betölteni a modell teljesítmény adatokat");return s},S=async()=>{const{data:s,error:a}=await f.from("model_registry").select("*").order("registered_at",{ascending:!1});if(a)throw new Error(a.message??"Nem sikerült betölteni a model registry-t");return s??[]},H=()=>{const s=u({queryKey:["winmixpro","models","performance"],queryFn:R,refetchInterval:6e4}),a=u({queryKey:["winmixpro","models","registry"],queryFn:S,refetchInterval:6e4}),o=s.data,r=a.data??[],d=c.useMemo(()=>r.find(t=>t.model_type==="champion"),[r]),l=c.useMemo(()=>r.filter(t=>t.model_type==="challenger").sort((t,i)=>(i.accuracy??0)-(t.accuracy??0))[0],[r]),y=c.useMemo(()=>r.filter(t=>t.model_type==="shadow").reduce((t,i)=>t+(i.total_predictions??0),0),[r]),j=c.useMemo(()=>o?(o.timeseries??[]).map(t=>({week:t.date,champion:Math.round(t.overall??0),challenger:Math.round(t.home_win??0),market:Math.round(t.away_win??0)})):[],[o]),w=c.useMemo(()=>[...r].sort((t,i)=>(i.accuracy??0)-(t.accuracy??0)),[r]),m=d?.accuracy??null,n=m!==null&&l?.accuracy!==void 0?(l.accuracy??0)-m:null,b=s.isLoading||a.isLoading,N=s.isError||a.isError;return e.jsx(F,{title:"Model vezérlő",description:"Champion vs challenger teljesítmények, piaci összevetés és trafikelosztás – valós Supabase adatokkal.",children:b?e.jsx(L,{}):N?e.jsxs("div",{className:"rounded-3xl border border-rose-500/30 bg-rose-500/10 p-6 text-rose-100",children:[e.jsx("p",{className:"font-semibold",children:"Nem sikerült betölteni a modell adatokat."}),e.jsx("p",{className:"mt-2 text-sm opacity-80",children:s.error?.message??a.error?.message??"Ismeretlen hiba"})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:[e.jsx(h,{label:"Champion pontosság",value:g(m),hint:d?`${d.model_name} v${d.model_version}`:"Nincs champion",trend:o?`${o.summary.total_predictions} predikció`:"—",intent:"positive"}),e.jsx(h,{label:"Challenger difi",value:n!==null?`${n.toFixed(2)}%`:"—",hint:l?`${l.model_name} v${l.model_version}`:"Nincs challenger",trend:n!==null?n>=0?"Közelít":"Elmarad":"",intent:n!==null&&n<0?"warning":"neutral"}),e.jsx(h,{label:"Shadow logok",value:y.toLocaleString("hu-HU"),hint:"Összesített futások",trend:`${r.filter(t=>t.model_type==="shadow").length} shadow modell`,intent:"neutral"})]}),e.jsxs("div",{className:"rounded-3xl border border-white/10 bg-black/50 p-6",children:[e.jsxs("div",{className:"flex flex-col gap-3 lg:flex-row lg:items-center lg:justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs uppercase tracking-[0.4em] text-white/40",children:"Pontosság trend"}),e.jsx("p",{className:"text-lg font-semibold text-white",children:"Hét napos csúszó átlag"})]}),e.jsxs("div",{className:"flex gap-4 text-xs text-white/70",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"h-2 w-8 rounded-full bg-emerald-400"})," Champion"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"h-2 w-8 rounded-full bg-sky-400"})," Challenger"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"h-2 w-8 rounded-full bg-white/60"})," Piaci baseline"]})]})]}),e.jsx("div",{className:"mt-4 h-64",children:e.jsx(_,{width:"100%",height:"100%",children:e.jsxs(P,{data:j,children:[e.jsx(M,{strokeDasharray:"3 3",stroke:"#ffffff10"}),e.jsx(C,{dataKey:"week",stroke:"#94a3b8",fontSize:12}),e.jsx($,{domain:[0,100],stroke:"#94a3b8",fontSize:12,tickFormatter:t=>`${t}%`}),e.jsx(z,{contentStyle:{background:"rgba(2,6,23,0.95)",borderRadius:12}}),e.jsx(x,{type:"monotone",dataKey:"champion",stroke:"#34d399",strokeWidth:2.5,dot:!1}),e.jsx(x,{type:"monotone",dataKey:"challenger",stroke:"#38bdf8",strokeWidth:2.5,dot:!1}),e.jsx(x,{type:"monotone",dataKey:"market",stroke:"#e2e8f0",strokeDasharray:"5 5",strokeWidth:2,dot:!1})]})})})]}),e.jsx("div",{className:"grid gap-4 md:grid-cols-2",children:w.map(t=>{const i=W[t.model_type]??t.model_type,k=D[t.model_type]??"bg-white/10 text-white",p=t.traffic_allocation??0,v=t.accuracy??0;return e.jsxs("div",{className:"rounded-3xl border border-white/10 bg-white/5 p-5",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-lg font-semibold text-white",children:t.model_name}),e.jsxs("p",{className:"text-xs uppercase tracking-[0.45em] text-white/40",children:["v",t.model_version]})]}),e.jsx(E,{className:k,children:i})]}),e.jsxs("div",{className:"mt-4 grid gap-4 text-sm text-white/80 lg:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs uppercase text-white/50",children:"Pontosság"}),e.jsx("p",{className:"text-xl font-semibold text-white",children:g(v)}),e.jsxs("p",{className:"text-xs text-white/60",children:["Futások: ",t.total_predictions??0]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs uppercase text-white/50",children:"Regisztráció"}),e.jsx("p",{className:"text-sm text-white",children:K(t.registered_at)}),e.jsxs("p",{className:"text-xs text-white/60",children:["Forgalom: ",p,"%"]})]})]}),e.jsx("div",{className:"mt-4 h-2 rounded-full bg-white/10",children:e.jsx("div",{className:"h-full rounded-full bg-gradient-to-r from-emerald-400 to-cyan-400",style:{width:`${Math.min(p,100)}%`}})})]},t.id)})})]})})};export{H as default};
