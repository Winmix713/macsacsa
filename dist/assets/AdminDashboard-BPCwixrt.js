import{bk as S,bl as C,bm as k,bn as Q,am as q,r as p,bo as M,j as l,C as L,a as N,b as A,z as D,c as P,aO as _,x as H,bp as T,bq as z,br as F,U as I,J as U,bs as B,bt as J,w as K}from"./index-GAVc2OtO.js";import{Q as E,a as W,b as G,e as V,c as $,d as X,s as R,f as O,w as Y,g as Z}from"./useQuery-CV8yfldm.js";import{A as ee}from"./AdminLayout-BhVK5JeJ.js";import{u as se}from"./useJobs-BaphaOCq.js";import{u as te}from"./usePhase9Settings-8kKlxO1R.js";import{W as re}from"./workflow-PVWcfWK5.js";import{C as ie}from"./cpu-C0sgczmA.js";import{D as oe}from"./database-CX9CnqQc.js";import"./sheet-DgW-QWTQ.js";import"./index-DD5cTla9.js";import"./useMutation-C-Rbfrtn.js";import"./useAuditLog-DaCpHk4g.js";function j(e,s){const t=new Set(s);return e.filter(r=>!t.has(r))}function ne(e,s,t){const r=e.slice(0);return r[s]=t,r}var ae=class extends S{#r;#e;#i;#o;#s;#t;#n;#a;#l=[];constructor(e,s,t){super(),this.#r=e,this.#o=t,this.#i=[],this.#s=[],this.#e=[],this.setQueries(s)}onSubscribe(){this.listeners.size===1&&this.#s.forEach(e=>{e.subscribe(s=>{this.#h(e,s)})})}onUnsubscribe(){this.listeners.size||this.destroy()}destroy(){this.listeners=new Set,this.#s.forEach(e=>{e.destroy()})}setQueries(e,s){this.#i=e,this.#o=s,C.batch(()=>{const t=this.#s,r=this.#d(this.#i);this.#l=r,r.forEach(n=>n.observer.setOptions(n.defaultedQueryOptions));const i=r.map(n=>n.observer),a=i.map(n=>n.getCurrentResult()),o=t.length!==i.length,d=i.some((n,u)=>n!==t[u]),h=o||d,b=h?!0:a.some((n,u)=>{const g=this.#e[u];return!g||!k(n,g)});!h&&!b||(h&&(this.#s=i),this.#e=a,this.hasListeners()&&(h&&(j(t,i).forEach(n=>{n.destroy()}),j(i,t).forEach(n=>{n.subscribe(u=>{this.#h(n,u)})})),this.#m()))})}getCurrentResult(){return this.#e}getQueries(){return this.#s.map(e=>e.getCurrentQuery())}getObservers(){return this.#s}getOptimisticResult(e,s){const t=this.#d(e),r=t.map(i=>i.observer.getOptimisticResult(i.defaultedQueryOptions));return[r,i=>this.#c(i??r,s),()=>this.#u(r,t)]}#u(e,s){return s.map((t,r)=>{const i=e[r];return t.defaultedQueryOptions.notifyOnChangeProps?i:t.observer.trackResult(i,a=>{s.forEach(o=>{o.observer.trackProp(a)})})})}#c(e,s){return s?((!this.#t||this.#e!==this.#a||s!==this.#n)&&(this.#n=s,this.#a=this.#e,this.#t=Q(this.#t,s(e))),this.#t):e}#d(e){const s=new Map;this.#s.forEach(r=>{const i=r.options.queryHash;if(!i)return;const a=s.get(i);a?a.push(r):s.set(i,[r])});const t=[];return e.forEach(r=>{const i=this.#r.defaultQueryOptions(r),o=s.get(i.queryHash)?.shift()??new E(this.#r,i);t.push({defaultedQueryOptions:i,observer:o})}),t}#h(e,s){const t=this.#s.indexOf(e);t!==-1&&(this.#e=ne(this.#e,t,s),this.#m())}#m(){if(this.hasListeners()){const e=this.#t,s=this.#u(this.#e,this.#l),t=this.#c(s,this.#o?.combine);e!==t&&C.batch(()=>{this.listeners.forEach(r=>{r(this.#e)})})}}};function le({queries:e,...s},t){const r=q(),i=W(),a=G(),o=p.useMemo(()=>e.map(c=>{const f=r.defaultQueryOptions(c);return f._optimisticResults=i?"isRestoring":"optimistic",f}),[e,r,i]);o.forEach(c=>{V(c),$(c,a)}),X(a);const[d]=p.useState(()=>new ae(r,o,s)),[h,b,n]=d.getOptimisticResult(o,s.combine),u=!i&&s.subscribed!==!1;p.useSyncExternalStore(p.useCallback(c=>u?d.subscribe(C.batchCalls(c)):M,[d,u]),()=>d.getCurrentResult(),()=>d.getCurrentResult()),p.useEffect(()=>{d.setQueries(o,s)},[o,s,d]);const v=h.some((c,f)=>R(o[f],c))?h.flatMap((c,f)=>{const m=o[f];if(m){const w=new E(r,m);if(R(m,c))return O(m,w,a);Y(c,i)&&O(m,w,a)}return[]}):[];if(v.length>0)throw Promise.all(v);const x=h.find((c,f)=>{const m=o[f];return m&&Z({result:c,errorResetBoundary:a,throwOnError:m.throwOnError,query:r.getQueryCache().get(m.queryHash),suspense:m.suspense})});if(x?.error)throw x.error;return b(n())}const ue=e=>e==null?"â€“":typeof e=="number"?new Intl.NumberFormat().format(e):e;function ce({card:e}){return l.jsxs(L,{className:"relative overflow-hidden border-border/60 bg-gradient-to-br shadow-sm transition hover:shadow-md",children:[l.jsx("div",{className:`pointer-events-none absolute inset-0 opacity-80 ${e.accentColorClass}`}),l.jsx(N,{className:"relative z-10",children:l.jsxs("div",{className:"flex items-center justify-between",children:[l.jsxs("div",{children:[l.jsxs(A,{className:"flex items-center gap-2 text-lg font-semibold",children:[l.jsx(e.icon,{className:"h-5 w-5"}),e.title]}),l.jsx(D,{children:e.description})]}),e.pill?l.jsx("span",{className:"rounded-full bg-background/70 px-3 py-1 text-xs font-semibold uppercase tracking-wide text-foreground",children:e.pill}):null]})}),l.jsx(P,{className:"relative z-10 flex items-end justify-between",children:l.jsx("span",{className:"text-3xl font-semibold text-foreground",children:ue(e.value)})}),l.jsx(_,{className:"relative z-10",children:l.jsx(H,{asChild:!0,variant:"outline",className:"h-11 hover:bg-background/60",children:l.jsx(T,{to:e.href,children:"Open"})})})]})}const y=async e=>{const{count:s,error:t}=await K.from(e).select("id",{count:"exact",head:!0});if(t){if(t.code==="42P01")return null;throw t}return s??0},Re=()=>{const e=le({queries:[{queryKey:["admin","counts","users"],queryFn:()=>y("user_profiles"),staleTime:6e4},{queryKey:["admin","counts","models"],queryFn:()=>y("models"),staleTime:6e4},{queryKey:["admin","counts","matches"],queryFn:()=>y("matches"),staleTime:6e4}]}),s=e[0]?.data??null,t=e[1]?.data??null,r=e[2]?.data??null,{jobs:i,isLoading:a}=se({refetchInterval:6e4}),{settings:o}=te(),{profile:d}=z(),h=d?.role??"user",b=p.useMemo(()=>a?null:i.filter(u=>u.last_log?.status==="running").length,[i,a]),n=p.useMemo(()=>[{id:"dashboard-overview",title:"System Overview",description:"Health indicators across the platform",href:"/admin",icon:F,accentColorClass:"from-sky-500/10 to-sky-500/5",value:"Live",pill:"Realtime"},{id:"users",title:"Users & Roles",description:"Invite, promote and revoke access",href:"/admin/users",icon:I,accentColorClass:"from-emerald-500/10 to-emerald-500/5",value:s,allowedRoles:["admin"]},{id:"jobs",title:"Running Jobs",description:"Manage automation lifecycle",href:"/admin/jobs",icon:re,accentColorClass:"from-amber-500/10 to-amber-500/5",value:b},{id:"models",title:"AI & Predictions",description:"Model activity and performance",href:"/models",icon:U,accentColorClass:"from-purple-500/10 to-purple-500/5",value:t},{id:"model-status",title:"Model Control Center",description:"ML model management & analytics",href:"/admin/model-status",icon:B,accentColorClass:"from-blue-500/10 to-blue-500/5",value:"Dashboard",pill:"Live",allowedRoles:["admin","analyst"]},{id:"phase9",title:"Phase 9",description:"Collaborative intelligence controls",href:"/admin/phase9",icon:ie,accentColorClass:"from-fuchsia-500/10 to-fuchsia-500/5",value:o?o.collaborative_intelligence_enabled?"Enabled":"Disabled":null,pill:o?.market_integration_mode?o.market_integration_mode.toUpperCase():void 0},{id:"database",title:"Database & Content",description:"Curate data sources and feeds",href:"/admin/database",icon:oe,accentColorClass:"from-indigo-500/10 to-indigo-500/5",value:r,allowedRoles:["admin"]},{id:"system",title:"System",description:"Security, compliance, and auditing",href:"/admin/security",icon:J,accentColorClass:"from-slate-500/10 to-slate-500/5",value:"Coming soon"}].filter(u=>!u.allowedRoles||u.allowedRoles.includes(h)),[s,b,t,r,o,h]);return l.jsx(ee,{title:"Admin Dashboard",description:"High-level overview of accounts, automations, and experimental systems.",breadcrumbs:[{label:"Admin",href:"/admin"},{label:"Dashboard"}],children:l.jsx("section",{className:"grid grid-cols-1 gap-6 md:grid-cols-2 xl:grid-cols-3",children:n.map(u=>l.jsx(ce,{card:u},u.id))})})};export{Re as default};
