import{u as m}from"./useQuery-CWzqJKQX.js";import{am as y,an as n,w as l}from"./index-oF1ARjuv.js";import{u as d}from"./useMutation-DOyzXJwO.js";import{u as g}from"./useAuditLog-FQX88GHc.js";const i=["admin","jobs"],p=async()=>{const{data:e,error:s}=await l.functions.invoke("jobs-list");if(s)throw new Error(s.message??"Failed to load jobs");return e?.jobs??[]},b=async e=>{const{data:s,error:a}=await l.functions.invoke("jobs-manager",{body:e});if(a)throw new Error(a.message??"Jobs manager call failed");return s},J=(e={})=>{const{log:s}=g(),a=y(),r=m({queryKey:i,queryFn:p,refetchInterval:e.refetchInterval??45e3,enabled:e.enabled??!0}),u=d({mutationFn:async t=>b({action:"start",jobName:t}),onSuccess:async(t,o)=>{n.success(`Job "${o}" started`),await s("job_started",{jobName:o,jobId:t.job?.id??t.jobId??null}),await a.invalidateQueries({queryKey:i})},onError:(t,o)=>{n.error(`Failed to start job "${o}": ${t.message}`)}}),c=d({mutationFn:async t=>b({action:"stop",jobId:t}),onSuccess:async(t,o)=>{n.success("Job stopped"),await s("job_stopped",{jobId:o,status:t.status??null}),await a.invalidateQueries({queryKey:i})},onError:t=>{n.error(`Failed to stop job: ${t.message}`)}});return{jobs:r.data??[],isLoading:r.isLoading,isFetching:r.isFetching,error:r.error,refetch:r.refetch,startJob:u.mutateAsync,stopJob:c.mutateAsync,isStarting:u.isPending,isStopping:c.isPending}};export{J as u};
