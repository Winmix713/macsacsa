import{j as e,C as z,a as V,b as U,B as ze,f as ee,c as M,aO as ot,x as E,L as fe,aP as at,aQ as lt,aR as it,aS as ct,aT as Ee,aM as Me,r as l,t as Y,aU as dt,o as ut,P as te,s as ae,q as J,aV as O,v as mt,aW as ht,aA as xt,aB as ft,aC as Pe,aD as K,aE as bt,aF as Q,ah as pt,am as gt,an as _,w as I,aj as jt,ao as vt,ai as wt,ak as St,ab as yt,ar as Nt,ap as N,as as G,at as de,au as ue,av as me,aw as he,az as re,aq as Re,ax as Ct,aX as _t,l as Et,J as Pt,A as Rt,n as Tt}from"./index-B-k02BhT.js";import{u as Te}from"./useQuery-DIgGmLU4.js";import{u as Z}from"./useMutation-DADJpn4h.js";import{S as se}from"./switch-DoRKzTrT.js";import{F as kt}from"./file-text-9O1qu9i7.js";import{E as At}from"./ellipsis-DG2IhM1s.js";import{S as Dt}from"./square-pen-BqRwUXyk.js";import{T as Ft}from"./trash-2-B5CMc0Sj.js";import{f as Lt}from"./formatDistanceToNow-g3X1UfuJ.js";import{D as be,b as pe,c as ge,d as je,e as zt,f as ke}from"./dialog-BRg3KzBr.js";import{P as Mt}from"./pause-Bhy9AX8v.js";import"./index-C-SYJfLg.js";const Ot={fetch_upcoming_fixtures:"Közelgő mérkőzések frissítése",run_daily_predictions:"Napi predikció futtatás",update_team_stats:"Csapat statisztika frissítés",cleanup_old_logs:"Régi logok karbantartása"};function Jt(t){if(!t.enabled)return{label:"Kikapcsolva",variant:"disabled"};const r=t.last_log?.status;return r==="running"?{label:"Fut",variant:"warning"}:r==="error"?{label:"Hiba",variant:"error"}:t.is_due?{label:"Futás esedékes",variant:"warning"}:r==="success"?{label:"Sikeres",variant:"success"}:{label:"Várakozik",variant:"info"}}function It(t){switch(t){case"success":return"bg-emerald-500/15 text-emerald-500 border border-emerald-500/30";case"warning":return"bg-amber-500/15 text-amber-500 border border-amber-500/30";case"error":return"bg-rose-500/15 text-rose-500 border border-rose-500/30";case"disabled":return"bg-muted text-muted-foreground";default:return"bg-primary/10 text-primary border border-primary/30"}}function Ae(t,r="N/A"){if(!t)return r;try{return Me(new Date(t),"yyyy.MM.dd. HH:mm")}catch(n){return console.error("Failed to format date",t,n),r}}function Ht(t){if(!t)return"Még nem futott";try{return Lt(new Date(t),{addSuffix:!0})}catch(r){return console.error("Failed to format distance",t,r),"Ismeretlen"}}function De(t){if(!t||t<=0)return"-";if(t<1e3)return`${t} ms`;const r=t/1e3;if(r<60)return`${r.toFixed(1)} mp`;const n=Math.floor(r/60),a=Math.round(r%60);return`${n} p ${a} mp`}function Wt(t){if(!t||t.total_runs===0)return"-";const r=t.success_runs/t.total_runs*100;return`${Math.round(r)}%`}function Bt(t){return t.split("_").map(r=>r[0]?.toUpperCase()+r.slice(1)).join(" ")}function Vt(t){return Ot[t.job_name]??t.job_name.split("_").map(r=>r[0]?.toUpperCase()+r.slice(1)).join(" ")}function Ut(t){const r=t.config?.description;return typeof r=="string"&&r.length>0?r:"Automatizált háttérfeladat"}function Xt({job:t,onToggle:r,onRun:n,onViewLogs:a,onEdit:o,onDelete:c,isToggling:i,isRunning:d}){const m=Jt(t),f=It(m.variant),h=Wt(t.stats);return e.jsxs(z,{"data-testid":"job-card",className:"bg-card/60 border-border/80 backdrop-blur",children:[e.jsxs(V,{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(U,{className:"text-lg font-semibold text-foreground",children:Vt(t)}),e.jsx("p",{className:"text-sm text-muted-foreground max-w-xl",children:Ut(t)})]}),e.jsx(ze,{className:ee("uppercase text-[11px] font-semibold tracking-wide",f),children:m.label})]}),e.jsxs("div",{className:"flex items-center gap-3 text-sm text-muted-foreground",children:[e.jsx("span",{className:"rounded-full bg-muted/60 px-3 py-1 text-xs font-medium uppercase tracking-wide",children:Bt(t.job_type)}),e.jsxs("div",{className:"flex items-center gap-2 text-xs",children:[e.jsx("span",{children:"Utolsó futás:"}),e.jsx("span",{className:"text-foreground font-medium",children:Ht(t.last_run_at)})]})]})]}),e.jsxs(M,{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{className:"rounded-lg border border-border/60 bg-muted/20 p-4 space-y-2",children:[e.jsx("p",{className:"text-xs text-muted-foreground uppercase tracking-wide",children:"Következő tervezett futás"}),e.jsx("p",{className:"font-medium text-foreground",children:Ae(t.next_run_at,t.enabled?"Ütemezés alatt":"Kikapcsolva")}),t.is_due&&t.enabled&&e.jsx("p",{className:"text-xs text-amber-500",children:"Az ütemezett időpont elérkezett – a job futtatásra vár."})]}),e.jsxs("div",{className:"rounded-lg border border-border/60 bg-muted/20 p-4 space-y-2",children:[e.jsx("p",{className:"text-xs text-muted-foreground uppercase tracking-wide",children:"Teljesítmény"}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground text-xs",children:"Sikerarány"}),e.jsx("p",{className:"font-medium text-foreground",children:h})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground text-xs",children:"Átlagos futási idő"}),e.jsx("p",{className:"font-medium text-foreground",children:De(t.average_duration_ms)})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-muted-foreground text-xs",children:"Futások száma"}),e.jsx("p",{className:"font-medium text-foreground",children:t.stats.total_runs})]})]}),t.last_log&&t.last_log.status!=="running"&&e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Utolsó futás: ",t.last_log.records_processed??0," rekord feldolgozva ",t.last_log.duration_ms?`(${De(t.last_log.duration_ms)})`:""]})]})]}),e.jsx("div",{className:"flex items-center justify-between gap-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(se,{"data-testid":"job-toggle",checked:t.enabled,disabled:i||d,onCheckedChange:b=>r(b)}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-foreground",children:"Automatikus futtatás"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:t.enabled?"A job az ütemezés szerint fut.":"A job jelenleg kézi futtatásra vár."})]})]})})]}),e.jsxs(ot,{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx(E,{size:"sm",onClick:n,disabled:d||i,className:"inline-flex items-center gap-2",children:d?e.jsxs(e.Fragment,{children:[e.jsx(fe,{className:"w-4 h-4 animate-spin"}),"Running..."]}):e.jsxs(e.Fragment,{children:[e.jsx(at,{className:"w-4 h-4"}),"Run Now"]})}),e.jsxs(E,{size:"sm",variant:"outline",onClick:a,className:"inline-flex items-center gap-2",children:[e.jsx(kt,{className:"w-4 h-4"}),"View Logs"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[(o||c)&&e.jsxs(lt,{children:[e.jsx(it,{asChild:!0,children:e.jsx(E,{variant:"ghost",size:"sm",children:e.jsx(At,{className:"w-4 h-4"})})}),e.jsxs(ct,{align:"end",children:[o&&e.jsxs(Ee,{onClick:o,children:[e.jsx(Dt,{className:"w-4 h-4 mr-2"}),"Edit"]}),c&&e.jsxs(Ee,{onClick:c,className:"text-destructive",children:[e.jsx(Ft,{className:"w-4 h-4 mr-2"}),"Delete"]})]})]}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:["Last updated: ",Ae(t.last_log?.started_at??null,"No data")]})]})]})]})}function Yt(t,r){return l.useReducer((n,a)=>r[n][a]??n,t)}var ve="ScrollArea",[Oe]=ut(ve),[qt,C]=Oe(ve),Je=l.forwardRef((t,r)=>{const{__scopeScrollArea:n,type:a="hover",dir:o,scrollHideDelay:c=600,...i}=t,[d,m]=l.useState(null),[f,h]=l.useState(null),[b,x]=l.useState(null),[p,S]=l.useState(null),[P,q]=l.useState(null),[y,H]=l.useState(0),[D,W]=l.useState(0),[v,A]=l.useState(!1),[F,B]=l.useState(!1),g=Y(r,k=>m(k)),w=dt(o);return e.jsx(qt,{scope:n,type:a,dir:w,scrollHideDelay:c,scrollArea:d,viewport:f,onViewportChange:h,content:b,onContentChange:x,scrollbarX:p,onScrollbarXChange:S,scrollbarXEnabled:v,onScrollbarXEnabledChange:A,scrollbarY:P,onScrollbarYChange:q,scrollbarYEnabled:F,onScrollbarYEnabledChange:B,onCornerWidthChange:H,onCornerHeightChange:W,children:e.jsx(te.div,{dir:w,...i,ref:g,style:{position:"relative","--radix-scroll-area-corner-width":y+"px","--radix-scroll-area-corner-height":D+"px",...t.style}})})});Je.displayName=ve;var Ie="ScrollAreaViewport",He=l.forwardRef((t,r)=>{const{__scopeScrollArea:n,children:a,nonce:o,...c}=t,i=C(Ie,n),d=l.useRef(null),m=Y(r,d,i.onViewportChange);return e.jsxs(e.Fragment,{children:[e.jsx("style",{dangerouslySetInnerHTML:{__html:"[data-radix-scroll-area-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-scroll-area-viewport]::-webkit-scrollbar{display:none}"},nonce:o}),e.jsx(te.div,{"data-radix-scroll-area-viewport":"",...c,ref:m,style:{overflowX:i.scrollbarXEnabled?"scroll":"hidden",overflowY:i.scrollbarYEnabled?"scroll":"hidden",...t.style},children:e.jsx("div",{ref:i.onContentChange,style:{minWidth:"100%",display:"table"},children:a})})]})});He.displayName=Ie;var T="ScrollAreaScrollbar",we=l.forwardRef((t,r)=>{const{forceMount:n,...a}=t,o=C(T,t.__scopeScrollArea),{onScrollbarXEnabledChange:c,onScrollbarYEnabledChange:i}=o,d=t.orientation==="horizontal";return l.useEffect(()=>(d?c(!0):i(!0),()=>{d?c(!1):i(!1)}),[d,c,i]),o.type==="hover"?e.jsx($t,{...a,ref:r,forceMount:n}):o.type==="scroll"?e.jsx(Kt,{...a,ref:r,forceMount:n}):o.type==="auto"?e.jsx(We,{...a,ref:r,forceMount:n}):o.type==="always"?e.jsx(Se,{...a,ref:r}):null});we.displayName=T;var $t=l.forwardRef((t,r)=>{const{forceMount:n,...a}=t,o=C(T,t.__scopeScrollArea),[c,i]=l.useState(!1);return l.useEffect(()=>{const d=o.scrollArea;let m=0;if(d){const f=()=>{window.clearTimeout(m),i(!0)},h=()=>{m=window.setTimeout(()=>i(!1),o.scrollHideDelay)};return d.addEventListener("pointerenter",f),d.addEventListener("pointerleave",h),()=>{window.clearTimeout(m),d.removeEventListener("pointerenter",f),d.removeEventListener("pointerleave",h)}}},[o.scrollArea,o.scrollHideDelay]),e.jsx(ae,{present:n||c,children:e.jsx(We,{"data-state":c?"visible":"hidden",...a,ref:r})})}),Kt=l.forwardRef((t,r)=>{const{forceMount:n,...a}=t,o=C(T,t.__scopeScrollArea),c=t.orientation==="horizontal",i=ie(()=>m("SCROLL_END"),100),[d,m]=Yt("hidden",{hidden:{SCROLL:"scrolling"},scrolling:{SCROLL_END:"idle",POINTER_ENTER:"interacting"},interacting:{SCROLL:"interacting",POINTER_LEAVE:"idle"},idle:{HIDE:"hidden",SCROLL:"scrolling",POINTER_ENTER:"interacting"}});return l.useEffect(()=>{if(d==="idle"){const f=window.setTimeout(()=>m("HIDE"),o.scrollHideDelay);return()=>window.clearTimeout(f)}},[d,o.scrollHideDelay,m]),l.useEffect(()=>{const f=o.viewport,h=c?"scrollLeft":"scrollTop";if(f){let b=f[h];const x=()=>{const p=f[h];b!==p&&(m("SCROLL"),i()),b=p};return f.addEventListener("scroll",x),()=>f.removeEventListener("scroll",x)}},[o.viewport,c,m,i]),e.jsx(ae,{present:n||d!=="hidden",children:e.jsx(Se,{"data-state":d==="hidden"?"hidden":"visible",...a,ref:r,onPointerEnter:J(t.onPointerEnter,()=>m("POINTER_ENTER")),onPointerLeave:J(t.onPointerLeave,()=>m("POINTER_LEAVE"))})})}),We=l.forwardRef((t,r)=>{const n=C(T,t.__scopeScrollArea),{forceMount:a,...o}=t,[c,i]=l.useState(!1),d=t.orientation==="horizontal",m=ie(()=>{if(n.viewport){const f=n.viewport.offsetWidth<n.viewport.scrollWidth,h=n.viewport.offsetHeight<n.viewport.scrollHeight;i(d?f:h)}},10);return X(n.viewport,m),X(n.content,m),e.jsx(ae,{present:a||c,children:e.jsx(Se,{"data-state":c?"visible":"hidden",...o,ref:r})})}),Se=l.forwardRef((t,r)=>{const{orientation:n="vertical",...a}=t,o=C(T,t.__scopeScrollArea),c=l.useRef(null),i=l.useRef(0),[d,m]=l.useState({content:0,viewport:0,scrollbar:{size:0,paddingStart:0,paddingEnd:0}}),f=Ye(d.viewport,d.content),h={...a,sizes:d,onSizesChange:m,hasThumb:f>0&&f<1,onThumbChange:x=>c.current=x,onThumbPointerUp:()=>i.current=0,onThumbPointerDown:x=>i.current=x};function b(x,p){return rr(x,i.current,d,p)}return n==="horizontal"?e.jsx(Qt,{...h,ref:r,onThumbPositionChange:()=>{if(o.viewport&&c.current){const x=o.viewport.scrollLeft,p=Fe(x,d,o.dir);c.current.style.transform=`translate3d(${p}px, 0, 0)`}},onWheelScroll:x=>{o.viewport&&(o.viewport.scrollLeft=x)},onDragScroll:x=>{o.viewport&&(o.viewport.scrollLeft=b(x,o.dir))}}):n==="vertical"?e.jsx(Gt,{...h,ref:r,onThumbPositionChange:()=>{if(o.viewport&&c.current){const x=o.viewport.scrollTop,p=Fe(x,d);c.current.style.transform=`translate3d(0, ${p}px, 0)`}},onWheelScroll:x=>{o.viewport&&(o.viewport.scrollTop=x)},onDragScroll:x=>{o.viewport&&(o.viewport.scrollTop=b(x))}}):null}),Qt=l.forwardRef((t,r)=>{const{sizes:n,onSizesChange:a,...o}=t,c=C(T,t.__scopeScrollArea),[i,d]=l.useState(),m=l.useRef(null),f=Y(r,m,c.onScrollbarXChange);return l.useEffect(()=>{m.current&&d(getComputedStyle(m.current))},[m]),e.jsx(Ve,{"data-orientation":"horizontal",...o,ref:f,sizes:n,style:{bottom:0,left:c.dir==="rtl"?"var(--radix-scroll-area-corner-width)":0,right:c.dir==="ltr"?"var(--radix-scroll-area-corner-width)":0,"--radix-scroll-area-thumb-width":le(n)+"px",...t.style},onThumbPointerDown:h=>t.onThumbPointerDown(h.x),onDragScroll:h=>t.onDragScroll(h.x),onWheelScroll:(h,b)=>{if(c.viewport){const x=c.viewport.scrollLeft+h.deltaX;t.onWheelScroll(x),$e(x,b)&&h.preventDefault()}},onResize:()=>{m.current&&c.viewport&&i&&a({content:c.viewport.scrollWidth,viewport:c.viewport.offsetWidth,scrollbar:{size:m.current.clientWidth,paddingStart:oe(i.paddingLeft),paddingEnd:oe(i.paddingRight)}})}})}),Gt=l.forwardRef((t,r)=>{const{sizes:n,onSizesChange:a,...o}=t,c=C(T,t.__scopeScrollArea),[i,d]=l.useState(),m=l.useRef(null),f=Y(r,m,c.onScrollbarYChange);return l.useEffect(()=>{m.current&&d(getComputedStyle(m.current))},[m]),e.jsx(Ve,{"data-orientation":"vertical",...o,ref:f,sizes:n,style:{top:0,right:c.dir==="ltr"?0:void 0,left:c.dir==="rtl"?0:void 0,bottom:"var(--radix-scroll-area-corner-height)","--radix-scroll-area-thumb-height":le(n)+"px",...t.style},onThumbPointerDown:h=>t.onThumbPointerDown(h.y),onDragScroll:h=>t.onDragScroll(h.y),onWheelScroll:(h,b)=>{if(c.viewport){const x=c.viewport.scrollTop+h.deltaY;t.onWheelScroll(x),$e(x,b)&&h.preventDefault()}},onResize:()=>{m.current&&c.viewport&&i&&a({content:c.viewport.scrollHeight,viewport:c.viewport.offsetHeight,scrollbar:{size:m.current.clientHeight,paddingStart:oe(i.paddingTop),paddingEnd:oe(i.paddingBottom)}})}})}),[Zt,Be]=Oe(T),Ve=l.forwardRef((t,r)=>{const{__scopeScrollArea:n,sizes:a,hasThumb:o,onThumbChange:c,onThumbPointerUp:i,onThumbPointerDown:d,onThumbPositionChange:m,onDragScroll:f,onWheelScroll:h,onResize:b,...x}=t,p=C(T,n),[S,P]=l.useState(null),q=Y(r,g=>P(g)),y=l.useRef(null),H=l.useRef(""),D=p.viewport,W=a.content-a.viewport,v=O(h),A=O(m),F=ie(b,10);function B(g){if(y.current){const w=g.clientX-y.current.left,k=g.clientY-y.current.top;f({x:w,y:k})}}return l.useEffect(()=>{const g=w=>{const k=w.target;S?.contains(k)&&v(w,W)};return document.addEventListener("wheel",g,{passive:!1}),()=>document.removeEventListener("wheel",g,{passive:!1})},[D,S,W,v]),l.useEffect(A,[a,A]),X(S,F),X(p.content,F),e.jsx(Zt,{scope:n,scrollbar:S,hasThumb:o,onThumbChange:O(c),onThumbPointerUp:O(i),onThumbPositionChange:A,onThumbPointerDown:O(d),children:e.jsx(te.div,{...x,ref:q,style:{position:"absolute",...x.style},onPointerDown:J(t.onPointerDown,g=>{g.button===0&&(g.target.setPointerCapture(g.pointerId),y.current=S.getBoundingClientRect(),H.current=document.body.style.webkitUserSelect,document.body.style.webkitUserSelect="none",p.viewport&&(p.viewport.style.scrollBehavior="auto"),B(g))}),onPointerMove:J(t.onPointerMove,B),onPointerUp:J(t.onPointerUp,g=>{const w=g.target;w.hasPointerCapture(g.pointerId)&&w.releasePointerCapture(g.pointerId),document.body.style.webkitUserSelect=H.current,p.viewport&&(p.viewport.style.scrollBehavior=""),y.current=null})})})}),ne="ScrollAreaThumb",Ue=l.forwardRef((t,r)=>{const{forceMount:n,...a}=t,o=Be(ne,t.__scopeScrollArea);return e.jsx(ae,{present:n||o.hasThumb,children:e.jsx(er,{ref:r,...a})})}),er=l.forwardRef((t,r)=>{const{__scopeScrollArea:n,style:a,...o}=t,c=C(ne,n),i=Be(ne,n),{onThumbPositionChange:d}=i,m=Y(r,b=>i.onThumbChange(b)),f=l.useRef(void 0),h=ie(()=>{f.current&&(f.current(),f.current=void 0)},100);return l.useEffect(()=>{const b=c.viewport;if(b){const x=()=>{if(h(),!f.current){const p=sr(b,d);f.current=p,d()}};return d(),b.addEventListener("scroll",x),()=>b.removeEventListener("scroll",x)}},[c.viewport,h,d]),e.jsx(te.div,{"data-state":i.hasThumb?"visible":"hidden",...o,ref:m,style:{width:"var(--radix-scroll-area-thumb-width)",height:"var(--radix-scroll-area-thumb-height)",...a},onPointerDownCapture:J(t.onPointerDownCapture,b=>{const p=b.target.getBoundingClientRect(),S=b.clientX-p.left,P=b.clientY-p.top;i.onThumbPointerDown({x:S,y:P})}),onPointerUp:J(t.onPointerUp,i.onThumbPointerUp)})});Ue.displayName=ne;var ye="ScrollAreaCorner",Xe=l.forwardRef((t,r)=>{const n=C(ye,t.__scopeScrollArea),a=!!(n.scrollbarX&&n.scrollbarY);return n.type!=="scroll"&&a?e.jsx(tr,{...t,ref:r}):null});Xe.displayName=ye;var tr=l.forwardRef((t,r)=>{const{__scopeScrollArea:n,...a}=t,o=C(ye,n),[c,i]=l.useState(0),[d,m]=l.useState(0),f=!!(c&&d);return X(o.scrollbarX,()=>{const h=o.scrollbarX?.offsetHeight||0;o.onCornerHeightChange(h),m(h)}),X(o.scrollbarY,()=>{const h=o.scrollbarY?.offsetWidth||0;o.onCornerWidthChange(h),i(h)}),f?e.jsx(te.div,{...a,ref:r,style:{width:c,height:d,position:"absolute",right:o.dir==="ltr"?0:void 0,left:o.dir==="rtl"?0:void 0,bottom:0,...t.style}}):null});function oe(t){return t?parseInt(t,10):0}function Ye(t,r){const n=t/r;return isNaN(n)?0:n}function le(t){const r=Ye(t.viewport,t.content),n=t.scrollbar.paddingStart+t.scrollbar.paddingEnd,a=(t.scrollbar.size-n)*r;return Math.max(a,18)}function rr(t,r,n,a="ltr"){const o=le(n),c=o/2,i=r||c,d=o-i,m=n.scrollbar.paddingStart+i,f=n.scrollbar.size-n.scrollbar.paddingEnd-d,h=n.content-n.viewport,b=a==="ltr"?[0,h]:[h*-1,0];return qe([m,f],b)(t)}function Fe(t,r,n="ltr"){const a=le(r),o=r.scrollbar.paddingStart+r.scrollbar.paddingEnd,c=r.scrollbar.size-o,i=r.content-r.viewport,d=c-a,m=n==="ltr"?[0,i]:[i*-1,0],f=ht(t,m);return qe([0,i],[0,d])(f)}function qe(t,r){return n=>{if(t[0]===t[1]||r[0]===r[1])return r[0];const a=(r[1]-r[0])/(t[1]-t[0]);return r[0]+a*(n-t[0])}}function $e(t,r){return t>0&&t<r}var sr=(t,r=()=>{})=>{let n={left:t.scrollLeft,top:t.scrollTop},a=0;return(function o(){const c={left:t.scrollLeft,top:t.scrollTop},i=n.left!==c.left,d=n.top!==c.top;(i||d)&&r(),n=c,a=window.requestAnimationFrame(o)})(),()=>window.cancelAnimationFrame(a)};function ie(t,r){const n=O(t),a=l.useRef(0);return l.useEffect(()=>()=>window.clearTimeout(a.current),[]),l.useCallback(()=>{window.clearTimeout(a.current),a.current=window.setTimeout(n,r)},[n,r])}function X(t,r){const n=O(r);mt(()=>{let a=0;if(t){const o=new ResizeObserver(()=>{cancelAnimationFrame(a),a=window.requestAnimationFrame(n)});return o.observe(t),()=>{window.cancelAnimationFrame(a),o.unobserve(t)}}},[t,n])}var Ke=Je,nr=He,or=Xe;const Qe=l.forwardRef(({className:t,children:r,...n},a)=>e.jsxs(Ke,{ref:a,className:ee("relative overflow-hidden",t),...n,children:[e.jsx(nr,{className:"h-full w-full rounded-[inherit]",children:r}),e.jsx(Ge,{}),e.jsx(or,{})]}));Qe.displayName=Ke.displayName;const Ge=l.forwardRef(({className:t,orientation:r="vertical",...n},a)=>e.jsx(we,{ref:a,orientation:r,className:ee("flex touch-none select-none transition-colors",r==="vertical"&&"h-full w-2.5 border-l border-l-transparent p-[1px]",r==="horizontal"&&"h-2.5 flex-col border-t border-t-transparent p-[1px]",t),...n,children:e.jsx(Ue,{className:"relative flex-1 rounded-full bg-border"})}));Ge.displayName=we.displayName;function ar(t){switch(t){case"success":return"bg-emerald-500/15 text-emerald-500 border border-emerald-500/30";case"error":return"bg-rose-500/15 text-rose-500 border border-rose-500/30";case"running":default:return"bg-amber-500/15 text-amber-500 border border-amber-500/30"}}function lr(t){switch(t){case"success":return"Sikeres";case"error":return"Hiba";case"running":default:return"Folyamatban"}}function Le(t){if(!t)return"-";try{return Me(new Date(t),"yyyy.MM.dd. HH:mm:ss")}catch(r){return console.error("Failed to format date",t,r),t}}function ir(t){if(!t||t<=0)return"-";if(t<1e3)return`${t} ms`;const r=t/1e3;if(r<60)return`${r.toFixed(1)} mp`;const n=Math.floor(r/60),a=Math.round(r%60);return`${n} p ${a} mp`}function cr(t){if(!t)return"";const r={fetch_upcoming_fixtures:"Közelgő mérkőzések frissítése",run_daily_predictions:"Napi predikció futtatás",update_team_stats:"Csapat statisztika frissítés",cleanup_old_logs:"Régi logok karbantartása"};return r[t.job_name]?r[t.job_name]:t.job_name.split("_").map(n=>n[0]?.toUpperCase()+n.slice(1)).join(" ")}function dr({open:t,onOpenChange:r,job:n,logs:a,isLoading:o,onRefresh:c}){return e.jsx(be,{open:t,onOpenChange:r,children:e.jsxs(pe,{className:"max-w-3xl",children:[e.jsxs(ge,{children:[e.jsxs(je,{children:["Futtatási napló – ",cr(n)]}),e.jsx(zt,{children:"Részletes információk a legutóbbi futtatásokról és hibákról."})]}),e.jsxs("div",{className:"flex items-center justify-between gap-4 mb-4",children:[e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Összes futás: ",e.jsx("span",{className:"font-medium text-foreground",children:n?.stats.total_runs??0})," · Sikeres futások: ",e.jsx("span",{className:"font-medium text-foreground",children:n?.stats.success_runs??0})]}),e.jsx(E,{variant:"outline",size:"sm",onClick:c,disabled:o||!n,children:o?e.jsx(fe,{className:"w-4 h-4 animate-spin"}):"Frissítés"})]}),o?e.jsxs("div",{className:"py-16 flex items-center justify-center text-sm text-muted-foreground",children:[e.jsx(fe,{className:"w-4 h-4 animate-spin mr-2"})," Betöltés folyamatban..."]}):a.length===0?e.jsx("div",{className:"py-16 text-center text-sm text-muted-foreground",children:"Ehhez a jobhoz még nem érhető el futtatási napló."}):e.jsx(Qe,{className:"max-h-[420px] rounded-md border border-border/60",children:e.jsxs(xt,{children:[e.jsx(ft,{children:e.jsxs(Pe,{children:[e.jsx(K,{children:"Státusz"}),e.jsx(K,{children:"Kezdés időpontja"}),e.jsx(K,{children:"Befejezés"}),e.jsx(K,{children:"Időtartam"}),e.jsx(K,{className:"text-right",children:"Feldolgozott rekordok"})]})}),e.jsx(bt,{children:a.map(i=>e.jsxs(Pe,{children:[e.jsxs(Q,{children:[e.jsx(ze,{className:ee("uppercase text-[11px]",ar(i.status)),children:lr(i.status)}),i.error_message&&e.jsx("p",{className:"text-xs text-rose-400 mt-1 max-w-xs",children:i.error_message})]}),e.jsx(Q,{children:Le(i.started_at)}),e.jsx(Q,{children:Le(i.completed_at)}),e.jsx(Q,{children:ir(i.duration_ms)}),e.jsx(Q,{className:"text-right",children:i.records_processed??0})]},i.id))})]})})]})})}const ur=async()=>{const{data:t,error:r}=await I.functions.invoke("jobs-list");if(r)throw new Error(r.message??"Failed to load scheduled jobs");return t?.jobs??[]},mr=async t=>{const{data:r,error:n}=await I.functions.invoke("jobs-create",{body:t});if(n)throw new Error(n.message);return r},hr=async(t,r)=>{const{data:n,error:a}=await I.functions.invoke("jobs-update",{body:{id:t,...r}});if(a)throw new Error(a.message);return n},xr=async t=>{const{error:r}=await I.functions.invoke("jobs-delete",{body:{id:t}});if(r)throw new Error(r.message)},xe=[{value:"data_import",label:"Data Import",description:"Import data from external sources"},{value:"prediction",label:"Prediction",description:"Run AI predictions"},{value:"aggregation",label:"Aggregation",description:"Aggregate statistics and metrics"},{value:"maintenance",label:"Maintenance",description:"System maintenance tasks"},{value:"monitoring",label:"Monitoring",description:"Health checks and monitoring"}],fr=[{label:"Every minute",expression:"* * * * *",description:"Runs every minute"},{label:"Every hour",expression:"0 * * * *",description:"Runs at the start of every hour"},{label:"Every 6 hours",expression:"0 */6 * * *",description:"Runs at 00:00, 06:00, 12:00, 18:00"},{label:"Daily at midnight",expression:"0 0 * * *",description:"Runs every day at midnight"},{label:"Daily at 3 AM",expression:"0 3 * * *",description:"Runs every day at 3:00 AM"},{label:"Weekly (Sunday 2 AM)",expression:"0 2 * * 0",description:"Runs every Sunday at 2:00 AM"},{label:"Monthly (1st at 1 AM)",expression:"0 1 1 * *",description:"Runs on the 1st of every month at 1:00 AM"}];function Pr(){pt("Scheduled Jobs • WinMix TipsterHub");const t=gt(),[r,n]=l.useState(null),[a,o]=l.useState(!1),[c,i]=l.useState(null),[d,m]=l.useState(null),[f,h]=l.useState(!1),[b,x]=l.useState(!1),[p,S]=l.useState(null),[P,q]=l.useState(""),[y,H]=l.useState("all"),[D,W]=l.useState(!1),v=Te({queryKey:["scheduled-jobs"],queryFn:ur,refetchInterval:3e4,refetchIntervalInBackground:!1}),A=Z({mutationFn:mr,onSuccess:()=>{_.success("Job created successfully"),t.invalidateQueries({queryKey:["scheduled-jobs"]}),h(!1),Ce()},onError:s=>{_.error(s.message)}}),F=Z({mutationFn:({id:s,data:u})=>hr(s,u),onSuccess:()=>{_.success("Job updated successfully"),t.invalidateQueries({queryKey:["scheduled-jobs"]}),x(!1),S(null),Ce()},onError:s=>{_.error(s.message)}}),B=Z({mutationFn:xr,onSuccess:()=>{_.success("Job deleted successfully"),t.invalidateQueries({queryKey:["scheduled-jobs"]})},onError:s=>{_.error(s.message)}}),g=async()=>{if(!r)return[];const{data:s,error:u}=await I.functions.invoke("jobs-logs",{body:{jobId:r.id,limit:50}});if(u)throw new Error(u.message??"Failed to fetch execution logs");return s?.logs??[]},w=Te({queryKey:["job-logs",r?.id],queryFn:g,enabled:a&&!!r,refetchOnWindowFocus:!1,onError:s=>{const u=s instanceof Error?s.message:"Failed to load logs";_.error(u)}}),k=Z({mutationFn:async({jobId:s,enabled:u})=>{const{data:R,error:L}=await I.functions.invoke("jobs-toggle",{body:{jobId:s,enabled:u}});if(L)throw new Error(L.message??"Failed to update job status");return R?.job},onMutate:({jobId:s})=>{i(s)},onSuccess:async(s,{enabled:u})=>{await t.invalidateQueries({queryKey:["scheduled-jobs"]}),_.success(u?"Job enabled":"Job disabled")},onError:s=>{_.error(s.message||"Failed to update job")},onSettled:()=>{i(null)}}),ce=Z({mutationFn:async({jobId:s,force:u})=>{const{data:R,error:L}=await I.functions.invoke("jobs-trigger",{body:{jobId:s,force:u}});if(L)throw new Error(L.message??"Failed to run job");if(!R?.result)throw new Error("No response received from job execution");return R.result},onMutate:({jobId:s})=>{m(s)},onSuccess:async(s,{jobId:u})=>{await t.invalidateQueries({queryKey:["scheduled-jobs"]}),r?.id===u&&await t.invalidateQueries({queryKey:["job-logs",u]}),_.success(`Job execution completed – ${s.recordsProcessed} records processed.`)},onError:s=>{_.error(s.message||"Failed to run job")},onSettled:()=>{m(null)}}),[j,Ne]=l.useState({job_name:"",job_type:"data_import",cron_schedule:"0 3 * * *",enabled:!0,config:{}}),Ce=()=>{Ne({job_name:"",job_type:"data_import",cron_schedule:"0 3 * * *",enabled:!0,config:{}})},Ze=s=>{S(s),Ne({job_name:s.job_name,job_type:s.job_type,cron_schedule:s.cron_schedule,enabled:s.enabled,config:s.config||{}}),x(!0)},et=s=>{confirm("Are you sure you want to delete this job?")&&B.mutate(s)},tt=s=>{n(s),o(!0)},rt=s=>{o(s),s||n(null)},_e=l.useMemo(()=>(v.data??[]).filter(u=>{const R=u.job_name.toLowerCase().includes(P.toLowerCase())||u.job_type.toLowerCase().includes(P.toLowerCase()),L=y==="all"||u.job_type===y,nt=D||u.enabled;return R&&L&&nt}),[v.data,P,y,D]),$=l.useMemo(()=>{const s=v.data??[];return{total:s.length,enabled:s.filter(u=>u.enabled).length,disabled:s.filter(u=>!u.enabled).length,due:s.filter(u=>u.is_due).length,running:s.filter(u=>u.last_log?.status==="running").length}},[v.data]),st=l.useMemo(()=>e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[1,2,3,4].map(s=>e.jsx(jt,{className:"h-64 w-full"},s))}),[]);return e.jsx(vt,{allowedRoles:["admin","analyst"],children:e.jsxs(wt,{children:[e.jsx(St,{title:"Scheduled Jobs",description:"Automated task scheduling and management",actions:e.jsxs(e.Fragment,{children:[e.jsxs(E,{variant:"outline",size:"sm",onClick:()=>void v.refetch(),disabled:v.isFetching,className:"inline-flex items-center gap-2",children:[e.jsx(yt,{className:ee("w-4 h-4",v.isFetching?"animate-spin":"")}),"Refresh"]}),e.jsxs(E,{onClick:()=>h(!0),children:[e.jsx(Nt,{className:"w-4 h-4 mr-2"}),"Add Job"]})]})}),e.jsx(be,{open:f,onOpenChange:h,children:e.jsxs(pe,{className:"max-w-2xl",children:[e.jsx(ge,{children:e.jsx(je,{children:"Create New Job"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(N,{htmlFor:"job-name",children:"Job Name"}),e.jsx(G,{id:"job-name",value:j.job_name,onChange:s=>setForm(u=>({...u,job_name:s.target.value})),placeholder:"daily_data_import"})]}),e.jsxs("div",{children:[e.jsx(N,{htmlFor:"job-type",children:"Job Type"}),e.jsxs(de,{value:j.job_type,onValueChange:s=>setForm(u=>({...u,job_type:s})),children:[e.jsx(ue,{children:e.jsx(me,{placeholder:"Select job type"})}),e.jsx(he,{children:xe.map(s=>e.jsx(re,{value:s.value,children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s.label}),e.jsx("div",{className:"text-xs text-muted-foreground",children:s.description})]})},s.value))})]})]}),e.jsxs("div",{children:[e.jsx(N,{htmlFor:"cron-schedule",children:"Cron Schedule"}),e.jsx(G,{id:"cron-schedule",value:j.cron_schedule,onChange:s=>setForm(u=>({...u,cron_schedule:s.target.value})),placeholder:"0 3 * * *"}),e.jsxs("div",{className:"mt-2",children:[e.jsx(N,{className:"text-xs text-muted-foreground",children:"Quick Presets:"}),e.jsx("div",{className:"grid grid-cols-2 gap-2 mt-1",children:fr.slice(0,4).map(s=>e.jsx(E,{type:"button",variant:"outline",size:"sm",onClick:()=>setForm(u=>({...u,cron_schedule:s.expression})),className:"text-xs",children:s.label},s.expression))})]})]}),e.jsxs("div",{children:[e.jsx(N,{htmlFor:"config",children:"Configuration (JSON)"}),e.jsx(Re,{id:"config",value:JSON.stringify(j.config,null,2),onChange:s=>{try{const u=JSON.parse(s.target.value);setForm(R=>({...R,config:u}))}catch{}},placeholder:'{"source": "api", "batch_size": 100}',rows:4})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(se,{id:"enabled",checked:j.enabled,onCheckedChange:s=>setForm(u=>({...u,enabled:s}))}),e.jsx(N,{htmlFor:"enabled",children:"Enabled"})]})]}),e.jsxs(ke,{children:[e.jsx(E,{variant:"outline",onClick:()=>h(!1),children:"Cancel"}),e.jsx(E,{onClick:()=>A.mutate(j),disabled:A.isPending||!j.job_name||!j.cron_schedule,children:"Create"})]})]})}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-4 mb-8",children:[e.jsxs(z,{className:"bg-card/60 border-border/80 backdrop-blur",children:[e.jsxs(V,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(U,{className:"text-sm font-medium",children:"Total Jobs"}),e.jsx(Ct,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(M,{children:e.jsx("div",{className:"text-2xl font-bold",children:$.total})})]}),e.jsxs(z,{className:"bg-card/60 border-border/80 backdrop-blur",children:[e.jsxs(V,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(U,{className:"text-sm font-medium",children:"Enabled"}),e.jsx(_t,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(M,{children:e.jsx("div",{className:"text-2xl font-bold text-green-500",children:$.enabled})})]}),e.jsxs(z,{className:"bg-card/60 border-border/80 backdrop-blur",children:[e.jsxs(V,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(U,{className:"text-sm font-medium",children:"Disabled"}),e.jsx(Mt,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(M,{children:e.jsx("div",{className:"text-2xl font-bold text-gray-500",children:$.disabled})})]}),e.jsxs(z,{className:"bg-card/60 border-border/80 backdrop-blur",children:[e.jsxs(V,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(U,{className:"text-sm font-medium",children:"Due"}),e.jsx(Et,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(M,{children:e.jsx("div",{className:"text-2xl font-bold text-red-500",children:$.due})})]}),e.jsxs(z,{className:"bg-card/60 border-border/80 backdrop-blur",children:[e.jsxs(V,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(U,{className:"text-sm font-medium",children:"Running"}),e.jsx(Pt,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(M,{children:e.jsx("div",{className:"text-2xl font-bold text-blue-500",children:$.running})})]})]}),e.jsx(z,{className:"bg-card/60 border-border/80 backdrop-blur mb-6",children:e.jsx(M,{className:"pt-6",children:e.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsx(G,{placeholder:"Search jobs...",value:P,onChange:s=>q(s.target.value)})}),e.jsx("div",{className:"w-full md:w-48",children:e.jsxs(de,{value:y,onValueChange:H,children:[e.jsx(ue,{children:e.jsx(me,{placeholder:"All types"})}),e.jsxs(he,{children:[e.jsx(re,{value:"all",children:"All Types"}),xe.map(s=>e.jsx(re,{value:s.value,children:s.label},s.value))]})]})}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(se,{id:"show-inactive",checked:D,onCheckedChange:W}),e.jsx(N,{htmlFor:"show-inactive",children:"Show Disabled"})]})]})})}),v.error&&e.jsx(Rt,{variant:"destructive",className:"mb-6",children:e.jsx(Tt,{children:v.error.message})}),v.isLoading?st:_e.length===0?e.jsx("div",{className:"rounded-lg border border-border/60 bg-muted/20 p-12 text-center text-muted-foreground",children:"No jobs found."}):e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:_e.map(s=>e.jsx(Xt,{job:s,onToggle:u=>k.mutate({jobId:s.id,enabled:u}),onRun:()=>ce.mutate({jobId:s.id,force:!s.enabled}),onViewLogs:()=>tt(s),onEdit:()=>Ze(s),onDelete:()=>et(s.id),isToggling:c===s.id&&k.isPending,isRunning:d===s.id&&ce.isPending},s.id))}),e.jsx(be,{open:b,onOpenChange:x,children:e.jsxs(pe,{className:"max-w-2xl",children:[e.jsx(ge,{children:e.jsx(je,{children:"Edit Job"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(N,{htmlFor:"edit-job-name",children:"Job Name"}),e.jsx(G,{id:"edit-job-name",value:j.job_name,onChange:s=>setForm(u=>({...u,job_name:s.target.value})),placeholder:"daily_data_import"})]}),e.jsxs("div",{children:[e.jsx(N,{htmlFor:"edit-job-type",children:"Job Type"}),e.jsxs(de,{value:j.job_type,onValueChange:s=>setForm(u=>({...u,job_type:s})),children:[e.jsx(ue,{children:e.jsx(me,{placeholder:"Select job type"})}),e.jsx(he,{children:xe.map(s=>e.jsx(re,{value:s.value,children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s.label}),e.jsx("div",{className:"text-xs text-muted-foreground",children:s.description})]})},s.value))})]})]}),e.jsxs("div",{children:[e.jsx(N,{htmlFor:"edit-cron-schedule",children:"Cron Schedule"}),e.jsx(G,{id:"edit-cron-schedule",value:j.cron_schedule,onChange:s=>setForm(u=>({...u,cron_schedule:s.target.value})),placeholder:"0 3 * * *"})]}),e.jsxs("div",{children:[e.jsx(N,{htmlFor:"edit-config",children:"Configuration (JSON)"}),e.jsx(Re,{id:"edit-config",value:JSON.stringify(j.config,null,2),onChange:s=>{try{const u=JSON.parse(s.target.value);setForm(R=>({...R,config:u}))}catch{}},placeholder:'{"source": "api", "batch_size": 100}',rows:4})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(se,{id:"edit-enabled",checked:j.enabled,onCheckedChange:s=>setForm(u=>({...u,enabled:s}))}),e.jsx(N,{htmlFor:"edit-enabled",children:"Enabled"})]})]}),e.jsxs(ke,{children:[e.jsx(E,{variant:"outline",onClick:()=>x(!1),children:"Cancel"}),e.jsx(E,{onClick:()=>p&&F.mutate({id:p.id,data:j}),disabled:F.isPending||!j.job_name||!j.cron_schedule,children:"Update"})]})]})}),e.jsx(dr,{open:a,onOpenChange:rt,job:r,logs:w.data??[],isLoading:w.isLoading,onRefresh:()=>void w.refetch()})]})})}export{Pr as default};
