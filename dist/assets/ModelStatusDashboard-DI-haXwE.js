import{al as ve,bE as we,bF as Fe,j as e,A as te,l as ce,aI as re,n as ae,J as oe,C as m,a as x,b as u,c as j,g as me,z as p,a7 as z,ae as I,af as P,ag as D,a8 as K,a9 as q,m as Te,bC as Se,bD as Me,w as v,bG as Y,am as xe,r as b,aA as G,aB as W,aC as F,aD as h,aE as J,aF as g,x as C,ap as ne,as as ie,bj as ue,L as T,R as he,B as L,f as O,y as ke,aM as Ce,bH as X,bI as k,bJ as Ae,bK as N,bL as Ee,bM as De,bN as Le,bO as _e,bP as $,bQ as H}from"./index-oF1ARjuv.js";import{u as A}from"./useQuery-CWzqJKQX.js";import{u as Q}from"./useMutation-DOyzXJwO.js";import{P as Re,I as ze}from"./PredictionConfidenceChart-DEdXhpbF.js";import{L as Ie,a as Pe}from"./LineChart-CcduGUPG.js";import{A as Ke,a as de}from"./AreaChart-CNurB4we.js";import{D as qe,a as $e,b as He,c as Ue,d as Be,e as Oe,f as Qe}from"./dialog-ByqoZUx5.js";import{D as ge}from"./database-AuhrJFpe.js";import{f as je}from"./formatDistanceToNow-gjHKn_gR.js";import"./index-ALgH8dPm.js";const Ve=[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]],Ye=ve("pencil",Ve);function Ge(s,t,a){const[i,r]=we(a?.in,s,t),c=le(i,r),n=Math.abs(Fe(i,r));i.setDate(i.getDate()-c*n);const l=+(le(i,r)===-c),y=c*(n-l);return y===0?0:y}function le(s,t){const a=s.getFullYear()-t.getFullYear()||s.getMonth()-t.getMonth()||s.getDate()-t.getDate()||s.getHours()-t.getHours()||s.getMinutes()-t.getMinutes()||s.getSeconds()-t.getSeconds()||s.getMilliseconds()-t.getMilliseconds();return a<0?-1:a>0?1:a}function We({analytics:s}){const{summary:t,timeSeriesData:a,confidenceTrend:i,systemStatus:r}=s,c=n=>{switch(n){case"healthy":return"text-green-600";case"warning":return"text-yellow-600";case"degraded":return"text-red-600";default:return"text-gray-600"}};return e.jsxs("div",{className:"space-y-6",children:[e.jsx(Re,{}),r==="degraded"&&e.jsxs(te,{variant:"destructive",children:[e.jsx(ce,{className:"h-4 w-4"}),e.jsx(re,{children:"System Degraded"}),e.jsxs(ae,{children:["Fail rate is above 30% (",t.failRate.toFixed(1),"%). We recommend retraining the model with recent data to improve accuracy."]})]}),r==="warning"&&e.jsxs(te,{children:[e.jsx(oe,{className:"h-4 w-4"}),e.jsx(re,{children:"Performance Warning"}),e.jsxs(ae,{children:["Fail rate is elevated at ",t.failRate.toFixed(1),"%. Monitor closely and consider retraining if performance continues to decline."]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs(m,{children:[e.jsx(x,{className:"pb-3",children:e.jsx(u,{className:"text-sm font-medium",children:"Total Predictions"})}),e.jsxs(j,{children:[e.jsx("div",{className:"text-2xl font-bold",children:t.totalPredictions}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Last 100 records"})]})]}),e.jsxs(m,{children:[e.jsx(x,{className:"pb-3",children:e.jsx(u,{className:"text-sm font-medium",children:"Accuracy"})}),e.jsxs(j,{children:[e.jsxs("div",{className:"text-2xl font-bold",children:[t.accuracy.toFixed(1),"%"]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[t.correctPredictions," correct"]})]})]}),e.jsxs(m,{children:[e.jsx(x,{className:"pb-3",children:e.jsx(u,{className:"text-sm font-medium",children:"Fail Rate"})}),e.jsxs(j,{children:[e.jsxs("div",{className:`text-2xl font-bold ${c(r)}`,children:[t.failRate.toFixed(1),"%"]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Status: ",r]})]})]}),e.jsxs(m,{children:[e.jsx(x,{className:"pb-3",children:e.jsx(u,{className:"text-sm font-medium",children:"Avg Confidence"})}),e.jsxs(j,{children:[e.jsxs("div",{className:"text-2xl font-bold",children:[(t.avgConfidence*100).toFixed(1),"%"]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Prediction confidence"})]})]})]}),e.jsxs(m,{children:[e.jsxs(x,{children:[e.jsxs(u,{className:"flex items-center gap-2",children:[e.jsx(me,{className:"h-5 w-5"}),"Confidence Trend"]}),e.jsx(p,{children:"Are predictions getting more confident over time?"})]}),e.jsx(j,{children:e.jsx(z,{width:"100%",height:300,children:e.jsxs(Ie,{data:i.slice(-50),children:[e.jsx(I,{strokeDasharray:"3 3"}),e.jsx(P,{dataKey:"timestamp",tickFormatter:n=>new Date(n).toLocaleDateString()}),e.jsx(D,{domain:[0,1],tickFormatter:n=>`${(n*100).toFixed(0)}%`}),e.jsx(K,{labelFormatter:n=>new Date(n).toLocaleString(),formatter:n=>`${(n*100).toFixed(1)}%`}),e.jsx(q,{}),e.jsx(Pe,{type:"monotone",dataKey:"confidence",stroke:"#8884d8",strokeWidth:2,dot:{fill:"#8884d8",r:3},name:"Confidence"})]})})})]}),e.jsxs(m,{children:[e.jsxs(x,{children:[e.jsxs(u,{className:"flex items-center gap-2",children:[e.jsx(Te,{className:"h-5 w-5"}),"Accuracy vs Time"]}),e.jsx(p,{children:"Daily accuracy and prediction volume trends"})]}),e.jsx(j,{children:e.jsx(z,{width:"100%",height:300,children:e.jsxs(Ke,{data:a,children:[e.jsx(I,{strokeDasharray:"3 3"}),e.jsx(P,{dataKey:"date"}),e.jsx(D,{yAxisId:"left",domain:[0,100]}),e.jsx(D,{yAxisId:"right",orientation:"right"}),e.jsx(K,{}),e.jsx(q,{}),e.jsx(de,{yAxisId:"left",type:"monotone",dataKey:"accuracy",stroke:"#82ca9d",fill:"#82ca9d",fillOpacity:.6,name:"Accuracy (%)"}),e.jsx(de,{yAxisId:"right",type:"monotone",dataKey:"predictions",stroke:"#8884d8",fill:"#8884d8",fillOpacity:.3,name:"Predictions"})]})})})]}),e.jsxs(m,{children:[e.jsxs(x,{children:[e.jsx(u,{children:"Daily Confidence Distribution"}),e.jsx(p,{children:"Average confidence levels per day"})]}),e.jsx(j,{children:e.jsx(z,{width:"100%",height:300,children:e.jsxs(Se,{data:a,children:[e.jsx(I,{strokeDasharray:"3 3"}),e.jsx(P,{dataKey:"date"}),e.jsx(D,{domain:[0,1],tickFormatter:n=>`${(n*100).toFixed(0)}%`}),e.jsx(K,{formatter:n=>`${(n*100).toFixed(1)}%`}),e.jsx(q,{}),e.jsx(Me,{dataKey:"confidence",fill:"#fbbf24",name:"Avg Confidence"})]})})})]})]})}class S extends Error{constructor(t){super(t),this.name="AdminModelStatusError"}}async function Je(){try{const{data:s,error:t}=await v.functions.invoke("admin-model-system-status",{method:"GET"});if(t)throw new S(t.message);return s}catch(s){throw console.error("Error fetching system status:",s),s}}async function Xe(s){try{const{data:t,error:a}=await v.functions.invoke("admin-model-analytics",{method:"POST",body:s?{window_days:s}:{}});if(a)throw new S(a.message);return t}catch(t){throw console.error("Error fetching analytics:",t),t}}async function Ze(s){try{const{data:t,error:a}=await v.functions.invoke("admin-model-promote",{method:"POST",body:s});if(a)throw new S(a.message);return t}catch(t){throw console.error("Error promoting model:",t),t}}async function es(s){try{const{data:t,error:a}=await v.functions.invoke("admin-model-trigger-training",{method:"POST",body:s});if(a)throw new S(a.message);return t}catch(t){throw console.error("Error triggering training:",t),t}}async function ss(){const{data:s,error:t}=await v.from("teams").select("*").order("name",{ascending:!0});if(t)throw new S(t.message);return s}async function ts(s,t){const{data:a,error:i}=await v.from("teams").update(t).eq("id",s).select().single();if(i)throw new S(i.message);return a}function rs(){const{toast:s}=Y(),t=xe(),[a,i]=b.useState(null),[r,c]=b.useState(""),[n,l]=b.useState(""),{data:y=[],isLoading:_}=A({queryKey:["admin-teams"],queryFn:ss}),w=Q({mutationFn:({id:d,updates:f})=>ts(d,f),onSuccess:()=>{t.invalidateQueries({queryKey:["admin-teams"]}),s({title:"Team Updated",description:"Team data has been successfully updated."}),i(null)},onError:d=>{s({title:"Update Failed",description:d.message||"Failed to update team data.",variant:"destructive"})}}),E=d=>{i(d),c(d.form_rating?.toString()||""),l(d.strength_index?.toString()||"")},R=()=>{if(!a)return;const d=parseFloat(r),f=parseFloat(n);if(r&&(isNaN(d)||d<0||d>100)){s({title:"Validation Error",description:"Form rating must be between 0 and 100.",variant:"destructive"});return}if(n&&(isNaN(f)||f<0||f>100)){s({title:"Validation Error",description:"Strength index must be between 0 and 100.",variant:"destructive"});return}w.mutate({id:a.id,updates:{form_rating:r?d:void 0,strength_index:n?f:void 0}})};return e.jsx("div",{className:"space-y-6",children:e.jsxs(m,{children:[e.jsxs(x,{children:[e.jsxs(u,{className:"flex items-center gap-2",children:[e.jsx(ge,{className:"h-5 w-5"}),"Team Editor"]}),e.jsx(p,{children:"Manually adjust team ratings that feed into the prediction model"})]}),e.jsxs(j,{children:[_?e.jsx("div",{className:"flex items-center justify-center p-8",children:e.jsx("p",{className:"text-muted-foreground",children:"Loading teams..."})}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(G,{children:[e.jsx(W,{children:e.jsxs(F,{children:[e.jsx(h,{children:"Team Name"}),e.jsx(h,{children:"Form Rating"}),e.jsx(h,{children:"Strength Index"}),e.jsx(h,{className:"text-right",children:"Actions"})]})}),e.jsx(J,{children:y.slice(0,20).map(d=>e.jsxs(F,{children:[e.jsx(g,{className:"font-medium",children:d.name}),e.jsx(g,{children:d.form_rating?.toFixed(1)||"N/A"}),e.jsx(g,{children:d.strength_index?.toFixed(1)||"N/A"}),e.jsx(g,{className:"text-right",children:e.jsxs(qe,{children:[e.jsx($e,{asChild:!0,children:e.jsx(C,{variant:"ghost",size:"sm",onClick:()=>E(d),children:e.jsx(Ye,{className:"h-4 w-4"})})}),e.jsxs(He,{children:[e.jsxs(Ue,{children:[e.jsx(Be,{children:"Edit Team Data"}),e.jsxs(Oe,{children:["Update form rating and strength index for ",d.name]})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(ne,{htmlFor:"form-rating",children:"Form Rating (0-100)"}),e.jsx(ie,{id:"form-rating",type:"number",min:"0",max:"100",step:"0.1",value:r,onChange:f=>c(f.target.value),placeholder:"Enter form rating"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(ne,{htmlFor:"strength-index",children:"Strength Index (0-100)"}),e.jsx(ie,{id:"strength-index",type:"number",min:"0",max:"100",step:"0.1",value:n,onChange:f=>l(f.target.value),placeholder:"Enter strength index"})]})]}),e.jsx(Qe,{children:e.jsx(C,{onClick:R,disabled:w.isPending,children:w.isPending?"Saving...":"Save Changes"})})]})]})})]},d.id))})]})}),y.length>20&&e.jsxs("p",{className:"mt-4 text-sm text-muted-foreground",children:["Showing first 20 teams. Total teams: ",y.length]})]})]})})}const as=async()=>{const{data:s,error:t}=await v.from("system_logs").select("*").order("created_at",{ascending:!1}).limit(10);if(t)throw new Error(t.message);return s||[]},ns=s=>{switch(s){case"error":return e.jsx(ue,{className:"h-4 w-4"});case"warning":return e.jsx(ce,{className:"h-4 w-4"});case"info":default:return e.jsx(ze,{className:"h-4 w-4"})}},is=s=>{switch(s){case"error":return"destructive";case"warning":return"outline";case"info":default:return"secondary"}},ds=s=>{if(!s)return"N/A";const t=new Date(s);return new Intl.DateTimeFormat("hu-HU",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit"}).format(t)};function ls(){const{toast:s}=Y(),{data:t,isLoading:a,error:i,refetch:r,isFetching:c}=A({queryKey:["system-logs"],queryFn:as,refetchInterval:3e4}),n=async()=>{try{await r(),s({title:"Frissítve",description:"A rendszernapló sikeresen frissítve."})}catch{s({title:"Hiba",description:"Nem sikerült frissíteni a rendszernaplót.",variant:"destructive"})}};return i?e.jsxs(m,{children:[e.jsxs(x,{children:[e.jsx(u,{children:"Rendszernapló"}),e.jsx(p,{children:"Hiba történt a rendszernapló betöltése közben"})]}),e.jsx(j,{children:e.jsxs("div",{className:"flex items-center gap-2 text-destructive",children:[e.jsx(ue,{className:"h-4 w-4"}),e.jsx("span",{children:i instanceof Error?i.message:"Ismeretlen hiba"})]})})]}):e.jsxs(m,{children:[e.jsx(x,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(u,{children:"Rendszernapló"}),e.jsx(p,{children:"Legutóbbi 10 bejegyzés a Python ML pipeline-ból"})]}),e.jsxs(C,{variant:"outline",size:"sm",onClick:n,disabled:c,children:[c?e.jsx(T,{className:"h-4 w-4 animate-spin"}):e.jsx(he,{className:"h-4 w-4"}),e.jsx("span",{className:"ml-2",children:"Frissítés"})]})]})}),e.jsx(j,{children:a?e.jsxs("div",{className:"flex items-center justify-center py-8",children:[e.jsx(T,{className:"h-6 w-6 animate-spin"}),e.jsx("span",{className:"ml-2 text-muted-foreground",children:"Betöltés..."})]}):t&&t.length>0?e.jsx("div",{className:"rounded-md border",children:e.jsxs(G,{children:[e.jsx(W,{children:e.jsxs(F,{children:[e.jsx(h,{className:"w-[140px]",children:"Időpont"}),e.jsx(h,{className:"w-[140px]",children:"Komponens"}),e.jsx(h,{className:"w-[100px]",children:"Státusz"}),e.jsx(h,{children:"Üzenet"})]})}),e.jsx(J,{children:t.map(l=>e.jsxs(F,{className:l.status==="error"?"bg-destructive/5":"",children:[e.jsx(g,{className:"text-sm text-muted-foreground",children:ds(l.created_at)}),e.jsx(g,{className:"font-mono text-sm",children:l.component}),e.jsx(g,{children:e.jsx(L,{variant:is(l.status),className:l.status==="warning"?"border-amber-500 text-amber-700":"",children:e.jsxs("span",{className:"flex items-center gap-1",children:[ns(l.status),l.status]})})}),e.jsx(g,{className:"max-w-md truncate",children:l.message||"N/A"})]},l.id))})]})}):e.jsx("div",{className:"py-8 text-center text-muted-foreground",children:"Nincsenek napló bejegyzések"})})]})}const cs=[{key:"accuracy",label:"Pontosság"},{key:"precision",label:"Precízió"},{key:"recall",label:"Recall"}];function os(s){return typeof s!="number"?"–":`${(s*100).toFixed(1)}%`}function ms(s){if(!s)return{label:"Ismeretlen frissesség",className:"bg-secondary text-secondary-foreground"};const t=Ge(new Date,new Date(s));return t<7?{label:"Friss (<7 nap)",className:"bg-emerald-500/15 text-emerald-600 border border-emerald-100"}:t<21?{label:"Figyelendő (7-21 nap)",className:"bg-amber-500/15 text-amber-600 border border-amber-100"}:{label:"Elavult (>21 nap)",className:"bg-destructive/10 text-destructive border border-destructive/30"}}function xs({model:s,isLoading:t,isRetraining:a,onTriggerTraining:i}){if(t)return e.jsxs(m,{children:[e.jsxs(x,{children:[e.jsx(u,{children:"Aktív modell állapota"}),e.jsx(p,{children:"Betöltés alatt..."})]}),e.jsx(j,{children:e.jsxs("div",{className:"flex items-center gap-2 text-muted-foreground",children:[e.jsx(T,{className:"h-4 w-4 animate-spin"}),e.jsx("span",{children:"Model registry betöltése..."})]})})]});if(!s)return e.jsxs(m,{children:[e.jsxs(x,{children:[e.jsx(u,{children:"Aktív modell állapota"}),e.jsx(p,{children:"Nincs elérhető modell a registry-ben"})]}),e.jsx(j,{children:e.jsx("p",{className:"text-sm text-muted-foreground",children:"A model_registry.json nem tartalmaz aktív modellt. Ellenőrizd a pipeline futásait vagy szinkronizáld a registry fájlt."})})]});const r=ms(s.registered_at),c=s.registered_at?new Date(s.registered_at):void 0;return e.jsxs(m,{children:[e.jsxs(x,{className:"flex flex-col gap-2 md:flex-row md:items-center md:justify-between",children:[e.jsxs("div",{children:[e.jsxs(u,{className:"flex items-center gap-3 text-lg md:text-2xl",children:[s.name,e.jsx(L,{className:O("text-xs",r.className),children:r.label})]}),e.jsxs(p,{children:[s.algorithm," • Verzió ",s.version," • ID ",s.id]})]}),e.jsx(C,{type:"button",size:"lg",onClick:i,disabled:a||!i,className:"w-full md:w-auto",children:a?e.jsxs(e.Fragment,{children:[e.jsx(T,{className:"mr-2 h-4 w-4 animate-spin"}),"Újratréningezés folyamatban..."]}):e.jsxs(e.Fragment,{children:[e.jsx(he,{className:"mr-2 h-4 w-4"}),"Újratréningezés"]})})]}),e.jsxs(j,{className:"space-y-6",children:[e.jsxs("div",{className:"grid gap-4 md:grid-cols-3",children:[e.jsxs("div",{className:"rounded-lg border bg-muted/40 p-4",children:[e.jsxs("p",{className:"text-sm font-medium text-muted-foreground flex items-center gap-2",children:[e.jsx(ke,{className:"h-4 w-4 text-muted-foreground"}),"Utolsó tréning"]}),e.jsx("p",{className:"text-base font-semibold",children:c?je(c,{addSuffix:!0}):"Ismeretlen"}),c&&e.jsx("p",{className:"text-xs text-muted-foreground",children:Ce(c,"yyyy. MMM dd. HH:mm")})]}),e.jsxs("div",{className:"rounded-lg border bg-muted/40 p-4",children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Forgalmi arány"}),e.jsx("p",{className:"text-base font-semibold",children:typeof s.traffic_allocation=="number"?`${s.traffic_allocation}%`:"0%"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Aktív predikciók aránya"})]}),e.jsxs("div",{className:"rounded-lg border bg-muted/40 p-4",children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Státusz"}),e.jsx("p",{className:"text-base font-semibold capitalize",children:s.status}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Registry szerinti állapot"})]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground mb-3",children:"Teljesítmény metrikák"}),e.jsx("div",{className:"flex flex-wrap gap-3",children:cs.map(n=>e.jsxs(L,{variant:"outline",className:"rounded-full bg-muted px-4 py-1 text-sm font-medium",children:[n.label,": ",os(s.metrics[n.key])]},n.key))})]})]})]})}const us={active:"bg-emerald-500/15 text-emerald-600 border border-emerald-100",candidate:"bg-blue-500/15 text-blue-600 border border-blue-100",shadow:"bg-purple-500/15 text-purple-600 border border-purple-100",retired:"bg-muted text-muted-foreground",archived:"bg-muted text-muted-foreground"};function hs(s){return typeof s!="number"?"0%":`${s.toFixed(0)}%`}function U(s){return`${(s*100).toFixed(1)}%`}function gs({models:s,onPromoteModel:t,isPromoting:a,promotingModelId:i}){return s.length?e.jsx("div",{className:"rounded-xl border bg-card",children:e.jsxs(G,{children:[e.jsx(W,{children:e.jsxs(F,{children:[e.jsx(h,{children:"Modell"}),e.jsx(h,{children:"Verzió"}),e.jsx(h,{children:"Metrikák (Acc / Prec / Rec)"}),e.jsx(h,{children:"Forgalom"}),e.jsx(h,{children:"Státusz"}),e.jsx(h,{children:"Utolsó frissítés"}),e.jsx(h,{className:"text-right",children:"Művelet"})]})}),e.jsx(J,{children:s.map(r=>{const c=us[r.status]||"bg-secondary text-secondary-foreground",n=r.status==="active",l=r.registered_at?je(new Date(r.registered_at),{addSuffix:!0}):"Ismeretlen";return e.jsxs(F,{className:O(n&&"bg-emerald-50/60 dark:bg-emerald-950/20"),children:[e.jsx(g,{className:"font-medium",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{children:r.name}),e.jsx("span",{className:"text-xs text-muted-foreground",children:r.algorithm})]})}),e.jsx(g,{children:r.version}),e.jsx(g,{children:e.jsxs("div",{className:"text-sm font-medium",children:[U(r.metrics.accuracy)," / ",U(r.metrics.precision)," / ",U(r.metrics.recall)]})}),e.jsx(g,{children:hs(r.traffic_allocation)}),e.jsx(g,{children:e.jsx(L,{className:O("capitalize",c),children:r.status})}),e.jsx(g,{className:"text-sm text-muted-foreground",children:l}),e.jsx(g,{className:"text-right",children:e.jsx(C,{size:"sm",variant:"outline",onClick:()=>t?.(r.id),disabled:n||a||!t,children:i===r.id?e.jsxs(e.Fragment,{children:[e.jsx(T,{className:"mr-2 h-4 w-4 animate-spin"}),"Aktiválás..."]}):"Promote to Active"})})]},r.id)})})]})}):e.jsx("div",{className:"rounded-lg border bg-muted/30 p-6 text-center text-sm text-muted-foreground",children:"A registry jelenleg nem tartalmaz modellt. Töltsd fel vagy szinkronizáld a model_registry.json fájlt."})}const js="/models/model_registry.json",fs=X({accuracy:k().min(0).max(1),precision:k().min(0).max(1),recall:k().min(0).max(1),f1_score:k().min(0).max(1)}),ps=Ae(["active","candidate","shadow","retired","archived"]),ys=X({id:N().uuid(),name:N().min(1),version:N().min(1),algorithm:N().min(1),status:ps,registered_at:N().datetime(),path:N().min(1),description:N().optional(),traffic_allocation:k().min(0).max(100).optional(),metrics:fs}),Ns=X({models:Ee(ys)});let B=null,M=null;async function bs(){return B||M||(M=(async()=>{try{const s=await fetch(js,{cache:"no-cache"});if(!s.ok)throw new Error(`Failed to fetch model registry: ${s.status}`);const t=await s.json(),a=Ns.parse(t);return B=a,a}catch(s){throw s instanceof De?new Error(`Model registry validation failed: ${s.errors.map(t=>`${t.path.join(".")}: ${t.message}`).join(", ")}`):s instanceof Error?new Error(`Failed to load model registry: ${s.message}`):new Error("Failed to load model registry: Unknown error")}finally{M=null}})(),M)}async function vs(){return(await bs()).models}const V=["model-registry"];function ws(){return A({queryKey:V,queryFn:vs,staleTime:300*1e3})}function _s(){const{toast:s}=Y(),t=xe(),[a,i]=b.useState(!1),{data:r,isLoading:c,error:n}=A({queryKey:["admin-model-system-status"],queryFn:Je,refetchInterval:3e4}),{data:l,isLoading:y,error:_}=A({queryKey:["admin-model-analytics"],queryFn:Xe,refetchInterval:6e4}),{data:w=[],isLoading:E,error:R}=ws(),d=b.useMemo(()=>[...w].sort((o,be)=>new Date(be.registered_at).getTime()-new Date(o.registered_at).getTime()),[w]),f=b.useMemo(()=>d.find(o=>o.status==="active")??null,[d]),[Z,ee]=b.useState(null),fe=Z!==null,pe=Q({mutationFn:o=>Ze({modelId:o}),onMutate:o=>{ee(o)},onSuccess:o=>{t.invalidateQueries({queryKey:["admin-model-system-status"]}),t.invalidateQueries({queryKey:V}),s({title:"Model Promoted",description:o.message})},onError:o=>{s({title:"Promotion Failed",description:o.message||"Failed to promote model.",variant:"destructive"})},onSettled:()=>{ee(null)}}),ye=Q({mutationFn:()=>(i(!0),es({})),onSuccess:o=>{s({title:"Training Started",description:`${o.message} - ${o.estimatedTime}`}),setTimeout(()=>{t.invalidateQueries({queryKey:["admin-model-system-status"]}),t.invalidateQueries({queryKey:V}),i(!1)},1e4)},onError:o=>{s({title:"Training Failed",description:o.message||"Failed to trigger training.",variant:"destructive"}),i(!1)}}),Ne=c||y||E,se=n||_||R;return Ne?e.jsx("div",{className:"container mx-auto p-6",children:e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsxs("div",{className:"text-center",children:[e.jsx(T,{className:"h-8 w-8 animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"Loading model dashboard..."})]})})}):se?e.jsx("div",{className:"container mx-auto p-6",children:e.jsx(m,{children:e.jsxs(x,{children:[e.jsx(u,{children:"Error Loading Dashboard"}),e.jsx(p,{children:se.message||"An error occurred"})]})})}):e.jsxs("div",{className:"container mx-auto p-6 space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"ML Model Control Center"}),e.jsx("p",{className:"text-muted-foreground mt-2",children:"Unified dashboard for model management, performance monitoring, and data configuration"})]})}),e.jsx(xs,{model:f,isLoading:E,isRetraining:a,onTriggerTraining:()=>ye.mutate()}),e.jsxs(m,{children:[e.jsxs(x,{children:[e.jsx(u,{children:"System Overview"}),e.jsx(p,{children:"Current system status and active configuration"})]}),e.jsx(j,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Active Model"}),e.jsx("p",{className:"text-lg font-semibold",children:r?.activeModel?.model_name||"No active model"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:r?.activeModel?.model_version||""})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Total Models"}),e.jsx("p",{className:"text-lg font-semibold",children:r?.models.length||0}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[r?.models.filter(o=>o.is_active).length||0," active"]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"System Health"}),e.jsx("p",{className:"text-lg font-semibold capitalize",children:l?.systemStatus||"Unknown"}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[l?.summary.failRate.toFixed(1),"% fail rate"]})]})]})})]}),e.jsx(ls,{}),e.jsxs(Le,{defaultValue:"models",className:"w-full",children:[e.jsxs(_e,{className:"grid w-full grid-cols-3",children:[e.jsxs($,{value:"models",className:"flex items-center gap-2",children:[e.jsx(oe,{className:"h-4 w-4"}),"Model Management"]}),e.jsxs($,{value:"analytics",className:"flex items-center gap-2",children:[e.jsx(me,{className:"h-4 w-4"}),"Analytics & Health"]}),e.jsxs($,{value:"config",className:"flex items-center gap-2",children:[e.jsx(ge,{className:"h-4 w-4"}),"Data Configuration"]})]}),e.jsx(H,{value:"models",className:"mt-6",children:e.jsx(gs,{models:d,onPromoteModel:o=>pe.mutate(o),isPromoting:fe,promotingModelId:Z})}),e.jsx(H,{value:"analytics",className:"mt-6",children:l&&e.jsx(We,{analytics:l})}),e.jsx(H,{value:"config",className:"mt-6",children:e.jsx(rs,{})})]})]})}export{_s as default};
