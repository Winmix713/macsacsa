import{r as c,j as e,w as y}from"./index-oF1ARjuv.js";import{u as g}from"./useQuery-CWzqJKQX.js";import{W as m}from"./MetricCard-Blih6JUP.js";import{W as N,a as v}from"./Page-C3pqLVgn.js";const _={ok:"bg-emerald-500/10 text-emerald-200",warning:"bg-amber-500/10 text-amber-200",critical:"bg-rose-500/10 text-rose-200"},p=[{key:"response_time_ms",label:"Latency"},{key:"error_rate",label:"Hibaarány"},{key:"cpu_usage",label:"CPU"},{key:"memory_usage",label:"Memória"}],b=(r,i=1)=>r==null||Number.isNaN(r)?"—":`${r.toFixed(i)}%`,z=async()=>{const{data:r,error:i}=await y.functions.invoke("monitoring-health",{method:"GET"});if(i||!r)throw new Error(i?.message??"Nem sikerült betölteni a rendszer állapotát");return r},$=async()=>{const{data:r,error:i}=await y.functions.invoke("monitoring-metrics",{method:"GET"});if(i||!r)throw new Error(i?.message??"Nem sikerült betölteni a teljesítmény metrikákat");return r.metrics??[]},F=()=>{const r=g({queryKey:["winmixpro","health","status"],queryFn:z,refetchInterval:45e3}),i=g({queryKey:["winmixpro","health","metrics"],queryFn:$,refetchInterval:6e4}),o=r.data?.components??[],x=i.data??[],n=c.useMemo(()=>{const t=o.length,s=o.filter(a=>a.status==="healthy").length,l=o.filter(a=>a.status!=="healthy").length,d=o.map(a=>a.response_time_ms).filter(a=>typeof a=="number"&&a>0);return{total:t,healthy:s,alerts:l,sla:t>0?Math.round(s/t*100):0,avgLatency:d.length>0?Math.round(d.reduce((a,k)=>a+k,0)/d.length):null}},[o]),h=c.useMemo(()=>x.filter(s=>s.metric_name==="error_rate").sort((s,l)=>new Date(l.timestamp).getTime()-new Date(s.timestamp).getTime())[0]?.value??null,[x]),u=c.useMemo(()=>o.filter(t=>t.status!=="healthy").map(t=>({id:t.id,title:t.component_name,status:t.status,description:`${t.component_type} szolgáltatás`,timestamp:t.checked_at})),[o]),f=(t,s)=>{if(s===null||Number.isNaN(s))return"ok";switch(t){case"response_time_ms":return s>600?"critical":s>350?"warning":"ok";case"error_rate":return s>.1?"critical":s>.05?"warning":"ok";case"cpu_usage":case"memory_usage":return s>85?"critical":s>70?"warning":"ok";default:return"ok"}},w=r.isLoading||i.isLoading,j=r.isError||i.isError;return e.jsx(N,{title:"Rendszer egészség",description:"Heatmap, riasztások és szolgáltatás szintű mutatók – valós időben a Supabase adataiból.",children:w?e.jsx(v,{}):j?e.jsxs("div",{className:"rounded-3xl border border-rose-500/30 bg-rose-500/10 p-6 text-rose-100",children:[e.jsx("p",{className:"font-semibold",children:"Nem sikerült betölteni a rendszer egészségét."}),e.jsx("p",{className:"mt-2 text-sm opacity-80",children:r.error?.message??i.error?.message??"Ismeretlen hiba"})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:[e.jsx(m,{label:"SLA tartás",value:`${n.sla}%`,hint:`${n.healthy}/${n.total} szolgáltatás stabil`,trend:r.data?`Frissítve: ${new Intl.DateTimeFormat("hu-HU",{hour:"2-digit",minute:"2-digit"}).format(new Date(r.data.updated_at))}`:"—",intent:n.sla>=95?"positive":n.sla>=80?"neutral":"warning"}),e.jsx(m,{label:"Aktív riasztások",value:`${n.alerts}`,hint:"Degradált vagy leállt komponensek",trend:n.alerts>0?"Figyelem szükséges":"Nincs riasztás",intent:n.alerts>0?"warning":"positive"}),e.jsx(m,{label:"Átlagos latency",value:n.avgLatency?`${n.avgLatency} ms`:"—",hint:"Szolgáltatás átlag",trend:h!==null?`Hibaarány: ${b(h*100,2)}`:"",intent:"neutral"})]}),e.jsx("div",{className:"overflow-x-auto rounded-3xl border border-white/10 bg-black/40",children:e.jsxs("table",{className:"w-full min-w-[640px] text-left text-sm text-white/70",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-xs font-semibold uppercase tracking-[0.4em] text-white/40",children:"Szolgáltatás"}),e.jsx("th",{className:"px-4 py-3 text-xs font-semibold uppercase tracking-[0.4em] text-white/40",children:"Státusz"}),p.map(t=>e.jsx("th",{className:"px-4 py-3 text-xs font-semibold uppercase tracking-[0.4em] text-white/40",children:t.label},t.key))]})}),e.jsx("tbody",{children:o.map(t=>e.jsxs("tr",{className:"border-t border-white/5",children:[e.jsxs("td",{className:"px-4 py-4",children:[e.jsx("p",{className:"text-sm font-semibold text-white",children:t.component_name}),e.jsx("p",{className:"text-xs text-white/50",children:t.component_type})]}),e.jsx("td",{className:"px-4 py-4",children:e.jsx("span",{className:`rounded-full px-3 py-1 text-xs font-semibold ${t.status==="healthy"?"bg-emerald-500/10 text-emerald-200":t.status==="degraded"?"bg-amber-500/10 text-amber-200":"bg-rose-500/10 text-rose-200"}`,children:t.status==="healthy"?"Egészséges":t.status==="degraded"?"Degradált":"Leállt"})}),p.map(s=>{const l=t[s.key],d=f(s.key,l);let a="—";return s.key==="response_time_ms"?a=l!==null?`${l} ms`:"—":s.key==="error_rate"?a=l!==null?b(l*100,2):"—":a=l!==null?`${l}%`:"—",e.jsx("td",{className:"px-4 py-4",children:e.jsx("div",{className:`rounded-2xl px-3 py-3 text-center text-sm font-semibold ${_[d]}`,children:e.jsx("p",{children:a})})},`${t.id}-${s.key}`)})]},t.id))})]})}),e.jsxs("div",{className:"rounded-3xl border border-white/10 bg-white/5 p-4",children:[e.jsx("p",{className:"text-xs uppercase tracking-[0.4em] text-white/40",children:"Riasztások"}),e.jsx("div",{className:"mt-3 space-y-3",children:u.length===0?e.jsx("p",{className:"text-sm text-white/60",children:"Nincs aktív riasztás."}):u.map(t=>e.jsxs("div",{className:"rounded-2xl border border-white/10 bg-black/40 p-4",children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-white",children:t.title}),e.jsx("p",{className:"text-xs text-white/60",children:t.description})]}),e.jsx("span",{className:`rounded-full px-3 py-1 text-xs font-semibold ${t.status==="down"?"bg-rose-500/10 text-rose-200":"bg-amber-500/10 text-amber-200"}`,children:t.status==="down"?"Leállt":"Degradált"})]}),e.jsxs("p",{className:"mt-2 text-xs text-white/60",children:["Frissítve: ",new Intl.DateTimeFormat("hu-HU",{hour:"2-digit",minute:"2-digit",second:"2-digit"}).format(new Date(t.timestamp))]})]},t.id))})]})]})})};export{F as default};
