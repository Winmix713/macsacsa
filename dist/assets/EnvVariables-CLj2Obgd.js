import{al as ge,am as ye,r as o,an as h,j as e,ao as fe,G as be,I as Ce,x as n,ap as m,aq as we,ar as Ne,as as x,at as P,au as K,av as M,aw as B,ax as C,ay as ke,S as ce,l as Ee,az as D,C as g,a as F,b as T,c as y,B as te,aA as Se,aB as _e,aC as ne,aD as f,aE as De,aF as b,w}from"./index-oF1ARjuv.js";import{u as Fe}from"./useQuery-CWzqJKQX.js";import{u as I}from"./useMutation-DOyzXJwO.js";import{S as le}from"./switch-D15vbeAy.js";import{D as R,a as ie,b as U,c as z,d as Q,e as Te,f as $}from"./dialog-ByqoZUx5.js";import{D as Ie}from"./download-D8Iv6WS_.js";import{U as Ve}from"./upload-ByLK-W73.js";import{E as G}from"./eye-off-bi6CkRFV.js";import{E as H}from"./eye-BwGd95YC.js";import{D as Y}from"./database-AuhrJFpe.js";import{S as Ae}from"./square-pen-C2a7Gn3j.js";import{T as Le}from"./trash-2-CqJ3cqfw.js";import"./index-ALgH8dPm.js";const qe=[["path",{d:"m22 7-8.991 5.727a2 2 0 0 1-2.009 0L2 7",key:"132q7q"}],["rect",{x:"2",y:"4",width:"20",height:"16",rx:"2",key:"izxlao"}]],Oe=ge("mail",qe),V=[{value:"general",label:"General",icon:C},{value:"database",label:"Database",icon:Y},{value:"api",label:"API",icon:ke},{value:"email",label:"Email",icon:Oe},{value:"security",label:"Security",icon:ce},{value:"cache",label:"Cache",icon:Y},{value:"ai",label:"AI/ML",icon:C},{value:"logging",label:"Logging",icon:C},{value:"limits",label:"Limits",icon:Ee}],Pe=async()=>{const{data:l,error:i}=await w.from("environment_variables").select("*").order("category",{ascending:!0}).order("key",{ascending:!0});if(i)throw new Error(i.message);return l||[]},Ke=async l=>{const{data:i,error:d}=await w.from("environment_variables").insert(l).select().single();if(d)throw new Error(d.message);return i},Me=async(l,i)=>{const{data:d,error:N}=await w.from("environment_variables").update(i).eq("id",l).select().single();if(N)throw new Error(N.message);return d},Be=async l=>{const{error:i}=await w.from("environment_variables").delete().eq("id",l);if(i)throw new Error(i.message)},Re=async l=>{const{data:i,error:d}=await w.functions.invoke("admin-import-env",{body:{content:l}});if(d)throw new Error(d.message);return i||{imported:0,skipped:0,errors:[]}};function as(){const l=ye(),[i,d]=o.useState(!1),[N,k]=o.useState(!1),[oe,A]=o.useState(!1),[J,W]=o.useState(null),[v,de]=o.useState({}),[L,X]=o.useState(""),[E,me]=o.useState(""),[S,he]=o.useState("all"),p=Fe({queryKey:["environment-variables"],queryFn:Pe}),Z=I({mutationFn:Ke,onSuccess:()=>{h.success("Environment variable created successfully"),l.invalidateQueries({queryKey:["environment-variables"]}),d(!1),ae()},onError:s=>{h.error(s.message)}}),ee=I({mutationFn:({id:s,data:a})=>Me(s,a),onSuccess:()=>{h.success("Environment variable updated successfully"),l.invalidateQueries({queryKey:["environment-variables"]}),k(!1),W(null),ae()},onError:s=>{h.error(s.message)}}),xe=I({mutationFn:Be,onSuccess:()=>{h.success("Environment variable deleted successfully"),l.invalidateQueries({queryKey:["environment-variables"]})},onError:s=>{h.error(s.message)}}),se=I({mutationFn:Re,onSuccess:s=>{h.success(`Imported ${s.imported} variables, skipped ${s.skipped}`),s.errors.length>0&&h.error(`${s.errors.length} errors occurred during import`),l.invalidateQueries({queryKey:["environment-variables"]}),A(!1),X("")},onError:s=>{h.error(s.message)}}),[r,c]=o.useState({key:"",value:"",description:"",is_secret:!1,category:"general"}),ae=()=>{c({key:"",value:"",description:"",is_secret:!1,category:"general"})},ue=s=>{W(s),c({key:s.key,value:s.value,description:s.description||"",is_secret:s.is_secret,category:s.category}),k(!0)},je=s=>{confirm("Are you sure you want to delete this environment variable?")&&xe.mutate(s)},_=s=>{de(a=>({...a,[s]:!a[s]}))},ve=()=>{const a=(p.data||[]).map(O=>`# ${O.description||""}
${O.key}=${O.value}`).join(`

`),u=new Blob([a],{type:"text/plain"}),j=URL.createObjectURL(u),t=document.createElement("a");t.href=j,t.download=".env",t.click(),URL.revokeObjectURL(j)},re=o.useMemo(()=>(p.data||[]).filter(a=>{const u=a.key.toLowerCase().includes(E.toLowerCase())||a.description?.toLowerCase().includes(E.toLowerCase()),j=S==="all"||a.category===S;return u&&j}),[p.data,E,S]),pe=o.useMemo(()=>{const s={};return re.forEach(a=>{s[a.category]||(s[a.category]=[]),s[a.category].push(a)}),s},[re]),q=o.useMemo(()=>{const s=p.data||[];return{total:s.length,secrets:s.filter(a=>a.is_secret).length,categories:[...new Set(s.map(a=>a.category))].length}},[p.data]);return e.jsx(fe,{allowedRoles:["admin"],children:e.jsxs("div",{className:"min-h-screen bg-black",children:[e.jsx(be,{}),e.jsx(Ce,{}),e.jsx("main",{className:"lg:ml-64 pt-16 lg:pt-0",children:e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4 mb-8",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gradient-emerald",children:"Environment Variables"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage application configuration and secrets"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(n,{variant:"outline",onClick:ve,children:[e.jsx(Ie,{className:"w-4 h-4 mr-2"}),"Export .env"]}),e.jsxs(R,{open:oe,onOpenChange:A,children:[e.jsx(ie,{asChild:!0,children:e.jsxs(n,{variant:"outline",children:[e.jsx(Ve,{className:"w-4 h-4 mr-2"}),"Import .env"]})}),e.jsxs(U,{className:"max-w-2xl",children:[e.jsxs(z,{children:[e.jsx(Q,{children:"Import from .env file"}),e.jsx(Te,{children:"Paste the content of your .env file to import environment variables."})]}),e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{children:[e.jsx(m,{htmlFor:"env-content",children:".env Content"}),e.jsx(we,{id:"env-content",placeholder:`API_KEY=your_api_key
DATABASE_URL=postgresql://...
DEBUG=true`,value:L,onChange:s=>X(s.target.value),rows:10})]})}),e.jsxs($,{children:[e.jsx(n,{variant:"outline",onClick:()=>A(!1),children:"Cancel"}),e.jsx(n,{onClick:()=>se.mutate(L),disabled:se.isPending||!L.trim(),children:"Import"})]})]})]}),e.jsxs(R,{open:i,onOpenChange:d,children:[e.jsx(ie,{asChild:!0,children:e.jsxs(n,{children:[e.jsx(Ne,{className:"w-4 h-4 mr-2"}),"Add Variable"]})}),e.jsxs(U,{children:[e.jsx(z,{children:e.jsx(Q,{children:"Add Environment Variable"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(m,{htmlFor:"key",children:"Key"}),e.jsx(x,{id:"key",value:r.key,onChange:s=>c(a=>({...a,key:s.target.value})),placeholder:"API_KEY"})]}),e.jsxs("div",{children:[e.jsx(m,{htmlFor:"value",children:"Value"}),e.jsx(x,{id:"value",type:r.is_secret&&!v.new?"password":"text",value:r.value,onChange:s=>c(a=>({...a,value:s.target.value})),placeholder:"your_api_key"}),r.is_secret&&e.jsx(n,{type:"button",variant:"ghost",size:"sm",onClick:()=>_("new"),className:"mt-1",children:v.new?e.jsx(G,{className:"w-4 h-4"}):e.jsx(H,{className:"w-4 h-4"})})]}),e.jsxs("div",{children:[e.jsx(m,{htmlFor:"description",children:"Description"}),e.jsx(x,{id:"description",value:r.description,onChange:s=>c(a=>({...a,description:s.target.value})),placeholder:"API key for external service"})]}),e.jsxs("div",{children:[e.jsx(m,{htmlFor:"category",children:"Category"}),e.jsxs(P,{value:r.category,onValueChange:s=>c(a=>({...a,category:s})),children:[e.jsx(K,{children:e.jsx(M,{})}),e.jsx(B,{children:V.map(s=>e.jsx(D,{value:s.value,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(s.icon,{className:"w-4 h-4"}),s.label]})},s.value))})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(le,{id:"is_secret",checked:r.is_secret,onCheckedChange:s=>c(a=>({...a,is_secret:s}))}),e.jsx(m,{htmlFor:"is_secret",children:"This is a secret value"})]})]}),e.jsxs($,{children:[e.jsx(n,{variant:"outline",onClick:()=>d(!1),children:"Cancel"}),e.jsx(n,{onClick:()=>Z.mutate(r),disabled:Z.isPending||!r.key||!r.value,children:"Create"})]})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8",children:[e.jsxs(g,{className:"bg-card/60 border-border/80 backdrop-blur",children:[e.jsxs(F,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(T,{className:"text-sm font-medium",children:"Total Variables"}),e.jsx(C,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(y,{children:e.jsx("div",{className:"text-2xl font-bold",children:q.total})})]}),e.jsxs(g,{className:"bg-card/60 border-border/80 backdrop-blur",children:[e.jsxs(F,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(T,{className:"text-sm font-medium",children:"Secret Variables"}),e.jsx(ce,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(y,{children:e.jsx("div",{className:"text-2xl font-bold",children:q.secrets})})]}),e.jsxs(g,{className:"bg-card/60 border-border/80 backdrop-blur",children:[e.jsxs(F,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(T,{className:"text-sm font-medium",children:"Categories"}),e.jsx(Y,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(y,{children:e.jsx("div",{className:"text-2xl font-bold",children:q.categories})})]})]}),e.jsx(g,{className:"bg-card/60 border-border/80 backdrop-blur mb-6",children:e.jsx(y,{className:"pt-6",children:e.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsx(x,{placeholder:"Search variables...",value:E,onChange:s=>me(s.target.value)})}),e.jsx("div",{className:"w-full md:w-48",children:e.jsxs(P,{value:S,onValueChange:he,children:[e.jsx(K,{children:e.jsx(M,{placeholder:"All categories"})}),e.jsxs(B,{children:[e.jsx(D,{value:"all",children:"All Categories"}),V.map(s=>e.jsx(D,{value:s.value,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(s.icon,{className:"w-4 h-4"}),s.label]})},s.value))]})]})})]})})}),e.jsx("div",{className:"space-y-6",children:Object.entries(pe).map(([s,a])=>{const u=V.find(t=>t.value===s),j=u?.icon||C;return e.jsxs(g,{className:"bg-card/60 border-border/80 backdrop-blur",children:[e.jsx(F,{children:e.jsxs(T,{className:"flex items-center gap-2",children:[e.jsx(j,{className:"w-5 h-5"}),u?.label||s,e.jsx(te,{variant:"secondary",children:a.length})]})}),e.jsx(y,{children:e.jsxs(Se,{children:[e.jsx(_e,{children:e.jsxs(ne,{children:[e.jsx(f,{children:"Key"}),e.jsx(f,{children:"Value"}),e.jsx(f,{children:"Description"}),e.jsx(f,{children:"Type"}),e.jsx(f,{children:"Actions"})]})}),e.jsx(De,{children:a.map(t=>e.jsxs(ne,{children:[e.jsx(b,{className:"font-mono text-sm",children:t.key}),e.jsx(b,{className:"font-mono text-sm",children:t.is_secret&&!v[t.id]?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-muted-foreground",children:"••••••••"}),e.jsx(n,{variant:"ghost",size:"sm",onClick:()=>_(t.id),children:e.jsx(H,{className:"w-3 h-3"})})]}):e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"break-all",children:t.value}),t.is_secret&&e.jsx(n,{variant:"ghost",size:"sm",onClick:()=>_(t.id),children:e.jsx(G,{className:"w-3 h-3"})})]})}),e.jsx(b,{className:"text-sm text-muted-foreground",children:t.description||"-"}),e.jsx(b,{children:e.jsx(te,{variant:t.is_secret?"destructive":"secondary",children:t.is_secret?"Secret":"Public"})}),e.jsx(b,{children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(n,{variant:"ghost",size:"sm",onClick:()=>ue(t),children:e.jsx(Ae,{className:"w-4 h-4"})}),e.jsx(n,{variant:"ghost",size:"sm",onClick:()=>je(t.id),className:"text-destructive hover:text-destructive",children:e.jsx(Le,{className:"w-4 h-4"})})]})})]},t.id))})]})})]},s)})}),e.jsx(R,{open:N,onOpenChange:k,children:e.jsxs(U,{children:[e.jsx(z,{children:e.jsx(Q,{children:"Edit Environment Variable"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(m,{htmlFor:"edit-key",children:"Key"}),e.jsx(x,{id:"edit-key",value:r.key,onChange:s=>c(a=>({...a,key:s.target.value})),placeholder:"API_KEY"})]}),e.jsxs("div",{children:[e.jsx(m,{htmlFor:"edit-value",children:"Value"}),e.jsx(x,{id:"edit-value",type:r.is_secret&&!v.edit?"password":"text",value:r.value,onChange:s=>c(a=>({...a,value:s.target.value})),placeholder:"your_api_key"}),r.is_secret&&e.jsx(n,{type:"button",variant:"ghost",size:"sm",onClick:()=>_("edit"),className:"mt-1",children:v.edit?e.jsx(G,{className:"w-4 h-4"}):e.jsx(H,{className:"w-4 h-4"})})]}),e.jsxs("div",{children:[e.jsx(m,{htmlFor:"edit-description",children:"Description"}),e.jsx(x,{id:"edit-description",value:r.description,onChange:s=>c(a=>({...a,description:s.target.value})),placeholder:"API key for external service"})]}),e.jsxs("div",{children:[e.jsx(m,{htmlFor:"edit-category",children:"Category"}),e.jsxs(P,{value:r.category,onValueChange:s=>c(a=>({...a,category:s})),children:[e.jsx(K,{children:e.jsx(M,{})}),e.jsx(B,{children:V.map(s=>e.jsx(D,{value:s.value,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(s.icon,{className:"w-4 h-4"}),s.label]})},s.value))})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(le,{id:"edit-is_secret",checked:r.is_secret,onCheckedChange:s=>c(a=>({...a,is_secret:s}))}),e.jsx(m,{htmlFor:"edit-is_secret",children:"This is a secret value"})]})]}),e.jsxs($,{children:[e.jsx(n,{variant:"outline",onClick:()=>k(!1),children:"Cancel"}),e.jsx(n,{onClick:()=>J&&ee.mutate({id:J.id,data:r}),disabled:ee.isPending||!r.key||!r.value,children:"Update"})]})]})})]})})]})})}export{as as default};
