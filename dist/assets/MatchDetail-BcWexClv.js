import{r as l,j as e,B as m,A as g,l as H,aI as P,n as p,C as x,a as j,b as u,aH as W,c as o,aJ as $,m as D,aK as V,aL as O,k as Y,g as J,D as X,E as Z,w as I,x as R,aM as K,ad as ee,aN as se}from"./index-B-k02BhT.js";import{A as q}from"./arrow-left-f6slp5DI.js";const ae={home_winning_streak:"Hazai győzelmi széria",away_winning_streak:"Vendég győzelmi széria",h2h_dominance:"H2H dominancia",recent_form_advantage:"Forma előny",high_scoring_league:"Gólgazdag liga"},te={home_winning_streak:W,away_winning_streak:W,h2h_dominance:D,recent_form_advantage:J,high_scoring_league:Y},ne={full_time:"Teljes idejű modell",half_time:"Félidős modell",pattern:"Mintázat-alapú modell"},le={HOME:"Hazai győzelem",DRAW:"Döntetlen",AWAY:"Vendég győzelem"},C=a=>{switch(a){case"home_win":case"HOME":return"Hazai győzelem";case"away_win":case"AWAY":return"Vendég győzelem";case"draw":case"DRAW":return"Döntetlen";default:return a||"Nincs"}};function ce({prediction:a,patterns:w=[],formScores:t,explanation:r,decisionPath:c,predictionStatus:d="active",overconfidenceFlag:M=!1,blockedReason:v,alternateOutcome:z,downgradedFromConfidence:E}){const[y,A]=l.useState(!1),[f,S]=l.useState(!1),[N,_]=l.useState(!1),b=a.ensemble_breakdown,k=C(a.predicted_outcome),T=d==="uncertain"&&!M&&b?.conflict_detected?`Ensemble konfliktus: a két legmagasabb pontszám közötti különbség ${(b.conflict_margin*100).toFixed(1)}% (küszöb: 10%).`:void 0,F=v||T,n=a.confidence_score>=70?"text-green-600":a.confidence_score>=55?"text-yellow-600":"text-red-600",h=()=>{switch(d){case"active":return"default";case"uncertain":return"secondary";case"blocked":return"destructive";default:return"default"}},U=()=>{switch(d){case"active":return"Megerősített előrejelzés";case"uncertain":return"Downgrade - Előzetes hiba miatt";case"blocked":return"Letiltott - Lásd az okot";default:return"Aktív"}},G=s=>C(s);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium",children:"Előrejelzés státusza:"}),e.jsx(m,{variant:h(),children:U()})]}),d==="uncertain"&&F&&e.jsxs(g,{variant:"warning",className:"border-yellow-500/50 bg-yellow-50/10",children:[e.jsx(H,{className:"h-4 w-4 text-yellow-600"}),e.jsx(P,{children:"Konfidencia Downgrade"}),e.jsx(p,{children:e.jsxs("div",{className:"text-sm space-y-2",children:[e.jsx("p",{children:F}),E&&e.jsxs("div",{children:[e.jsxs("span",{className:"font-medium",children:["Eredeti: ",(E*100).toFixed(1),"%"]})," → ",e.jsxs("span",{className:"font-medium",children:["Jelenlegi: ",a.confidence_score.toFixed(1),"%"]})]}),z&&e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Alternatíva:"})," ",G(z)]})]})})]}),d==="blocked"&&v&&e.jsxs(g,{variant:"destructive",className:"border-red-500/50 bg-red-50/10",children:[e.jsx(H,{className:"h-4 w-4 text-red-600"}),e.jsx(P,{children:"Előrejelzés Letiltva"}),e.jsx(p,{className:"text-sm",children:v})]})]}),e.jsxs(x,{children:[e.jsx(j,{children:e.jsxs(u,{className:"flex items-center gap-2",children:[e.jsx(W,{className:"w-5 h-5"}),"Predikció Eredmény"]})}),e.jsx(o,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-lg font-medium",children:"Előrejelzett kimenetel:"}),e.jsx(m,{variant:"default",className:"text-lg px-4 py-1",children:k})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Megbízhatósági pontszám"}),e.jsxs("span",{className:`text-2xl font-bold ${n}`,children:[a.confidence_score.toFixed(1),"%"]})]}),e.jsx($,{value:a.confidence_score,className:"h-3"})]}),a.btts_prediction!==void 0&&e.jsxs("div",{className:"flex items-center justify-between pt-2 border-t",children:[e.jsx("span",{className:"text-sm",children:"Mindkét csapat szerez gólt (BTTS):"}),e.jsx(m,{variant:a.btts_prediction?"default":"secondary",children:a.btts_prediction?"Igen":"Nem"})]})]})})]}),a.ensemble_breakdown&&e.jsxs(x,{children:[e.jsx(j,{children:e.jsxs("button",{onClick:()=>_(!N),className:"w-full flex items-center justify-between hover:opacity-70 transition",children:[e.jsxs(u,{className:"flex items-center gap-2",children:[e.jsx(D,{className:"w-5 h-5"}),"Ensemble Előrejelzés Lebontása"]}),N?e.jsx(V,{className:"w-5 h-5"}):e.jsx(O,{className:"w-5 h-5"})]})}),N&&e.jsxs(o,{className:"space-y-4",children:[a.ensemble_breakdown.conflict_detected&&e.jsxs(g,{variant:"warning",className:"border-yellow-500/50 bg-yellow-50/10",children:[e.jsx(H,{className:"h-4 w-4 text-yellow-600"}),e.jsx(P,{children:"Alacsony Biztonságú Predikció"}),e.jsxs(p,{className:"text-sm",children:["A modellek között konfliktus észlelve: a két legmagasabb pontszám közötti különbség "," ",(a.ensemble_breakdown.conflict_margin*100).toFixed(1),"% (küszöb: 10%)"]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-sm mb-3",children:"Sub-model Szavazatok:"}),e.jsx("div",{className:"space-y-2",children:["full_time","half_time","pattern"].map(s=>{const i=a.ensemble_breakdown.votes[s];if(!i)return null;const B=s==="full_time"?"ft":s==="half_time"?"ht":"pt",L=i.prediction!==a.ensemble_breakdown.winner,Q=L?"border border-red-500/50 bg-red-50/10":"border border-transparent bg-muted/30";return e.jsxs("div",{className:`p-3 rounded-lg ${Q}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:"font-medium text-sm",children:ne[s]}),e.jsxs(m,{variant:L?"destructive":"outline",children:["Súly: ",(a.ensemble_breakdown.weights_used[B]*100).toFixed(0),"%"]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:`text-xs ${L?"text-red-600 font-semibold":"text-muted-foreground"}`,children:C(i.prediction)}),e.jsxs("span",{className:"text-xs font-medium",children:[(i.confidence*100).toFixed(1),"%"]})]}),L&&e.jsx("p",{className:"text-xs text-red-600 font-medium mt-2",children:"Felülbírálva az ensemble által"})]},s)})})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-sm mb-2",children:"Végső Pontszámok:"}),e.jsx("div",{className:"space-y-2",children:["HOME","DRAW","AWAY"].map(s=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-sm",children:[le[s],":"]}),e.jsxs("div",{className:"flex items-center gap-2 flex-1 ml-4",children:[e.jsx($,{value:a.ensemble_breakdown.scores[s]*100,className:"h-2"}),e.jsxs("span",{className:"text-sm font-medium min-w-12 text-right",children:[(a.ensemble_breakdown.scores[s]*100).toFixed(1),"%"]})]})]},s))})]}),e.jsxs("div",{className:"p-3 bg-muted/50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium",children:"Nyertes:"}),e.jsx(m,{variant:"default",children:C(a.ensemble_breakdown.winner)})]}),e.jsxs("div",{className:"flex items-center justify-between mt-2",children:[e.jsx("span",{className:"text-sm font-medium",children:"Végső konfidencia:"}),e.jsxs("span",{className:"text-sm font-bold",children:[(a.ensemble_breakdown.final_confidence*100).toFixed(1),"%"]})]})]})]})]}),w.length>0&&e.jsxs(x,{children:[e.jsx(j,{children:e.jsxs(u,{className:"flex items-center gap-2",children:[e.jsx(D,{className:"w-5 h-5"}),"Detektált Pattern-ek"]})}),e.jsx(o,{children:e.jsx("div",{className:"space-y-3",children:w.map((s,i)=>{const B=te[s.template_name]||Y;return e.jsxs("div",{className:"flex items-center justify-between p-3 bg-muted/50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(B,{className:"w-5 h-5 text-primary"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:ae[s.template_name]||s.template_name}),e.jsx("p",{className:"text-xs text-muted-foreground",children:JSON.stringify(s.data)})]})]}),e.jsxs(m,{variant:"outline",className:"ml-2",children:["+",s.confidence_boost.toFixed(1),"%"]})]},i)})})})]}),t&&e.jsxs(x,{children:[e.jsx(j,{children:e.jsxs(u,{className:"flex items-center gap-2",children:[e.jsx(J,{className:"w-5 h-5"}),"Forma Pontszámok"]})}),e.jsx(o,{children:e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"text-center p-4 bg-muted/50 rounded-lg",children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-1",children:"Hazai csapat"}),e.jsx("p",{className:"text-3xl font-bold",children:t.home})]}),e.jsxs("div",{className:"text-center p-4 bg-muted/50 rounded-lg",children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-1",children:"Vendég csapat"}),e.jsx("p",{className:"text-3xl font-bold",children:t.away})]})]})})]}),r&&e.jsxs(x,{children:[e.jsx(j,{children:e.jsxs("button",{onClick:()=>S(!f),className:"w-full flex items-center justify-between hover:opacity-70 transition",children:[e.jsxs(u,{className:"flex items-center gap-2",children:[e.jsx(Y,{className:"w-5 h-5"}),"Magyarázat és Elemzés"]}),f?e.jsx(V,{className:"w-5 h-5"}):e.jsx(O,{className:"w-5 h-5"})]})}),f&&e.jsxs(o,{className:"space-y-4",children:[e.jsx("div",{className:"p-3 bg-muted/50 rounded-lg",children:e.jsx("p",{className:"text-sm",children:r.summary})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-sm mb-3",children:"Fő Tényezők:"}),e.jsx("div",{className:"space-y-2",children:r.key_factors.map((s,i)=>e.jsxs("div",{className:"p-3 bg-muted/30 rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:"font-medium text-sm",children:s.factor}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:["Súly: ",(s.weight*100).toFixed(0),"%"]})]}),e.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:s.details}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-xs",children:"Hozzájárulás:"}),e.jsx("span",{className:"text-xs font-medium text-green-600",children:s.contribution})]})]},i))})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-sm mb-2",children:"Döntési Fa:"}),e.jsx("div",{className:"space-y-1",children:r.decision_tree.map((s,i)=>e.jsx("div",{className:"text-xs text-muted-foreground pl-3 py-1 border-l-2 border-muted",children:s},i))})]}),e.jsxs("div",{className:"p-3 bg-muted/50 rounded-lg",children:[e.jsx("h4",{className:"font-medium text-sm mb-2",children:"Konfidencia Lebontása:"}),e.jsxs("div",{className:"space-y-1 text-xs",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Alap konfidencia:"}),e.jsxs("span",{children:[(r.confidence_breakdown.base_confidence*100).toFixed(1),"%"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Minta Boost:"}),e.jsxs("span",{className:"text-green-600",children:["+",(r.confidence_breakdown.pattern_boost*100).toFixed(1),"%"]})]}),e.jsxs("div",{className:"flex justify-between font-medium border-t pt-1",children:[e.jsx("span",{children:"Végső konfidencia:"}),e.jsxs("span",{children:[(r.confidence_breakdown.final_confidence*100).toFixed(1),"%"]})]})]})]})]})]}),c&&e.jsxs(x,{children:[e.jsx(j,{children:e.jsxs("button",{onClick:()=>A(!y),className:"w-full flex items-center justify-between hover:opacity-70 transition",children:[e.jsxs(u,{className:"flex items-center gap-2",children:[e.jsx(D,{className:"w-5 h-5"}),"Döntési Útvonal"]}),y?e.jsx(V,{className:"w-5 h-5"}):e.jsx(O,{className:"w-5 h-5"})]})}),y&&e.jsx(o,{children:e.jsx("div",{className:"space-y-3",children:c.nodes.map((s,i)=>e.jsx("div",{className:"p-3 bg-muted/30 rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"min-w-8 h-8 rounded-full bg-primary/20 flex items-center justify-center text-xs font-medium",children:s.id}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"text-xs font-medium px-2 py-1 bg-muted rounded",children:s.type}),s.outcome&&e.jsxs("span",{className:"text-xs text-green-600 font-medium",children:["→ ",s.outcome]})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s.condition}),s.confidence_contribution&&e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["Konfidencia hozzájárulás: ",(s.confidence_contribution*100).toFixed(1),"%"]})]})]})},i))})})]})]})}function de(){const{id:a}=X(),w=Z(),[t,r]=l.useState(null),[c,d]=l.useState(null),[M,v]=l.useState([]),[z,E]=l.useState(null),[y,A]=l.useState(!1),[f,S]=l.useState(!1),[N,_]=l.useState(null),b=l.useCallback(async()=>{A(!0);const{data:n,error:h}=await I.from("matches").select(`
        *,
        home_team:teams!home_team_id(id, name),
        away_team:teams!away_team_id(id, name),
        league:leagues(name)
      `).eq("id",a).single();h?(console.error("Error fetching match:",h),_("Mérkőzés nem található")):r(n),A(!1)},[a]),k=l.useCallback(async()=>{const{data:n}=await I.from("predictions").select("*").eq("match_id",a).maybeSingle();d(n)},[a]);l.useEffect(()=>{a&&(b(),k())},[a,b,k]);async function T(){if(t){S(!0),_(null);try{const{data:n,error:h}=await I.functions.invoke("analyze-match",{body:{matchId:a}});if(h)throw h;d(n.prediction),v(n.patterns||[]),E(n.form_scores||null)}catch(n){console.error("Error analyzing match:",n),_(n instanceof Error?n.message:"Hiba az elemzés során")}finally{S(!1)}}}function F(){k(),b()}return y?e.jsx("div",{className:"container mx-auto p-6 max-w-4xl",children:e.jsx("p",{className:"text-center text-muted-foreground",children:"Betöltés..."})}):t?e.jsxs("div",{className:"container mx-auto p-6 max-w-4xl",children:[e.jsxs(R,{onClick:()=>w("/dashboard"),variant:"outline",className:"mb-6",children:[e.jsx(q,{className:"w-4 h-4 mr-2"}),"Vissza a Dashboard-ra"]}),e.jsxs(x,{className:"mb-6",children:[e.jsxs(j,{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(m,{variant:t.status==="scheduled"?"default":"secondary",children:t.status==="scheduled"?"Jövőbeli mérkőzés":"Befejezett mérkőzés"}),e.jsx("span",{className:"text-sm text-muted-foreground",children:K(new Date(t.match_date),"yyyy. MMMM dd.")})]}),e.jsx(u,{className:"text-2xl",children:t.league.name})]}),e.jsx(o,{children:e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"flex items-center justify-between bg-muted/50 p-4 rounded-lg",children:[e.jsxs("div",{className:"text-center flex-1",children:[e.jsx("p",{className:"text-2xl font-bold",children:t.home_team.name}),t.status==="finished"&&e.jsx("p",{className:"text-4xl font-bold mt-2",children:t.home_score})]}),e.jsx("div",{className:"px-6",children:e.jsx("span",{className:"text-3xl font-bold text-muted-foreground",children:"VS"})}),e.jsxs("div",{className:"text-center flex-1",children:[e.jsx("p",{className:"text-2xl font-bold",children:t.away_team.name}),t.status==="finished"&&e.jsx("p",{className:"text-4xl font-bold mt-2",children:t.away_score})]})]})})})]}),N&&e.jsx(g,{variant:"destructive",className:"mb-6",children:e.jsx(p,{children:N})}),!c&&t.status==="scheduled"&&e.jsx(x,{className:"mb-6",children:e.jsx(o,{className:"pt-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx(ee,{className:"w-12 h-12 mx-auto mb-4 text-primary"}),e.jsx("h3",{className:"text-xl font-semibold mb-2",children:"Pattern Detection"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:"Indítsd el az AI elemzést, hogy predikciót kapj erre a mérkőzésre"}),e.jsxs(R,{onClick:T,disabled:f,size:"lg",className:"w-full max-w-md",children:[e.jsx(J,{className:"w-4 h-4 mr-2"}),f?"Elemzés folyamatban...":"Elemzés indítása"]})]})})}),c&&e.jsxs(e.Fragment,{children:[e.jsx(ce,{prediction:c,patterns:M,formScores:z}),t.status==="finished"&&!c.actual_outcome&&e.jsx(se,{matchId:t.id,homeTeam:t.home_team.name,awayTeam:t.away_team.name,onSubmitted:F}),c.actual_outcome&&e.jsx(g,{className:"mt-6",children:e.jsx(p,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{children:["Predikció eredmény: ",e.jsx("strong",{children:c.was_correct?"HELYES ✅":"HELYTELEN ❌"})]}),e.jsx(m,{variant:c.was_correct?"default":"destructive",children:c.actual_outcome==="home_win"?"Hazai győzelem":c.actual_outcome==="away_win"?"Vendég győzelem":"Döntetlen"})]})})})]})]}):e.jsxs("div",{className:"container mx-auto p-6 max-w-4xl",children:[e.jsx(g,{variant:"destructive",children:e.jsx(p,{children:"Mérkőzés nem található"})}),e.jsxs(R,{onClick:()=>w("/dashboard"),className:"mt-4",children:[e.jsx(q,{className:"w-4 h-4 mr-2"}),"Vissza"]})]})}export{de as default};
