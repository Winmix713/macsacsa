import{j as e,C as x,a as u,b as g,c as j,a7 as R,ae as Y,af as G,ag as I,a8 as X,a9 as q,ah as B,r as d,w as J,ai as A,aj as m,ak as Q}from"./index-B-k02BhT.js";import{L as V,a as h}from"./LineChart-nj2nzcDi.js";function Z({data:a}){return e.jsxs(x,{className:"border-border/60 bg-muted/20",children:[e.jsx(u,{children:e.jsx(g,{className:"text-lg font-semibold",children:"Model Performance Over Time"})}),e.jsx(j,{className:"h-96",children:e.jsx(R,{width:"100%",height:"100%",children:e.jsxs(V,{data:a,margin:{top:8,right:16,left:0,bottom:8},children:[e.jsx(Y,{strokeDasharray:"3 3",stroke:"hsl(var(--muted-foreground) / 0.2)"}),e.jsx(G,{dataKey:"date",stroke:"hsl(var(--muted-foreground))"}),e.jsx(I,{stroke:"hsl(var(--muted-foreground))",label:{value:"Accuracy (%)",angle:-90,position:"insideLeft"}}),e.jsx(X,{}),e.jsx(q,{}),e.jsx(h,{type:"monotone",dataKey:"overall",name:"Overall",stroke:"#22c55e",strokeWidth:2}),e.jsx(h,{type:"monotone",dataKey:"home_win",name:"Home Win",stroke:"#3b82f6",strokeWidth:1.5}),e.jsx(h,{type:"monotone",dataKey:"draw",name:"Draw",stroke:"#eab308",strokeWidth:1.5}),e.jsx(h,{type:"monotone",dataKey:"away_win",name:"Away Win",stroke:"#ef4444",strokeWidth:1.5})]})})})]})}function ee(a){const r=new Date(a),f=r.getUTCFullYear(),y=String(r.getUTCMonth()+1).padStart(2,"0"),o=String(r.getUTCDate()).padStart(2,"0");return`${f}-${y}-${o}`}function ae(){B("Analytics • WinMix TipsterHub");const[a,r]=d.useState(!0),[f,y]=d.useState([]),[o,T]=d.useState({total:0,accuracy:0,avgCalibrationError:0}),[E,K]=d.useState(0);d.useEffect(()=>{L()},[]);async function L(){try{r(!0);const c=new Date(Date.now()-720*60*60*1e3).toISOString(),{data:M,error:C}=await J.from("predictions").select("created_at, predicted_outcome, confidence_score, css_score, was_correct").gte("created_at",c).order("created_at",{ascending:!0});if(C)throw C;const b=M??[],n=new Map;for(const s of b){const t=ee(s.created_at);n.has(t)||n.set(t,[]),n.get(t).push(s)}const W=Array.from(n.keys()).sort().map(s=>{const l=n.get(s).filter(i=>i.was_correct!==null),N=l.length,O=l.filter(i=>i.was_correct===!0).length,U=N>0?O/N*100:0,v=i=>{const S=l.filter(k=>k.predicted_outcome===i),D=S.length,$=S.filter(k=>k.was_correct).length;return D>0?$/D*100:0};return{date:s,overall:U,home_win:v("home_win"),draw:v("draw"),away_win:v("away_win")}});y(W);const P=b.filter(s=>s.css_score!==null&&s.css_score!==void 0).map(s=>s.css_score);K(P.length);const p=b.filter(s=>s.was_correct!==null),w=p.length,H=p.filter(s=>s.was_correct===!0).length,z=w>0?Math.round(H/w*100):0,_=p.map(s=>{const t=(s.css_score??s.confidence_score)/100,l=s.was_correct?1:0;return Math.abs(t-l)}),F=_.length>0?Number((_.reduce((s,t)=>s+t,0)/_.length).toFixed(3)):0;T({total:w,accuracy:z,avgCalibrationError:F})}catch(c){console.error("Failed to load analytics",c)}finally{r(!1)}}return a?e.jsxs(A,{children:[e.jsxs("div",{className:"mb-8",children:[e.jsx(m,{className:"h-12 w-64 mb-2"}),e.jsx(m,{className:"h-4 w-96"})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8",children:[1,2,3].map(c=>e.jsx(m,{className:"h-28"},c))}),e.jsx(m,{className:"h-96"})]}):e.jsxs(A,{children:[e.jsx(Q,{title:"Analytics",description:"Hosszú távú modell teljesítmény, kalibráció, összehasonlítás"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8",children:[e.jsxs(x,{className:"glass-card border-border",children:[e.jsx(u,{children:e.jsx(g,{children:"Összes értékelt predikció"})}),e.jsx(j,{children:e.jsx("div",{className:"text-3xl font-bold",children:o.total})})]}),e.jsxs(x,{className:"glass-card border-border",children:[e.jsx(u,{children:e.jsx(g,{children:"Összpontosság"})}),e.jsx(j,{children:e.jsxs("div",{className:"text-3xl font-bold",children:[o.accuracy,"%"]})})]}),e.jsxs(x,{className:"glass-card border-border",children:[e.jsx(u,{children:e.jsx(g,{children:"Átlagos kalibrációs hiba"})}),e.jsxs(j,{children:[e.jsx("div",{className:"text-3xl font-bold",children:o.avgCalibrationError}),e.jsx("p",{className:"text-muted-foreground text-xs",children:"|p - y| átlag, 0 a jobb"})]})]})]}),E===0&&e.jsx("div",{className:"p-4 rounded-lg mb-6 border border-yellow-500/20 bg-yellow-500/10 text-yellow-300",children:"No CSS scores available yet. Predictions are being processed."}),e.jsx(Z,{data:f})]})}export{ae as default};
