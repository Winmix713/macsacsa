import{j as e,bx as x,r as m,C as g,a as j,b as y,J as v,at as w,au as b,av as C,aw as S,az as N,x as d,ab as h,c as _,w as u}from"./index-oF1ARjuv.js";import{u as f}from"./useQuery-CWzqJKQX.js";import{A as D}from"./AdminLayout-Bg1DZssM.js";import{S as H,P as R}from"./PerformanceMetricsChart-DNDcP8Lc.js";import"./sheet-DvMN5rIM.js";import"./index-ALgH8dPm.js";import"./workflow-DCkL6mGY.js";import"./cpu-Bs1Da7jx.js";import"./database-AuhrJFpe.js";import"./LineChart-CcduGUPG.js";const k=()=>f({queryKey:["monitoring","health-dashboard"],queryFn:async()=>{const{data:t,error:r}=await u.functions.invoke("monitoring-health");if(r)throw new Error(r.message);return t},refetchInterval:3e4}),A=t=>f({queryKey:["monitoring","metrics",t??"all"],queryFn:async()=>{const{data:r,error:i}=await u.functions.invoke("monitoring-metrics",{body:t?{component:t}:{}});if(i)throw new Error(i.message);return r},enabled:!0,refetchInterval:3e4});function B(){return e.jsx(x,{allowedRoles:["admin","analyst"],children:e.jsx(M,{})})}function M(){const t=k(),[r,i]=m.useState(null),o=A(r),p=m.useMemo(()=>{const a=o.data?.metrics??[],c=new Map;for(const s of a){const n=s.timestamp;c.has(n)||c.set(n,{time:n});const l=c.get(n);s.metric_name==="latency_p50"&&(l.p50=s.value),s.metric_name==="latency_p95"&&(l.p95=s.value),s.metric_name==="latency_p99"&&(l.p99=s.value)}return Array.from(c.values()).sort((s,n)=>new Date(s.time).getTime()-new Date(n.time).getTime())},[o.data]);return e.jsxs(D,{title:"Health Dashboard",description:"Real-time system health and performance overview",breadcrumbs:[{label:"Admin",href:"/admin"},{label:"Health"}],actions:e.jsxs(d,{variant:"outline",size:"sm",onClick:()=>{t.refetch(),o.refetch()},className:"inline-flex items-center gap-2",children:[e.jsx(h,{className:"w-4 h-4"}),"Refresh"]}),children:[e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:(t.data?.components??[]).map(a=>e.jsx(H,{health:a},a.id))}),e.jsxs(g,{className:"border-border/60 bg-muted/20",children:[e.jsxs(j,{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs(y,{className:"text-lg font-semibold flex items-center gap-2",children:[e.jsx(v,{className:"w-5 h-5"}),"Performance Metrics"]}),e.jsxs("div",{className:"flex items-center gap-2 w-full sm:w-64",children:[e.jsxs(w,{value:r??void 0,onValueChange:a=>i(a),children:[e.jsx(b,{children:e.jsx(C,{placeholder:"Select component"})}),e.jsx(S,{children:(t.data?.components??[]).map(a=>e.jsx(N,{value:a.component_name,children:a.component_name},a.id))})]}),e.jsx(d,{variant:"ghost",size:"sm",onClick:()=>void o.refetch(),children:e.jsx(h,{className:"w-4 h-4"})})]})]}),e.jsx(_,{children:e.jsx(R,{data:p})})]})]})}export{B as default};
